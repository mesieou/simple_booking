
> simple-booking@0.1.0 dev
> next dev

   ▲ Next.js 15.3.2
   - Local:        http://localhost:3000
   - Network:      http://192.168.0.148:3000
   - Environments: .env.local

 ✓ Starting...
 ✓ Ready in 1496ms
 ○ Compiling /api/onboarding/create-business ...
 ✓ Compiled /api/onboarding/create-business in 823ms (894 modules)
[Environment] Using development environment for service-role client
(node:77770) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: 5bedc020-89f5-4fe4-ac1d-0956c5674630
[Onboarding] Creating business...
[Onboarding] Business created with ID: ff396342-7669-4ca5-9e73-db7be188f417
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: '5bedc020-89f5-4fe4-ac1d-0956c5674630',
  firstName: 'John',
  lastName: 'Doe',
  role: 'admin/provider',
  businessId: 'ff396342-7669-4ca5-9e73-db7be188f417',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000001',
  whatsAppNumberNormalized: '61400000002'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: 5bedc020-89f5-4fe4-ac1d-0956c5674630
[Onboarding] Successfully created 1 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: John Doe (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  providerId: '5bedc020-89f5-4fe4-ac1d-0956c5674630',
  businessId: 'ff396342-7669-4ca5-9e73-db7be188f417',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  timezone: 'Australia/Sydney',
  manageCalendar: false
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
Failed to save calendar settings {
  message: "Could not find the 'providerId' column of 'calendarSettings' in the schema cache",
  details: null,
  code: 'PGRST204',
  hint: null
}
[Onboarding] Error creating calendar settings: Error [ModelError]: Failed to save calendar settings
    at handleModelError (lib/general-helpers/error.ts:16:8)
    at CalendarSettings.save (lib/database/models/calendar-settings.ts:86:23)
    at async POST (app/api/onboarding/create-business/route.ts:317:25)
  14 |   } : {};
  15 |   console.error(message, errorDetails);
> 16 |   throw new ModelError(message, error);
     |        ^
  17 | }  {
  originalError: [Object]
}
[Onboarding] Calendar settings error details: {
  error: 'Failed to save calendar settings',
  stack: 'ModelError: Failed to save calendar settings\n' +
    '    at handleModelError (webpack-internal:///(rsc)/./lib/general-helpers/error.ts:20:11)\n' +
    '    at CalendarSettings.save (webpack-internal:///(rsc)/./lib/database/models/calendar-settings.ts:39:89)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
    '    at async POST (webpack-internal:///(rsc)/./app/api/onboarding/create-business/route.ts:303:36)\n' +
    '    at async AppRouteRouteModule.do (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:34112)\n' +
    '    at async AppRouteRouteModule.handle (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:41338)\n' +
    '    at async doRender (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:1513:42)\n' +
    '    at async DevServer.renderToResponseWithComponentsImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:1915:28)\n' +
    '    at async DevServer.renderPageComponent (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:2403:24)\n' +
    '    at async DevServer.renderToResponseImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:2440:32)\n' +
    '    at async DevServer.pipeImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:1007:25)\n' +
    '    at async NextNodeServer.handleCatchallRenderRequest (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/next-server.js:305:17)\n' +
    '    at async DevServer.handleRequestImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:899:17)\n' +
    '    at async /Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/dev/next-dev-server.js:371:20\n' +
    '    at async Span.traceAsyncFn (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/trace/trace.js:157:20)\n' +
    '    at async DevServer.handleRequest (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/dev/next-dev-server.js:368:24)\n' +
    '    at async invokeRender (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/router-server.js:237:21)\n' +
    '    at async handleRequest (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/router-server.js:428:24)\n' +
    '    at async requestHandlerImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/router-server.js:452:13)\n' +
    '    at async Server.requestListener (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/start-server.js:158:13)',
  providers: 1,
  businessId: 'ff396342-7669-4ca5-9e73-db7be188f417'
}
[Onboarding] Generating initial aggregated availability...
ProviderCalendarSettings.getByBusiness {
  message: 'relation "public.provider_calendar_settings" does not exist',
  details: null,
  code: '42P01',
  hint: null
}
[Onboarding] Error generating initial availability: Error [ModelError]: ProviderCalendarSettings.getByBusiness
    at handleModelError (lib/general-helpers/error.ts:16:8)
    at ProviderCalendarSettings.getByBusiness (lib/database/models/provider-calendar-settings.ts:126:29)
    at async computeAggregatedAvailability (lib/general-helpers/availability.ts:78:27)
    at async POST (app/api/onboarding/create-business/route.ts:355:32)
  14 |   } : {};
  15 |   console.error(message, errorDetails);
> 16 |   throw new ModelError(message, error);
     |        ^
  17 | }  {
  originalError: [Object]
}
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 2000ms
 ✓ Compiled in 317ms (540 modules)
 ✓ Compiled in 86ms (540 modules)
 ✓ Compiled in 27ms
 ✓ Compiled /api/onboarding/create-business in 187ms (540 modules)
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: a33dbd8a-d61c-4b66-bd18-28b1533c606e
[Onboarding] Creating business...
[Onboarding] Business created with ID: 48eb9fca-b2cf-47d0-907a-eb39a3bdf7df
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'a33dbd8a-d61c-4b66-bd18-28b1533c606e',
  firstName: 'John',
  lastName: 'Doe',
  role: 'admin/provider',
  businessId: '48eb9fca-b2cf-47d0-907a-eb39a3bdf7df',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000001',
  whatsAppNumberNormalized: '61400000002'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: a33dbd8a-d61c-4b66-bd18-28b1533c606e
[Onboarding] Successfully created 1 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: John Doe (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: 'a33dbd8a-d61c-4b66-bd18-28b1533c606e',
  businessId: '48eb9fca-b2cf-47d0-907a-eb39a3bdf7df',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  timezone: 'Australia/Sydney',
  manageCalendar: false
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
Failed to save calendar settings {
  message: "Could not find the 'timezone' column of 'calendarSettings' in the schema cache",
  details: null,
  code: 'PGRST204',
  hint: null
}
[Onboarding] Error creating calendar settings: Error [ModelError]: Failed to save calendar settings
    at handleModelError (lib/general-helpers/error.ts:16:8)
    at CalendarSettings.save (lib/database/models/calendar-settings.ts:79:23)
    at async POST (app/api/onboarding/create-business/route.ts:317:25)
  14 |   } : {};
  15 |   console.error(message, errorDetails);
> 16 |   throw new ModelError(message, error);
     |        ^
  17 | }  {
  originalError: [Object]
}
[Onboarding] Calendar settings error details: {
  error: 'Failed to save calendar settings',
  stack: 'ModelError: Failed to save calendar settings\n' +
    '    at handleModelError (webpack-internal:///(rsc)/./lib/general-helpers/error.ts:20:11)\n' +
    '    at CalendarSettings.save (webpack-internal:///(rsc)/./lib/database/models/calendar-settings.ts:34:89)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
    '    at async POST (webpack-internal:///(rsc)/./app/api/onboarding/create-business/route.ts:303:36)\n' +
    '    at async AppRouteRouteModule.do (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:34112)\n' +
    '    at async AppRouteRouteModule.handle (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:41338)\n' +
    '    at async doRender (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:1513:42)\n' +
    '    at async DevServer.renderToResponseWithComponentsImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:1915:28)\n' +
    '    at async DevServer.renderPageComponent (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:2403:24)\n' +
    '    at async DevServer.renderToResponseImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:2440:32)\n' +
    '    at async DevServer.pipeImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:1007:25)\n' +
    '    at async NextNodeServer.handleCatchallRenderRequest (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/next-server.js:305:17)\n' +
    '    at async DevServer.handleRequestImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:899:17)\n' +
    '    at async /Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/dev/next-dev-server.js:371:20\n' +
    '    at async Span.traceAsyncFn (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/trace/trace.js:157:20)\n' +
    '    at async DevServer.handleRequest (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/dev/next-dev-server.js:368:24)\n' +
    '    at async invokeRender (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/router-server.js:237:21)\n' +
    '    at async handleRequest (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/router-server.js:428:24)\n' +
    '    at async requestHandlerImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/router-server.js:452:13)\n' +
    '    at async Server.requestListener (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/start-server.js:158:13)',
  providers: 1,
  businessId: '48eb9fca-b2cf-47d0-907a-eb39a3bdf7df'
}
[Onboarding] Generating initial aggregated availability...
ProviderCalendarSettings.getByBusiness {
  message: 'relation "public.provider_calendar_settings" does not exist',
  details: null,
  code: '42P01',
  hint: null
}
[Onboarding] Error generating initial availability: Error [ModelError]: ProviderCalendarSettings.getByBusiness
    at handleModelError (lib/general-helpers/error.ts:16:8)
    at ProviderCalendarSettings.getByBusiness (lib/database/models/provider-calendar-settings.ts:126:29)
    at async computeAggregatedAvailability (lib/general-helpers/availability.ts:78:27)
    at async POST (app/api/onboarding/create-business/route.ts:355:32)
  14 |   } : {};
  15 |   console.error(message, errorDetails);
> 16 |   throw new ModelError(message, error);
     |        ^
  17 | }  {
  originalError: [Object]
}
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 1485ms
 ✓ Compiled in 157ms (540 modules)
 ✓ Compiled in 219ms (540 modules)
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: 5a06b758-bb4c-4ad7-9385-c7c03fecae08
[Onboarding] Creating business...
[Onboarding] Business created with ID: 3680d4ef-b13d-4d16-a6b0-090b8768adb2
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: '5a06b758-bb4c-4ad7-9385-c7c03fecae08',
  firstName: 'John',
  lastName: 'Doe',
  role: 'admin/provider',
  businessId: '3680d4ef-b13d-4d16-a6b0-090b8768adb2',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000001',
  whatsAppNumberNormalized: '61400000002'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: 5a06b758-bb4c-4ad7-9385-c7c03fecae08
[Onboarding] Successfully created 1 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: John Doe (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: '5a06b758-bb4c-4ad7-9385-c7c03fecae08',
  businessId: '3680d4ef-b13d-4d16-a6b0-090b8768adb2',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
Failed to save calendar settings {
  message: 'null value in column "settings" of relation "calendarSettings" violates not-null constraint',
  details: 'Failing row contains (521f0837-fea4-4c30-8759-61f089ba5242, 2025-07-23 03:57:05.733335+00, 2025-07-23 03:57:05.703+00, 5a06b758-bb4c-4ad7-9385-c7c03fecae08, 3680d4ef-b13d-4d16-a6b0-090b8768adb2, null, null, null, {"fri": {"end": "17:00", "start": "09:00"}, "mon": {"end": "17:0...).',
  code: '23502',
  hint: null
}
[Onboarding] Error creating calendar settings: Error [ModelError]: Failed to save calendar settings
    at handleModelError (lib/general-helpers/error.ts:16:8)
    at CalendarSettings.save (lib/database/models/calendar-settings.ts:78:23)
    at async POST (app/api/onboarding/create-business/route.ts:316:25)
  14 |   } : {};
  15 |   console.error(message, errorDetails);
> 16 |   throw new ModelError(message, error);
     |        ^
  17 | }  {
  originalError: [Object]
}
[Onboarding] Calendar settings error details: {
  error: 'Failed to save calendar settings',
  stack: 'ModelError: Failed to save calendar settings\n' +
    '    at handleModelError (webpack-internal:///(rsc)/./lib/general-helpers/error.ts:20:11)\n' +
    '    at CalendarSettings.save (webpack-internal:///(rsc)/./lib/database/models/calendar-settings.ts:33:89)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
    '    at async POST (webpack-internal:///(rsc)/./app/api/onboarding/create-business/route.ts:302:36)\n' +
    '    at async AppRouteRouteModule.do (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:34112)\n' +
    '    at async AppRouteRouteModule.handle (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:41338)\n' +
    '    at async doRender (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:1513:42)\n' +
    '    at async DevServer.renderToResponseWithComponentsImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:1915:28)\n' +
    '    at async DevServer.renderPageComponent (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:2403:24)\n' +
    '    at async DevServer.renderToResponseImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:2440:32)\n' +
    '    at async DevServer.pipeImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:1007:25)\n' +
    '    at async NextNodeServer.handleCatchallRenderRequest (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/next-server.js:305:17)\n' +
    '    at async DevServer.handleRequestImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:899:17)\n' +
    '    at async /Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/dev/next-dev-server.js:371:20\n' +
    '    at async Span.traceAsyncFn (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/trace/trace.js:157:20)\n' +
    '    at async DevServer.handleRequest (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/dev/next-dev-server.js:368:24)\n' +
    '    at async invokeRender (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/router-server.js:237:21)\n' +
    '    at async handleRequest (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/router-server.js:428:24)\n' +
    '    at async requestHandlerImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/router-server.js:452:13)\n' +
    '    at async Server.requestListener (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/start-server.js:158:13)',
  providers: 1,
  businessId: '3680d4ef-b13d-4d16-a6b0-090b8768adb2'
}
[Onboarding] Generating initial aggregated availability...
ProviderCalendarSettings.getByBusiness {
  message: 'relation "public.provider_calendar_settings" does not exist',
  details: null,
  code: '42P01',
  hint: null
}
[Onboarding] Error generating initial availability: Error [ModelError]: ProviderCalendarSettings.getByBusiness
    at handleModelError (lib/general-helpers/error.ts:16:8)
    at ProviderCalendarSettings.getByBusiness (lib/database/models/provider-calendar-settings.ts:126:29)
    at async computeAggregatedAvailability (lib/general-helpers/availability.ts:78:27)
    at async POST (app/api/onboarding/create-business/route.ts:354:32)
  14 |   } : {};
  15 |   console.error(message, errorDetails);
> 16 |   throw new ModelError(message, error);
     |        ^
  17 | }  {
  originalError: [Object]
}
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 1195ms
 ✓ Compiled in 27ms
 ⨯ ./lib/general-helpers/availability.ts
Module parse failed: Identifier 'CalendarSettings' has already been declared (4:9)
| import { Booking } from "../database/models/booking";
| import { AvailabilitySlots } from "../database/models/availability-slots";
> import { CalendarSettings } from "../database/models/calendar-settings";
| import { DateTime } from "luxon";
| import { Quote } from "../database/models/quote";

Import trace for requested module:
./lib/general-helpers/availability.ts
./app/api/onboarding/create-business/route.ts
 ○ Compiling /_not-found ...
 ⨯ ./lib/general-helpers/availability.ts
Module parse failed: Identifier 'CalendarSettings' has already been declared (4:9)
| import { Booking } from "../database/models/booking";
| import { AvailabilitySlots } from "../database/models/availability-slots";
> import { CalendarSettings } from "../database/models/calendar-settings";
| import { DateTime } from "luxon";
| import { Quote } from "../database/models/quote";

Import trace for requested module:
./lib/general-helpers/availability.ts
./app/api/onboarding/create-business/route.ts
 ✓ Compiled /_not-found in 343ms (855 modules)
 ○ Compiling /_error ...
 ⨯ ./lib/general-helpers/availability.ts
Module parse failed: Identifier 'CalendarSettings' has already been declared (4:9)
| import { Booking } from "../database/models/booking";
| import { AvailabilitySlots } from "../database/models/availability-slots";
> import { CalendarSettings } from "../database/models/calendar-settings";
| import { DateTime } from "luxon";
| import { Quote } from "../database/models/quote";

Import trace for requested module:
./lib/general-helpers/availability.ts
./app/api/onboarding/create-business/route.ts
 POST /api/onboarding/create-business 500 in 4878ms
 POST /api/onboarding/create-business 500 in 9ms
 POST /api/onboarding/create-business 500 in 219ms
 POST /api/onboarding/create-business 500 in 6ms
 POST /api/onboarding/create-business 500 in 7ms
 POST /api/onboarding/create-business 500 in 13ms
 ✓ Compiled /_error in 592ms (1418 modules)
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: c458f0c0-ff43-4ef8-823b-76cceec32452
[Onboarding] Creating business...
[Onboarding] Business created with ID: 0764a7a1-52f6-4910-8c0b-1b692fbf9783
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'c458f0c0-ff43-4ef8-823b-76cceec32452',
  firstName: 'John',
  lastName: 'Doe',
  role: 'admin/provider',
  businessId: '0764a7a1-52f6-4910-8c0b-1b692fbf9783',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000001',
  whatsAppNumberNormalized: '61400000002'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: c458f0c0-ff43-4ef8-823b-76cceec32452
[Onboarding] Successfully created 1 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: John Doe (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: 'c458f0c0-ff43-4ef8-823b-76cceec32452',
  businessId: '0764a7a1-52f6-4910-8c0b-1b692fbf9783',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
Failed to save calendar settings {
  message: 'null value in column "settings" of relation "calendarSettings" violates not-null constraint',
  details: 'Failing row contains (a2a00421-2e06-45c7-aa2c-d874902bee9f, 2025-07-23 04:33:43.791539+00, 2025-07-23 04:33:43.751+00, c458f0c0-ff43-4ef8-823b-76cceec32452, 0764a7a1-52f6-4910-8c0b-1b692fbf9783, null, null, null, {"fri": {"end": "17:00", "start": "09:00"}, "mon": {"end": "17:0...).',
  code: '23502',
  hint: null
}
[Onboarding] Error creating calendar settings: Error [ModelError]: Failed to save calendar settings
    at handleModelError (lib/general-helpers/error.ts:16:8)
    at CalendarSettings.save (lib/database/models/calendar-settings.ts:78:23)
    at async POST (app/api/onboarding/create-business/route.ts:317:25)
  14 |   } : {};
  15 |   console.error(message, errorDetails);
> 16 |   throw new ModelError(message, error);
     |        ^
  17 | }  {
  originalError: [Object]
}
[Onboarding] Calendar settings error details: {
  error: 'Failed to save calendar settings',
  stack: 'ModelError: Failed to save calendar settings\n' +
    '    at handleModelError (webpack-internal:///(rsc)/./lib/general-helpers/error.ts:20:11)\n' +
    '    at CalendarSettings.save (webpack-internal:///(rsc)/./lib/database/models/calendar-settings.ts:33:89)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
    '    at async POST (webpack-internal:///(rsc)/./app/api/onboarding/create-business/route.ts:303:36)\n' +
    '    at async AppRouteRouteModule.do (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:34112)\n' +
    '    at async AppRouteRouteModule.handle (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:41338)\n' +
    '    at async doRender (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:1513:42)\n' +
    '    at async DevServer.renderToResponseWithComponentsImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:1915:28)\n' +
    '    at async DevServer.renderPageComponent (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:2403:24)\n' +
    '    at async DevServer.renderToResponseImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:2440:32)\n' +
    '    at async DevServer.pipeImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:1007:25)\n' +
    '    at async NextNodeServer.handleCatchallRenderRequest (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/next-server.js:305:17)\n' +
    '    at async DevServer.handleRequestImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:899:17)\n' +
    '    at async /Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/dev/next-dev-server.js:371:20\n' +
    '    at async Span.traceAsyncFn (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/trace/trace.js:157:20)\n' +
    '    at async DevServer.handleRequest (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/dev/next-dev-server.js:368:24)\n' +
    '    at async invokeRender (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/router-server.js:237:21)\n' +
    '    at async handleRequest (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/router-server.js:428:24)\n' +
    '    at async requestHandlerImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/router-server.js:452:13)\n' +
    '    at async Server.requestListener (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/start-server.js:158:13)',
  providers: 1,
  businessId: '0764a7a1-52f6-4910-8c0b-1b692fbf9783'
}
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] No providers found for business 0764a7a1-52f6-4910-8c0b-1b692fbf9783
[Onboarding] Generated 0 days of aggregated availability
[Onboarding] Successfully saved 0 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 1202ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: f53b44a4-05eb-4035-a9fe-7f7d344f028b
[Onboarding] Creating business...
[Onboarding] Business created with ID: a93dd5a6-552e-48c1-9e9f-777fe9cef464
[Onboarding] Creating owner user profile with role: admin
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'f53b44a4-05eb-4035-a9fe-7f7d344f028b',
  firstName: 'Jane',
  lastName: 'Smith',
  role: 'admin',
  businessId: 'a93dd5a6-552e-48c1-9e9f-777fe9cef464',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000003',
  whatsAppNumberNormalized: '61400000004'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: f53b44a4-05eb-4035-a9fe-7f7d344f028b
[Onboarding] Creating provider 2: Provider 2
[Onboarding] Failed to create auth user for provider 2: Error [AuthApiError]: A user with this email address has already been registered
    at async POST (app/api/onboarding/create-business/route.ts:167:69)
  165 |         
  166 |         // Create auth user for this provider
> 167 |         const { data: providerAuthData, error: providerAuthError } = await adminSupa.auth.admin.createUser({
      |                                                                     ^
  168 |           email: providerEmail,
  169 |           password: tempPassword,
  170 |           email_confirm: true, {
  __isAuthError: true,
  status: 422,
  code: 'email_exists'
}
[Onboarding] Error creating additional providers: Error: Failed to create provider 2 auth account
    at POST (app/api/onboarding/create-business/route.ts:183:16)
  181 |         if (providerAuthError || !providerAuthData.user) {
  182 |           console.error(`[Onboarding] Failed to create auth user for provider ${i + 1}:`, providerAuthError);
> 183 |           throw new Error(`Failed to create provider ${i + 1} auth account`);
      |                ^
  184 |         }
  185 |
  186 |         createdAuthUsers.push(providerAuthData.user.id);
[Environment] Using development environment for server client
 POST /api/onboarding/create-business 500 in 605ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: ac934ee8-3858-4ced-8e3b-03ce3f9f0d40
[Onboarding] Creating business...
[Onboarding] Business created with ID: dda3d8bf-aa14-43a7-9920-9433ff0503e0
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'ac934ee8-3858-4ced-8e3b-03ce3f9f0d40',
  firstName: 'Mike',
  lastName: 'Wilson',
  role: 'admin/provider',
  businessId: 'dda3d8bf-aa14-43a7-9920-9433ff0503e0',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000005',
  whatsAppNumberNormalized: '61400000006'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: ac934ee8-3858-4ced-8e3b-03ce3f9f0d40
[Onboarding] Creating provider 2: Provider 2
[Onboarding] Failed to create auth user for provider 2: Error [AuthApiError]: A user with this email address has already been registered
    at async POST (app/api/onboarding/create-business/route.ts:167:69)
  165 |         
  166 |         // Create auth user for this provider
> 167 |         const { data: providerAuthData, error: providerAuthError } = await adminSupa.auth.admin.createUser({
      |                                                                     ^
  168 |           email: providerEmail,
  169 |           password: tempPassword,
  170 |           email_confirm: true, {
  __isAuthError: true,
  status: 422,
  code: 'email_exists'
}
[Onboarding] Error creating additional providers: Error: Failed to create provider 2 auth account
    at POST (app/api/onboarding/create-business/route.ts:183:16)
  181 |         if (providerAuthError || !providerAuthData.user) {
  182 |           console.error(`[Onboarding] Failed to create auth user for provider ${i + 1}:`, providerAuthError);
> 183 |           throw new Error(`Failed to create provider ${i + 1} auth account`);
      |                ^
  184 |         }
  185 |
  186 |         createdAuthUsers.push(providerAuthData.user.id);
[Environment] Using development environment for server client
 POST /api/onboarding/create-business 500 in 620ms
[Environment] Using development environment for service-role client
 POST /api/onboarding/create-business 400 in 11ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: 044cd9f9-2366-46e9-97aa-71ca57b1c553
[Onboarding] Creating business...
[Onboarding] Business created with ID: 74f462ae-e424-4d64-b659-f91123470800
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: '044cd9f9-2366-46e9-97aa-71ca57b1c553',
  firstName: 'John',
  lastName: 'Doe',
  role: 'admin/provider',
  businessId: '74f462ae-e424-4d64-b659-f91123470800',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000005',
  whatsAppNumberNormalized: '61400000006'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: 044cd9f9-2366-46e9-97aa-71ca57b1c553
[Onboarding] Successfully created 1 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: John Doe (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: '044cd9f9-2366-46e9-97aa-71ca57b1c553',
  businessId: '74f462ae-e424-4d64-b659-f91123470800',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
Failed to save calendar settings {
  message: 'null value in column "settings" of relation "calendarSettings" violates not-null constraint',
  details: 'Failing row contains (9afae22f-8b88-4a33-81df-4b3473b057ad, 2025-07-23 04:33:48.387402+00, 2025-07-23 04:33:48.36+00, 044cd9f9-2366-46e9-97aa-71ca57b1c553, 74f462ae-e424-4d64-b659-f91123470800, null, null, null, {"fri": {"end": "17:00", "start": "09:00"}, "mon": {"end": "17:0...).',
  code: '23502',
  hint: null
}
[Onboarding] Error creating calendar settings: Error [ModelError]: Failed to save calendar settings
    at handleModelError (lib/general-helpers/error.ts:16:8)
    at CalendarSettings.save (lib/database/models/calendar-settings.ts:78:23)
    at async POST (app/api/onboarding/create-business/route.ts:317:25)
  14 |   } : {};
  15 |   console.error(message, errorDetails);
> 16 |   throw new ModelError(message, error);
     |        ^
  17 | }  {
  originalError: [Object]
}
[Onboarding] Calendar settings error details: {
  error: 'Failed to save calendar settings',
  stack: 'ModelError: Failed to save calendar settings\n' +
    '    at handleModelError (webpack-internal:///(rsc)/./lib/general-helpers/error.ts:20:11)\n' +
    '    at CalendarSettings.save (webpack-internal:///(rsc)/./lib/database/models/calendar-settings.ts:33:89)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
    '    at async POST (webpack-internal:///(rsc)/./app/api/onboarding/create-business/route.ts:303:36)\n' +
    '    at async AppRouteRouteModule.do (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:34112)\n' +
    '    at async AppRouteRouteModule.handle (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:41338)\n' +
    '    at async doRender (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:1513:42)\n' +
    '    at async DevServer.renderToResponseWithComponentsImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:1915:28)\n' +
    '    at async DevServer.renderPageComponent (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:2403:24)\n' +
    '    at async DevServer.renderToResponseImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:2440:32)\n' +
    '    at async DevServer.pipeImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:1007:25)\n' +
    '    at async NextNodeServer.handleCatchallRenderRequest (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/next-server.js:305:17)\n' +
    '    at async DevServer.handleRequestImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:899:17)\n' +
    '    at async /Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/dev/next-dev-server.js:371:20\n' +
    '    at async Span.traceAsyncFn (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/trace/trace.js:157:20)\n' +
    '    at async DevServer.handleRequest (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/dev/next-dev-server.js:368:24)\n' +
    '    at async invokeRender (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/router-server.js:237:21)\n' +
    '    at async handleRequest (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/router-server.js:428:24)\n' +
    '    at async requestHandlerImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/router-server.js:452:13)\n' +
    '    at async Server.requestListener (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/start-server.js:158:13)',
  providers: 1,
  businessId: '74f462ae-e424-4d64-b659-f91123470800'
}
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] No providers found for business 74f462ae-e424-4d64-b659-f91123470800
[Onboarding] Generated 0 days of aggregated availability
[Onboarding] Successfully saved 0 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 864ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Auth user creation failed: Error [AuthApiError]: A user with this email address has already been registered
    at async POST (app/api/onboarding/create-business/route.ts:56:49)
  54 |     // --- Step 1: Create Auth User for Owner ---
  55 |     console.log('[Onboarding] Creating owner auth user...');
> 56 |     const { data: authData, error: authError } = await adminSupa.auth.admin.createUser({
     |                                                 ^
  57 |       email: onboardingData.email,
  58 |       password: onboardingData.password,
  59 |       email_confirm: true, {
  __isAuthError: true,
  status: 422,
  code: 'email_exists'
}
 POST /api/onboarding/create-business 400 in 93ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: f3c5e2e9-f340-4ea5-8e3f-a48161924300
[Onboarding] Creating business...
[Onboarding] Business created with ID: 4c918720-6fc2-43c6-9831-9da25e0a0eb6
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'f3c5e2e9-f340-4ea5-8e3f-a48161924300',
  firstName: 'John',
  lastName: 'Doe',
  role: 'admin/provider',
  businessId: '4c918720-6fc2-43c6-9831-9da25e0a0eb6',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000009',
  whatsAppNumberNormalized: '61400000010'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: f3c5e2e9-f340-4ea5-8e3f-a48161924300
[Onboarding] Successfully created 1 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: John Doe (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: 'f3c5e2e9-f340-4ea5-8e3f-a48161924300',
  businessId: '4c918720-6fc2-43c6-9831-9da25e0a0eb6',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
Failed to save calendar settings {
  message: 'null value in column "settings" of relation "calendarSettings" violates not-null constraint',
  details: 'Failing row contains (ca3c3e80-e1a0-4941-b02c-ca8ff84f6530, 2025-07-23 04:33:50.082184+00, 2025-07-23 04:33:50.045+00, f3c5e2e9-f340-4ea5-8e3f-a48161924300, 4c918720-6fc2-43c6-9831-9da25e0a0eb6, null, null, null, {"fri": {"end": "17:00", "start": "09:00"}, "mon": {"end": "17:0...).',
  code: '23502',
  hint: null
}
[Onboarding] Error creating calendar settings: Error [ModelError]: Failed to save calendar settings
    at handleModelError (lib/general-helpers/error.ts:16:8)
    at CalendarSettings.save (lib/database/models/calendar-settings.ts:78:23)
    at async POST (app/api/onboarding/create-business/route.ts:317:25)
  14 |   } : {};
  15 |   console.error(message, errorDetails);
> 16 |   throw new ModelError(message, error);
     |        ^
  17 | }  {
  originalError: [Object]
}
[Onboarding] Calendar settings error details: {
  error: 'Failed to save calendar settings',
  stack: 'ModelError: Failed to save calendar settings\n' +
    '    at handleModelError (webpack-internal:///(rsc)/./lib/general-helpers/error.ts:20:11)\n' +
    '    at CalendarSettings.save (webpack-internal:///(rsc)/./lib/database/models/calendar-settings.ts:33:89)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
    '    at async POST (webpack-internal:///(rsc)/./app/api/onboarding/create-business/route.ts:303:36)\n' +
    '    at async AppRouteRouteModule.do (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:34112)\n' +
    '    at async AppRouteRouteModule.handle (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:41338)\n' +
    '    at async doRender (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:1513:42)\n' +
    '    at async DevServer.renderToResponseWithComponentsImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:1915:28)\n' +
    '    at async DevServer.renderPageComponent (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:2403:24)\n' +
    '    at async DevServer.renderToResponseImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:2440:32)\n' +
    '    at async DevServer.pipeImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:1007:25)\n' +
    '    at async NextNodeServer.handleCatchallRenderRequest (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/next-server.js:305:17)\n' +
    '    at async DevServer.handleRequestImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:899:17)\n' +
    '    at async /Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/dev/next-dev-server.js:371:20\n' +
    '    at async Span.traceAsyncFn (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/trace/trace.js:157:20)\n' +
    '    at async DevServer.handleRequest (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/dev/next-dev-server.js:368:24)\n' +
    '    at async invokeRender (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/router-server.js:237:21)\n' +
    '    at async handleRequest (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/router-server.js:428:24)\n' +
    '    at async requestHandlerImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/router-server.js:452:13)\n' +
    '    at async Server.requestListener (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/start-server.js:158:13)',
  providers: 1,
  businessId: '4c918720-6fc2-43c6-9831-9da25e0a0eb6'
}
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] No providers found for business 4c918720-6fc2-43c6-9831-9da25e0a0eb6
[Onboarding] Generated 0 days of aggregated availability
[Onboarding] Successfully saved 0 availability slot records
[Onboarding] Creating Stripe Connect account...
[Environment] Using development environment for server client
[DEBUG] NODE_ENV: development
[DEBUG] All env keys count: 134
[DEBUG] Available env vars starting with STRIPE: [ 'STRIPE_SECRET_KEY', 'STRIPE_WEBHOOK_SECRET' ]
[DEBUG] Available env vars starting with NEXT: [
  'NEXT_RUNTIME',
  'NEXT_PRIVATE_WORKER',
  'NEXT_PRIVATE_TRACE_ID',
  'NEXT_PUBLIC_SUPABASE_URL',
  'NEXT_PUBLIC_SUPABASE_ANON_KEY',
  'NEXT_PUBLIC_SITE_URL',
  'NEXT_DEPLOYMENT_ID'
]
[DEBUG] STRIPE_SECRET_KEY exists: true
[DEBUG] STRIPE_SECRET_KEY length: 107
[DEBUG] STRIPE_SECRET_KEY value preview: sk_test_51...
[DEBUG] STRIPE_SECRET_KEY typeof: string
[DEBUG] STRIPE_SECRET_KEY raw value check: "sk_test_51Rd4eYP4p95"
[DEBUG] Creating Stripe instance with key length: 107
[DEBUG] Key starts with sk_: true
[DEBUG] Stripe instance created successfully
[Environment] Using development environment for service-role client
[Onboarding] Stripe account created: acct_1RnuNG03w1jDn8Ff
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 3736ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: 0c64b925-b86a-4bc5-bd81-9bc18d2b234d
[Onboarding] Creating business...
[Onboarding] Business created with ID: e4a3b07f-530f-45ad-8e7b-fc88a801813c
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: '0c64b925-b86a-4bc5-bd81-9bc18d2b234d',
  firstName: 'John',
  lastName: 'Doe',
  role: 'admin/provider',
  businessId: 'e4a3b07f-530f-45ad-8e7b-fc88a801813c',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000001',
  whatsAppNumberNormalized: '61400000002'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: 0c64b925-b86a-4bc5-bd81-9bc18d2b234d
[Onboarding] Successfully created 1 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: John Doe (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: '0c64b925-b86a-4bc5-bd81-9bc18d2b234d',
  businessId: 'e4a3b07f-530f-45ad-8e7b-fc88a801813c',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
Failed to save calendar settings {
  message: 'null value in column "settings" of relation "calendarSettings" violates not-null constraint',
  details: 'Failing row contains (fd771b0a-1898-40e7-a831-6e0b6bf545bb, 2025-07-23 04:34:39.91832+00, 2025-07-23 04:34:39.884+00, 0c64b925-b86a-4bc5-bd81-9bc18d2b234d, e4a3b07f-530f-45ad-8e7b-fc88a801813c, null, null, null, {"fri": {"end": "17:00", "start": "09:00"}, "mon": {"end": "17:0...).',
  code: '23502',
  hint: null
}
[Onboarding] Error creating calendar settings: Error [ModelError]: Failed to save calendar settings
    at handleModelError (lib/general-helpers/error.ts:16:8)
    at CalendarSettings.save (lib/database/models/calendar-settings.ts:78:23)
    at async POST (app/api/onboarding/create-business/route.ts:317:25)
  14 |   } : {};
  15 |   console.error(message, errorDetails);
> 16 |   throw new ModelError(message, error);
     |        ^
  17 | }  {
  originalError: [Object]
}
[Onboarding] Calendar settings error details: {
  error: 'Failed to save calendar settings',
  stack: 'ModelError: Failed to save calendar settings\n' +
    '    at handleModelError (webpack-internal:///(rsc)/./lib/general-helpers/error.ts:20:11)\n' +
    '    at CalendarSettings.save (webpack-internal:///(rsc)/./lib/database/models/calendar-settings.ts:33:89)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
    '    at async POST (webpack-internal:///(rsc)/./app/api/onboarding/create-business/route.ts:303:36)\n' +
    '    at async AppRouteRouteModule.do (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:34112)\n' +
    '    at async AppRouteRouteModule.handle (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:41338)\n' +
    '    at async doRender (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:1513:42)\n' +
    '    at async DevServer.renderToResponseWithComponentsImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:1915:28)\n' +
    '    at async DevServer.renderPageComponent (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:2403:24)\n' +
    '    at async DevServer.renderToResponseImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:2440:32)\n' +
    '    at async DevServer.pipeImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:1007:25)\n' +
    '    at async NextNodeServer.handleCatchallRenderRequest (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/next-server.js:305:17)\n' +
    '    at async DevServer.handleRequestImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/base-server.js:899:17)\n' +
    '    at async /Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/dev/next-dev-server.js:371:20\n' +
    '    at async Span.traceAsyncFn (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/trace/trace.js:157:20)\n' +
    '    at async DevServer.handleRequest (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/dev/next-dev-server.js:368:24)\n' +
    '    at async invokeRender (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/router-server.js:237:21)\n' +
    '    at async handleRequest (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/router-server.js:428:24)\n' +
    '    at async requestHandlerImpl (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/router-server.js:452:13)\n' +
    '    at async Server.requestListener (/Users/juanbernal/code/mesieou/2025/simple_booking/node_modules/next/dist/server/lib/start-server.js:158:13)',
  providers: 1,
  businessId: 'e4a3b07f-530f-45ad-8e7b-fc88a801813c'
}
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] No providers found for business e4a3b07f-530f-45ad-8e7b-fc88a801813c
[Onboarding] Generated 0 days of aggregated availability
[Onboarding] Successfully saved 0 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 1014ms
 ✓ Compiled in 711ms (1151 modules)
<w> [webpack.cache.PackFileCacheStrategy] Caching failed for pack: Error: ENOENT: no such file or directory, rename '/Users/juanbernal/code/mesieou/2025/simple_booking/.next/cache/webpack/server-development/13.pack.gz_' -> '/Users/juanbernal/code/mesieou/2025/simple_booking/.next/cache/webpack/server-development/13.pack.gz'
 ✓ Compiled in 832ms (1097 modules)
 ✓ Compiled /api/onboarding/create-business in 266ms (585 modules)
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: 6e2ed8ac-2bf9-4311-893b-8047b271ed81
[Onboarding] Creating business...
[Onboarding] Business created with ID: 202f60e9-3b89-42ec-99f1-4f2c77106a6a
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: '6e2ed8ac-2bf9-4311-893b-8047b271ed81',
  firstName: 'John',
  lastName: 'Doe',
  role: 'admin/provider',
  businessId: '202f60e9-3b89-42ec-99f1-4f2c77106a6a',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000001',
  whatsAppNumberNormalized: '61400000002'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: 6e2ed8ac-2bf9-4311-893b-8047b271ed81
[Onboarding] Successfully created 1 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: John Doe (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: '6e2ed8ac-2bf9-4311-893b-8047b271ed81',
  businessId: '202f60e9-3b89-42ec-99f1-4f2c77106a6a',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Sydney' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: '6e2ed8ac-2bf9-4311-893b-8047b271ed81',
    businessId: '202f60e9-3b89-42ec-99f1-4f2c77106a6a',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Sydney', bufferTime: 15 },
    lastSync: undefined
  },
  _id: 'a5635fc0-1a70-4261-a1c0-5143225ab810'
}
[Onboarding] Created calendar settings for John Doe (ID: a5635fc0-1a70-4261-a1c0-5143225ab810)
[Onboarding] Successfully created 1 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 1 providers for business 202f60e9-3b89-42ec-99f1-4f2c77106a6a
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 2728ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: 79c1223c-9d76-4bc9-aca5-780f3ee54a7c
[Onboarding] Creating business...
[Onboarding] Business created with ID: 44fcd6a5-80fa-4e83-8aba-4b5c3e6255d8
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: '79c1223c-9d76-4bc9-aca5-780f3ee54a7c',
  firstName: 'John',
  lastName: 'Doe',
  role: 'admin/provider',
  businessId: '44fcd6a5-80fa-4e83-8aba-4b5c3e6255d8',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000001',
  whatsAppNumberNormalized: '61400000002'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: 79c1223c-9d76-4bc9-aca5-780f3ee54a7c
[Onboarding] Successfully created 1 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: John Doe (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: '79c1223c-9d76-4bc9-aca5-780f3ee54a7c',
  businessId: '44fcd6a5-80fa-4e83-8aba-4b5c3e6255d8',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Sydney' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: '79c1223c-9d76-4bc9-aca5-780f3ee54a7c',
    businessId: '44fcd6a5-80fa-4e83-8aba-4b5c3e6255d8',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Sydney', bufferTime: 15 },
    lastSync: undefined
  },
  _id: 'c2c63743-4453-4ace-8aff-65330e467053'
}
[Onboarding] Created calendar settings for John Doe (ID: c2c63743-4453-4ace-8aff-65330e467053)
[Onboarding] Successfully created 1 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 1 providers for business 44fcd6a5-80fa-4e83-8aba-4b5c3e6255d8
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 2795ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: ffa41dfc-b21a-4083-9453-fbd4f6ca8ef2
[Onboarding] Creating business...
[Onboarding] Business created with ID: f482e227-c015-44fa-b931-9a28a4c191eb
[Onboarding] Creating owner user profile with role: admin
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'ffa41dfc-b21a-4083-9453-fbd4f6ca8ef2',
  firstName: 'Jane',
  lastName: 'Smith',
  role: 'admin',
  businessId: 'f482e227-c015-44fa-b931-9a28a4c191eb',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000003',
  whatsAppNumberNormalized: '61400000004'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: ffa41dfc-b21a-4083-9453-fbd4f6ca8ef2
[Onboarding] Creating provider 2: Provider 2
[Onboarding] Failed to create auth user for provider 2: Error [AuthApiError]: A user with this email address has already been registered
    at async POST (app/api/onboarding/create-business/route.ts:167:69)
  165 |         
  166 |         // Create auth user for this provider
> 167 |         const { data: providerAuthData, error: providerAuthError } = await adminSupa.auth.admin.createUser({
      |                                                                     ^
  168 |           email: providerEmail,
  169 |           password: tempPassword,
  170 |           email_confirm: true, {
  __isAuthError: true,
  status: 422,
  code: 'email_exists'
}
[Onboarding] Error creating additional providers: Error: Failed to create provider 2 auth account
    at POST (app/api/onboarding/create-business/route.ts:183:16)
  181 |         if (providerAuthError || !providerAuthData.user) {
  182 |           console.error(`[Onboarding] Failed to create auth user for provider ${i + 1}:`, providerAuthError);
> 183 |           throw new Error(`Failed to create provider ${i + 1} auth account`);
      |                ^
  184 |         }
  185 |
  186 |         createdAuthUsers.push(providerAuthData.user.id);
[Environment] Using development environment for server client
 POST /api/onboarding/create-business 500 in 710ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: eba6574b-bd08-4b86-b2e8-2ab6387070bc
[Onboarding] Creating business...
[Onboarding] Business created with ID: 04d1f845-1b4a-4e3c-93d2-963a188eb17c
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'eba6574b-bd08-4b86-b2e8-2ab6387070bc',
  firstName: 'Mike',
  lastName: 'Wilson',
  role: 'admin/provider',
  businessId: '04d1f845-1b4a-4e3c-93d2-963a188eb17c',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000005',
  whatsAppNumberNormalized: '61400000006'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: eba6574b-bd08-4b86-b2e8-2ab6387070bc
[Onboarding] Creating provider 2: Provider 2
[Onboarding] Failed to create auth user for provider 2: Error [AuthApiError]: A user with this email address has already been registered
    at async POST (app/api/onboarding/create-business/route.ts:167:69)
  165 |         
  166 |         // Create auth user for this provider
> 167 |         const { data: providerAuthData, error: providerAuthError } = await adminSupa.auth.admin.createUser({
      |                                                                     ^
  168 |           email: providerEmail,
  169 |           password: tempPassword,
  170 |           email_confirm: true, {
  __isAuthError: true,
  status: 422,
  code: 'email_exists'
}
[Onboarding] Error creating additional providers: Error: Failed to create provider 2 auth account
    at POST (app/api/onboarding/create-business/route.ts:183:16)
  181 |         if (providerAuthError || !providerAuthData.user) {
  182 |           console.error(`[Onboarding] Failed to create auth user for provider ${i + 1}:`, providerAuthError);
> 183 |           throw new Error(`Failed to create provider ${i + 1} auth account`);
      |                ^
  184 |         }
  185 |
  186 |         createdAuthUsers.push(providerAuthData.user.id);
[Environment] Using development environment for server client
 POST /api/onboarding/create-business 500 in 702ms
[Environment] Using development environment for service-role client
 POST /api/onboarding/create-business 400 in 9ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: a951d16a-9b6e-4fd3-9cd3-ee4ccbbbf46f
[Onboarding] Creating business...
[Onboarding] Business created with ID: dff8479e-4a59-4b9d-8377-0c6a3218f11d
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'a951d16a-9b6e-4fd3-9cd3-ee4ccbbbf46f',
  firstName: 'John',
  lastName: 'Doe',
  role: 'admin/provider',
  businessId: 'dff8479e-4a59-4b9d-8377-0c6a3218f11d',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000005',
  whatsAppNumberNormalized: '61400000006'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: a951d16a-9b6e-4fd3-9cd3-ee4ccbbbf46f
[Onboarding] Successfully created 1 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: John Doe (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: 'a951d16a-9b6e-4fd3-9cd3-ee4ccbbbf46f',
  businessId: 'dff8479e-4a59-4b9d-8377-0c6a3218f11d',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Sydney' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: 'a951d16a-9b6e-4fd3-9cd3-ee4ccbbbf46f',
    businessId: 'dff8479e-4a59-4b9d-8377-0c6a3218f11d',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Sydney', bufferTime: 15 },
    lastSync: undefined
  },
  _id: 'e43327c3-4983-4b59-9619-ee96939fc0d8'
}
[Onboarding] Created calendar settings for John Doe (ID: e43327c3-4983-4b59-9619-ee96939fc0d8)
[Onboarding] Successfully created 1 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 1 providers for business dff8479e-4a59-4b9d-8377-0c6a3218f11d
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 2702ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Auth user creation failed: Error [AuthApiError]: A user with this email address has already been registered
    at async POST (app/api/onboarding/create-business/route.ts:56:49)
  54 |     // --- Step 1: Create Auth User for Owner ---
  55 |     console.log('[Onboarding] Creating owner auth user...');
> 56 |     const { data: authData, error: authError } = await adminSupa.auth.admin.createUser({
     |                                                 ^
  57 |       email: onboardingData.email,
  58 |       password: onboardingData.password,
  59 |       email_confirm: true, {
  __isAuthError: true,
  status: 422,
  code: 'email_exists'
}
 POST /api/onboarding/create-business 400 in 97ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: 50ed7f76-11ca-4bca-9a3e-0800fa955309
[Onboarding] Creating business...
[Onboarding] Business created with ID: e6123bbd-c5c0-4a33-8234-a173a43ae47f
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: '50ed7f76-11ca-4bca-9a3e-0800fa955309',
  firstName: 'John',
  lastName: 'Doe',
  role: 'admin/provider',
  businessId: 'e6123bbd-c5c0-4a33-8234-a173a43ae47f',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000009',
  whatsAppNumberNormalized: '61400000010'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: 50ed7f76-11ca-4bca-9a3e-0800fa955309
[Onboarding] Successfully created 1 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: John Doe (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: '50ed7f76-11ca-4bca-9a3e-0800fa955309',
  businessId: 'e6123bbd-c5c0-4a33-8234-a173a43ae47f',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Sydney' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: '50ed7f76-11ca-4bca-9a3e-0800fa955309',
    businessId: 'e6123bbd-c5c0-4a33-8234-a173a43ae47f',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Sydney', bufferTime: 15 },
    lastSync: undefined
  },
  _id: '75d593bc-c221-4c0f-89c7-12f4a24a39c8'
}
[Onboarding] Created calendar settings for John Doe (ID: 75d593bc-c221-4c0f-89c7-12f4a24a39c8)
[Onboarding] Successfully created 1 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 1 providers for business e6123bbd-c5c0-4a33-8234-a173a43ae47f
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Creating Stripe Connect account...
[Environment] Using development environment for server client
[DEBUG] NODE_ENV: development
[DEBUG] All env keys count: 134
[DEBUG] Available env vars starting with STRIPE: [ 'STRIPE_SECRET_KEY', 'STRIPE_WEBHOOK_SECRET' ]
[DEBUG] Available env vars starting with NEXT: [
  'NEXT_RUNTIME',
  'NEXT_PRIVATE_WORKER',
  'NEXT_PRIVATE_TRACE_ID',
  'NEXT_PUBLIC_SUPABASE_URL',
  'NEXT_PUBLIC_SUPABASE_ANON_KEY',
  'NEXT_PUBLIC_SITE_URL',
  'NEXT_DEPLOYMENT_ID'
]
[DEBUG] STRIPE_SECRET_KEY exists: true
[DEBUG] STRIPE_SECRET_KEY length: 107
[DEBUG] STRIPE_SECRET_KEY value preview: sk_test_51...
[DEBUG] STRIPE_SECRET_KEY typeof: string
[DEBUG] STRIPE_SECRET_KEY raw value check: "sk_test_51Rd4eYP4p95"
[DEBUG] Creating Stripe instance with key length: 107
[DEBUG] Key starts with sk_: true
[DEBUG] Stripe instance created successfully
[Environment] Using development environment for service-role client
[Onboarding] Stripe account created: acct_1RnuiQP5Bn7XF801
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 5401ms
 ✓ Compiled in 959ms (1097 modules)
 ✓ Compiled in 572ms (1097 modules)
 ✓ Compiled in 286ms (1097 modules)
 ✓ Compiled in 410ms (54 modules)
 ✓ Compiled in 392ms (1097 modules)
 ✓ Compiled in 403ms (1097 modules)
 ✓ Compiled in 557ms (1097 modules)
 ✓ Compiled in 376ms (1097 modules)
 ✓ Compiled in 709ms (1097 modules)
 ✓ Compiled in 460ms (1097 modules)
 ⨯ ./lib/general-helpers/availability.ts
Error: Failed to read source code from /Users/juanbernal/code/mesieou/2025/simple_booking/lib/general-helpers/availability.ts

Caused by:
    No such file or directory (os error 2)

Import trace for requested module:
./lib/general-helpers/availability.ts
./app/api/onboarding/create-business/route.ts
 ⨯ ./lib/general-helpers/availability.ts
Error: Failed to read source code from /Users/juanbernal/code/mesieou/2025/simple_booking/lib/general-helpers/availability.ts

Caused by:
    No such file or directory (os error 2)

Import trace for requested module:
./lib/general-helpers/availability.ts
./app/api/onboarding/create-business/route.ts
 ⨯ ./lib/general-helpers/availability.ts
Error: Failed to read source code from /Users/juanbernal/code/mesieou/2025/simple_booking/lib/general-helpers/availability.ts

Caused by:
    No such file or directory (os error 2)

Import trace for requested module:
./lib/general-helpers/availability.ts
./app/api/onboarding/create-business/route.ts
 ○ Compiling /_not-found ...
 ⨯ ./lib/general-helpers/availability.ts
Error: Failed to read source code from /Users/juanbernal/code/mesieou/2025/simple_booking/lib/general-helpers/availability.ts

Caused by:
    No such file or directory (os error 2)

Import trace for requested module:
./lib/general-helpers/availability.ts
./app/api/onboarding/create-business/route.ts
 ⨯ ./lib/general-helpers/availability.ts
Error: Failed to read source code from /Users/juanbernal/code/mesieou/2025/simple_booking/lib/general-helpers/availability.ts

Caused by:
    No such file or directory (os error 2)

Import trace for requested module:
./lib/general-helpers/availability.ts
./app/api/onboarding/create-business/route.ts
 POST /api/onboarding/create-business 500 in 2053ms
 POST /api/onboarding/create-business 500 in 6ms
 POST /api/onboarding/create-business 500 in 5ms
 POST /api/onboarding/create-business 500 in 5ms
 POST /api/onboarding/create-business 500 in 4ms
 POST /api/onboarding/create-business 500 in 6ms
 POST /api/onboarding/create-business 500 in 34ms
 ✓ Compiled /_error in 752ms (2523 modules)
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: f5e6fbc7-c625-4fda-91cb-bffe5540ef2f
[Onboarding] Creating business...
[Onboarding] Business created with ID: 60dfc231-344a-426d-949c-5f93a67e045b
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'f5e6fbc7-c625-4fda-91cb-bffe5540ef2f',
  firstName: 'John',
  lastName: 'Doe',
  role: 'admin/provider',
  businessId: '60dfc231-344a-426d-949c-5f93a67e045b',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000001',
  whatsAppNumberNormalized: '61400000002'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: f5e6fbc7-c625-4fda-91cb-bffe5540ef2f
[Onboarding] Successfully created 1 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: John Doe (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: 'f5e6fbc7-c625-4fda-91cb-bffe5540ef2f',
  businessId: '60dfc231-344a-426d-949c-5f93a67e045b',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Sydney' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: 'f5e6fbc7-c625-4fda-91cb-bffe5540ef2f',
    businessId: '60dfc231-344a-426d-949c-5f93a67e045b',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Sydney', bufferTime: 15 },
    lastSync: undefined
  },
  _id: 'f5c6480c-6416-4f6a-ba20-ae3e5093c9af'
}
[Onboarding] Created calendar settings for John Doe (ID: f5c6480c-6416-4f6a-ba20-ae3e5093c9af)
[Onboarding] Successfully created 1 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 1 providers for business 60dfc231-344a-426d-949c-5f93a67e045b
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 3161ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: 0a400879-0b14-453f-b3a6-932068cb5735
[Onboarding] Creating business...
[Onboarding] Business created with ID: 276b132f-244a-4e2f-9abb-decffcd4a46b
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: '0a400879-0b14-453f-b3a6-932068cb5735',
  firstName: 'John',
  lastName: 'Doe',
  role: 'admin/provider',
  businessId: '276b132f-244a-4e2f-9abb-decffcd4a46b',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000001',
  whatsAppNumberNormalized: '61400000002'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: 0a400879-0b14-453f-b3a6-932068cb5735
[Onboarding] Successfully created 1 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: John Doe (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: '0a400879-0b14-453f-b3a6-932068cb5735',
  businessId: '276b132f-244a-4e2f-9abb-decffcd4a46b',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Sydney' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: '0a400879-0b14-453f-b3a6-932068cb5735',
    businessId: '276b132f-244a-4e2f-9abb-decffcd4a46b',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Sydney', bufferTime: 15 },
    lastSync: undefined
  },
  _id: '46e72e16-25f0-49af-a39c-fbc8f13a0853'
}
[Onboarding] Created calendar settings for John Doe (ID: 46e72e16-25f0-49af-a39c-fbc8f13a0853)
[Onboarding] Successfully created 1 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 1 providers for business 276b132f-244a-4e2f-9abb-decffcd4a46b
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 2538ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: 9b6660c4-b252-4409-94a5-eac7e516ac85
[Onboarding] Creating business...
[Onboarding] Business created with ID: bf860b16-4ad4-4020-952a-7e90a747d165
[Onboarding] Creating owner user profile with role: admin
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: '9b6660c4-b252-4409-94a5-eac7e516ac85',
  firstName: 'Jane',
  lastName: 'Smith',
  role: 'admin',
  businessId: 'bf860b16-4ad4-4020-952a-7e90a747d165',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000003',
  whatsAppNumberNormalized: '61400000004'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: 9b6660c4-b252-4409-94a5-eac7e516ac85
[Onboarding] Creating provider 2: Provider 2
[Onboarding] Failed to create auth user for provider 2: Error [AuthApiError]: A user with this email address has already been registered
    at async POST (app/api/onboarding/create-business/route.ts:167:69)
  165 |         
  166 |         // Create auth user for this provider
> 167 |         const { data: providerAuthData, error: providerAuthError } = await adminSupa.auth.admin.createUser({
      |                                                                     ^
  168 |           email: providerEmail,
  169 |           password: tempPassword,
  170 |           email_confirm: true, {
  __isAuthError: true,
  status: 422,
  code: 'email_exists'
}
[Onboarding] Error creating additional providers: Error: Failed to create provider 2 auth account
    at POST (app/api/onboarding/create-business/route.ts:183:16)
  181 |         if (providerAuthError || !providerAuthData.user) {
  182 |           console.error(`[Onboarding] Failed to create auth user for provider ${i + 1}:`, providerAuthError);
> 183 |           throw new Error(`Failed to create provider ${i + 1} auth account`);
      |                ^
  184 |         }
  185 |
  186 |         createdAuthUsers.push(providerAuthData.user.id);
[Environment] Using development environment for server client
 POST /api/onboarding/create-business 500 in 687ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: 353c4d40-55ac-47d2-ba89-0341d2ea40bb
[Onboarding] Creating business...
[Onboarding] Business created with ID: 84de6414-b1b1-4d37-9673-e1027359a293
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: '353c4d40-55ac-47d2-ba89-0341d2ea40bb',
  firstName: 'Mike',
  lastName: 'Wilson',
  role: 'admin/provider',
  businessId: '84de6414-b1b1-4d37-9673-e1027359a293',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000005',
  whatsAppNumberNormalized: '61400000006'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: 353c4d40-55ac-47d2-ba89-0341d2ea40bb
[Onboarding] Creating provider 2: Provider 2
[Onboarding] Failed to create auth user for provider 2: Error [AuthApiError]: A user with this email address has already been registered
    at async POST (app/api/onboarding/create-business/route.ts:167:69)
  165 |         
  166 |         // Create auth user for this provider
> 167 |         const { data: providerAuthData, error: providerAuthError } = await adminSupa.auth.admin.createUser({
      |                                                                     ^
  168 |           email: providerEmail,
  169 |           password: tempPassword,
  170 |           email_confirm: true, {
  __isAuthError: true,
  status: 422,
  code: 'email_exists'
}
[Onboarding] Error creating additional providers: Error: Failed to create provider 2 auth account
    at POST (app/api/onboarding/create-business/route.ts:183:16)
  181 |         if (providerAuthError || !providerAuthData.user) {
  182 |           console.error(`[Onboarding] Failed to create auth user for provider ${i + 1}:`, providerAuthError);
> 183 |           throw new Error(`Failed to create provider ${i + 1} auth account`);
      |                ^
  184 |         }
  185 |
  186 |         createdAuthUsers.push(providerAuthData.user.id);
[Environment] Using development environment for server client
 POST /api/onboarding/create-business 500 in 600ms
[Environment] Using development environment for service-role client
 POST /api/onboarding/create-business 400 in 8ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: a508c4e7-5217-464d-85fc-9a3ba7b11080
[Onboarding] Creating business...
[Onboarding] Business created with ID: a5809e94-c4d5-4a0a-b1af-128f6f2eef0c
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'a508c4e7-5217-464d-85fc-9a3ba7b11080',
  firstName: 'John',
  lastName: 'Doe',
  role: 'admin/provider',
  businessId: 'a5809e94-c4d5-4a0a-b1af-128f6f2eef0c',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000005',
  whatsAppNumberNormalized: '61400000006'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: a508c4e7-5217-464d-85fc-9a3ba7b11080
[Onboarding] Successfully created 1 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: John Doe (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: 'a508c4e7-5217-464d-85fc-9a3ba7b11080',
  businessId: 'a5809e94-c4d5-4a0a-b1af-128f6f2eef0c',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Sydney' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: 'a508c4e7-5217-464d-85fc-9a3ba7b11080',
    businessId: 'a5809e94-c4d5-4a0a-b1af-128f6f2eef0c',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Sydney', bufferTime: 15 },
    lastSync: undefined
  },
  _id: 'bb42a91e-4d54-4218-8a0a-6856b2614184'
}
[Onboarding] Created calendar settings for John Doe (ID: bb42a91e-4d54-4218-8a0a-6856b2614184)
[Onboarding] Successfully created 1 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 1 providers for business a5809e94-c4d5-4a0a-b1af-128f6f2eef0c
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 2188ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Auth user creation failed: Error [AuthApiError]: A user with this email address has already been registered
    at async POST (app/api/onboarding/create-business/route.ts:56:49)
  54 |     // --- Step 1: Create Auth User for Owner ---
  55 |     console.log('[Onboarding] Creating owner auth user...');
> 56 |     const { data: authData, error: authError } = await adminSupa.auth.admin.createUser({
     |                                                 ^
  57 |       email: onboardingData.email,
  58 |       password: onboardingData.password,
  59 |       email_confirm: true, {
  __isAuthError: true,
  status: 422,
  code: 'email_exists'
}
 POST /api/onboarding/create-business 400 in 96ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: f9c84e44-88a2-44c1-b188-b439e14b487b
[Onboarding] Creating business...
[Onboarding] Business created with ID: 94ad9e6b-bc60-4a58-ae2c-69e87f3f6605
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'f9c84e44-88a2-44c1-b188-b439e14b487b',
  firstName: 'John',
  lastName: 'Doe',
  role: 'admin/provider',
  businessId: '94ad9e6b-bc60-4a58-ae2c-69e87f3f6605',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000009',
  whatsAppNumberNormalized: '61400000010'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: f9c84e44-88a2-44c1-b188-b439e14b487b
[Onboarding] Successfully created 1 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: John Doe (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: 'f9c84e44-88a2-44c1-b188-b439e14b487b',
  businessId: '94ad9e6b-bc60-4a58-ae2c-69e87f3f6605',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Sydney' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: 'f9c84e44-88a2-44c1-b188-b439e14b487b',
    businessId: '94ad9e6b-bc60-4a58-ae2c-69e87f3f6605',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Sydney', bufferTime: 15 },
    lastSync: undefined
  },
  _id: '716c7173-e0c7-42e2-a075-7e6f4df01e9c'
}
[Onboarding] Created calendar settings for John Doe (ID: 716c7173-e0c7-42e2-a075-7e6f4df01e9c)
[Onboarding] Successfully created 1 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 1 providers for business 94ad9e6b-bc60-4a58-ae2c-69e87f3f6605
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Creating Stripe Connect account...
[Environment] Using development environment for server client
[DEBUG] NODE_ENV: development
[DEBUG] All env keys count: 134
[DEBUG] Available env vars starting with STRIPE: [ 'STRIPE_SECRET_KEY', 'STRIPE_WEBHOOK_SECRET' ]
[DEBUG] Available env vars starting with NEXT: [
  'NEXT_RUNTIME',
  'NEXT_PRIVATE_WORKER',
  'NEXT_PRIVATE_TRACE_ID',
  'NEXT_PUBLIC_SUPABASE_URL',
  'NEXT_PUBLIC_SUPABASE_ANON_KEY',
  'NEXT_PUBLIC_SITE_URL',
  'NEXT_DEPLOYMENT_ID'
]
[DEBUG] STRIPE_SECRET_KEY exists: true
[DEBUG] STRIPE_SECRET_KEY length: 107
[DEBUG] STRIPE_SECRET_KEY value preview: sk_test_51...
[DEBUG] STRIPE_SECRET_KEY typeof: string
[DEBUG] STRIPE_SECRET_KEY raw value check: "sk_test_51Rd4eYP4p95"
[DEBUG] Creating Stripe instance with key length: 107
[DEBUG] Key starts with sk_: true
[DEBUG] Stripe instance created successfully
[Environment] Using development environment for service-role client
[Onboarding] Stripe account created: acct_1Ro1iE03zepkofOT
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 4876ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: 601e3149-209b-4f2c-a723-4f8d7f598a15
[Onboarding] Creating business...
[Onboarding] Business created with ID: 8e112371-2551-4ef8-8dbf-80760663b38b
[Onboarding] Creating owner user profile with role: admin
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: '601e3149-209b-4f2c-a723-4f8d7f598a15',
  firstName: 'Jane',
  lastName: 'Smith',
  role: 'admin',
  businessId: '8e112371-2551-4ef8-8dbf-80760663b38b',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000003',
  whatsAppNumberNormalized: '61400000004'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: 601e3149-209b-4f2c-a723-4f8d7f598a15
[Onboarding] Creating provider 2: Provider 2
[Onboarding] Failed to create auth user for provider 2: Error [AuthApiError]: A user with this email address has already been registered
    at async POST (app/api/onboarding/create-business/route.ts:167:69)
  165 |         
  166 |         // Create auth user for this provider
> 167 |         const { data: providerAuthData, error: providerAuthError } = await adminSupa.auth.admin.createUser({
      |                                                                     ^
  168 |           email: providerEmail,
  169 |           password: tempPassword,
  170 |           email_confirm: true, {
  __isAuthError: true,
  status: 422,
  code: 'email_exists'
}
[Onboarding] Error creating additional providers: Error: Failed to create provider 2 auth account
    at POST (app/api/onboarding/create-business/route.ts:183:16)
  181 |         if (providerAuthError || !providerAuthData.user) {
  182 |           console.error(`[Onboarding] Failed to create auth user for provider ${i + 1}:`, providerAuthError);
> 183 |           throw new Error(`Failed to create provider ${i + 1} auth account`);
      |                ^
  184 |         }
  185 |
  186 |         createdAuthUsers.push(providerAuthData.user.id);
[Environment] Using development environment for server client
 POST /api/onboarding/create-business 500 in 719ms
 ✓ Compiled in 595ms (1686 modules)
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: f5e56432-d4ad-4bb4-8077-a93dd8c15b24
[Onboarding] Creating business...
[Onboarding] Business created with ID: d2d5d3e1-80a2-4e1c-8702-c5b6d6b1ff76
[Onboarding] Creating owner user profile with role: admin
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'f5e56432-d4ad-4bb4-8077-a93dd8c15b24',
  firstName: 'Jane',
  lastName: 'Smith',
  role: 'admin',
  businessId: 'd2d5d3e1-80a2-4e1c-8702-c5b6d6b1ff76',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000003',
  whatsAppNumberNormalized: '61400000004'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: f5e56432-d4ad-4bb4-8077-a93dd8c15b24
[Onboarding] Creating provider 2: Sarah Johnson
[Onboarding] Failed to create auth user for provider 2: Error [AuthApiError]: A user with this email address has already been registered
    at async POST (app/api/onboarding/create-business/route.ts:167:69)
  165 |         
  166 |         // Create auth user for this provider
> 167 |         const { data: providerAuthData, error: providerAuthError } = await adminSupa.auth.admin.createUser({
      |                                                                     ^
  168 |           email: providerEmail,
  169 |           password: tempPassword,
  170 |           email_confirm: true, {
  __isAuthError: true,
  status: 422,
  code: 'email_exists'
}
[Onboarding] Error creating additional providers: Error: Failed to create provider 2 auth account
    at POST (app/api/onboarding/create-business/route.ts:183:16)
  181 |         if (providerAuthError || !providerAuthData.user) {
  182 |           console.error(`[Onboarding] Failed to create auth user for provider ${i + 1}:`, providerAuthError);
> 183 |           throw new Error(`Failed to create provider ${i + 1} auth account`);
      |                ^
  184 |         }
  185 |
  186 |         createdAuthUsers.push(providerAuthData.user.id);
[Environment] Using development environment for server client
 POST /api/onboarding/create-business 500 in 1092ms
 ✓ Compiled in 601ms (1686 modules)
 ✓ Compiled in 310ms (1686 modules)
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: 80e59f6c-4819-4f84-878d-f3233248dae9
[Onboarding] Creating business...
[Onboarding] Business created with ID: 4cdb2fdf-ef30-4726-9b62-a04e6bc7e2db
[Onboarding] Creating owner user profile with role: admin
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: '80e59f6c-4819-4f84-878d-f3233248dae9',
  firstName: 'Jane',
  lastName: 'Smith',
  role: 'admin',
  businessId: '4cdb2fdf-ef30-4726-9b62-a04e6bc7e2db',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000003',
  whatsAppNumberNormalized: '61400000004'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: 80e59f6c-4819-4f84-878d-f3233248dae9
[Onboarding] Creating provider 2: Sarah Johnson
[Onboarding] Debug info - i: 1, numberOfProviders: 2, providerNames: [ 'Sarah Johnson' ]
[Onboarding] Generated email: provider1@example.com, password length: 15
[Onboarding] Failed to create auth user for provider 2:
[Onboarding] Auth error: Error [AuthApiError]: A user with this email address has already been registered
    at async POST (app/api/onboarding/create-business/route.ts:170:69)
  168 |         
  169 |         // Create auth user for this provider
> 170 |         const { data: providerAuthData, error: providerAuthError } = await adminSupa.auth.admin.createUser({
      |                                                                     ^
  171 |           email: providerEmail,
  172 |           password: tempPassword,
  173 |           email_confirm: true, {
  __isAuthError: true,
  status: 422,
  code: 'email_exists'
}
[Onboarding] Auth data: { user: null }
[Onboarding] Email used: provider1@example.com
[Onboarding] Password used: .ftbz1hclyz9A1!
[Onboarding] Error creating additional providers: Error: Failed to create provider 2 auth account
    at POST (app/api/onboarding/create-business/route.ts:190:16)
  188 |           console.error(`[Onboarding] Email used:`, providerEmail);
  189 |           console.error(`[Onboarding] Password used:`, tempPassword);
> 190 |           throw new Error(`Failed to create provider ${i + 1} auth account`);
      |                ^
  191 |         }
  192 |
  193 |         createdAuthUsers.push(providerAuthData.user.id);
[Environment] Using development environment for server client
 POST /api/onboarding/create-business 500 in 830ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: 599b5c83-3961-4baf-8432-d818a11e34bc
[Onboarding] Creating business...
[Onboarding] Business created with ID: eaf51a7a-f55f-4f88-9e88-ef3719af258e
[Onboarding] Creating owner user profile with role: admin
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: '599b5c83-3961-4baf-8432-d818a11e34bc',
  firstName: 'Jane',
  lastName: 'Smith',
  role: 'admin',
  businessId: 'eaf51a7a-f55f-4f88-9e88-ef3719af258e',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000003',
  whatsAppNumberNormalized: '61400000004'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: 599b5c83-3961-4baf-8432-d818a11e34bc
[Onboarding] Creating provider 2: Sarah Johnson
[Onboarding] Debug info - i: 1, numberOfProviders: 2, providerNames: [ 'Sarah Johnson' ]
[Onboarding] Generated email: provider1@example.com, password length: 15
[Onboarding] Failed to create auth user for provider 2:
[Onboarding] Auth error: Error [AuthApiError]: A user with this email address has already been registered
    at async POST (app/api/onboarding/create-business/route.ts:170:69)
  168 |         
  169 |         // Create auth user for this provider
> 170 |         const { data: providerAuthData, error: providerAuthError } = await adminSupa.auth.admin.createUser({
      |                                                                     ^
  171 |           email: providerEmail,
  172 |           password: tempPassword,
  173 |           email_confirm: true, {
  __isAuthError: true,
  status: 422,
  code: 'email_exists'
}
[Onboarding] Auth data: { user: null }
[Onboarding] Email used: provider1@example.com
[Onboarding] Password used: .dgmpeb9xveaA1!
[Onboarding] Error creating additional providers: Error: Failed to create provider 2 auth account
    at POST (app/api/onboarding/create-business/route.ts:190:16)
  188 |           console.error(`[Onboarding] Email used:`, providerEmail);
  189 |           console.error(`[Onboarding] Password used:`, tempPassword);
> 190 |           throw new Error(`Failed to create provider ${i + 1} auth account`);
      |                ^
  191 |         }
  192 |
  193 |         createdAuthUsers.push(providerAuthData.user.id);
[Environment] Using development environment for server client
 POST /api/onboarding/create-business 500 in 797ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: 05c40ee9-51ad-4dd1-881e-8af901c33f80
[Onboarding] Creating business...
[Onboarding] Business created with ID: edeec4fb-afd9-4cef-a6d3-0534c99005d3
[Onboarding] Creating owner user profile with role: admin
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: '05c40ee9-51ad-4dd1-881e-8af901c33f80',
  firstName: 'Jane',
  lastName: 'Smith',
  role: 'admin',
  businessId: 'edeec4fb-afd9-4cef-a6d3-0534c99005d3',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000003',
  whatsAppNumberNormalized: '61400000004'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: 05c40ee9-51ad-4dd1-881e-8af901c33f80
[Onboarding] Creating provider 2: Sarah Johnson
[Onboarding] Debug info - i: 1, numberOfProviders: 2, providerNames: [ 'Sarah Johnson' ]
[Onboarding] Generated email: provider1@example.com, password length: 15
[Onboarding] Failed to create auth user for provider 2:
[Onboarding] Auth error: Error [AuthApiError]: A user with this email address has already been registered
    at async POST (app/api/onboarding/create-business/route.ts:170:69)
  168 |         
  169 |         // Create auth user for this provider
> 170 |         const { data: providerAuthData, error: providerAuthError } = await adminSupa.auth.admin.createUser({
      |                                                                     ^
  171 |           email: providerEmail,
  172 |           password: tempPassword,
  173 |           email_confirm: true, {
  __isAuthError: true,
  status: 422,
  code: 'email_exists'
}
[Onboarding] Auth data: { user: null }
[Onboarding] Email used: provider1@example.com
[Onboarding] Password used: .lhdh105ug8gA1!
[Onboarding] Error creating additional providers: Error: Failed to create provider 2 auth account
    at POST (app/api/onboarding/create-business/route.ts:190:16)
  188 |           console.error(`[Onboarding] Email used:`, providerEmail);
  189 |           console.error(`[Onboarding] Password used:`, tempPassword);
> 190 |           throw new Error(`Failed to create provider ${i + 1} auth account`);
      |                ^
  191 |         }
  192 |
  193 |         createdAuthUsers.push(providerAuthData.user.id);
[Environment] Using development environment for server client
 POST /api/onboarding/create-business 500 in 859ms
 ✓ Compiled in 493ms (1686 modules)
 ✓ Compiled in 635ms (1686 modules)
 ✓ Compiled in 393ms (1686 modules)
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: e49bd334-dddc-4907-bac4-cede9cc0a91f
[Onboarding] Creating business...
[Onboarding] Business created with ID: e392e78c-b053-4d3c-9c4e-4f9c20680364
[Onboarding] Creating owner user profile with role: admin
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'e49bd334-dddc-4907-bac4-cede9cc0a91f',
  firstName: 'Jane',
  lastName: 'Smith',
  role: 'admin',
  businessId: 'e392e78c-b053-4d3c-9c4e-4f9c20680364',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000003',
  whatsAppNumberNormalized: '61400000004'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: e49bd334-dddc-4907-bac4-cede9cc0a91f
[Onboarding] Creating provider 2: Sarah Johnson
[User.add] Found existing auth user with email: provider1-1753273711033@example.com
[User.add] About to upsert user profile: {
  id: '9856f993-3c16-4d2d-a802-ab856ba53e32',
  firstName: 'Sarah',
  lastName: 'Johnson',
  role: 'provider',
  businessId: 'e392e78c-b053-4d3c-9c4e-4f9c20680364',
  email: 'provider1-1753273711033@example.com',
  phoneNormalized: undefined
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Provider 2 user profile created with ID: 9856f993-3c16-4d2d-a802-ab856ba53e32
[Onboarding] Successfully created 2 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Basic Manicure
[Onboarding] Created service: Express Manicure
[Onboarding] Created service: Gel Manicure
[Onboarding] Created service: Press on Manicure
[Onboarding] Created service: Nail Art
[Onboarding] Created service: Basic Pedicure
[Onboarding] Created service: Gel Pedicure
[Onboarding] Created service: Ladies Haircut
[Onboarding] Created service: Hair Styling
[Onboarding] Created service: Braids
[Onboarding] Created service: Blow Dry
[Onboarding] Created service: Waves
[Onboarding] Created service: Treatments
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: Jane Smith (admin)
[Onboarding] Skipping calendar settings for Jane Smith - admin only (no service provision)
[Onboarding] Creating calendar settings for provider 1: Provider 2 (provider)
[Onboarding] Provider 1 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: '9856f993-3c16-4d2d-a802-ab856ba53e32',
  businessId: 'e392e78c-b053-4d3c-9c4e-4f9c20680364',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Melbourne' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: '9856f993-3c16-4d2d-a802-ab856ba53e32',
    businessId: 'e392e78c-b053-4d3c-9c4e-4f9c20680364',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Melbourne', bufferTime: 15 },
    lastSync: undefined
  },
  _id: 'bd96adbf-ee2c-4163-8e31-d7103d761497'
}
[Onboarding] Created calendar settings for Provider 2 (ID: bd96adbf-ee2c-4163-8e31-d7103d761497)
[Onboarding] Successfully created 1 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 1 providers for business e392e78c-b053-4d3c-9c4e-4f9c20680364
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 3046ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: 7ebe7ae9-84ff-4fab-9d05-dcacbcb2d21c
[Onboarding] Creating business...
[Onboarding] Business created with ID: da3f6e80-55e8-4e5d-9a35-751a44f4df78
[Onboarding] Creating owner user profile with role: admin
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: '7ebe7ae9-84ff-4fab-9d05-dcacbcb2d21c',
  firstName: 'Jane',
  lastName: 'Smith',
  role: 'admin',
  businessId: 'da3f6e80-55e8-4e5d-9a35-751a44f4df78',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000003',
  whatsAppNumberNormalized: '61400000004'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: 7ebe7ae9-84ff-4fab-9d05-dcacbcb2d21c
[Onboarding] Creating provider 2: Sarah Johnson
[User.add] Found existing auth user with email: provider1-1753273752053@example.com
[User.add] About to upsert user profile: {
  id: '23c5aeb7-d793-4cbd-97f8-75f5ca10ba6e',
  firstName: 'Sarah',
  lastName: 'Johnson',
  role: 'provider',
  businessId: 'da3f6e80-55e8-4e5d-9a35-751a44f4df78',
  email: 'provider1-1753273752053@example.com',
  phoneNormalized: undefined
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Provider 2 user profile created with ID: 23c5aeb7-d793-4cbd-97f8-75f5ca10ba6e
[Onboarding] Successfully created 2 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Basic Manicure
[Onboarding] Created service: Express Manicure
[Onboarding] Created service: Gel Manicure
[Onboarding] Created service: Press on Manicure
[Onboarding] Created service: Nail Art
[Onboarding] Created service: Basic Pedicure
[Onboarding] Created service: Gel Pedicure
[Onboarding] Created service: Ladies Haircut
[Onboarding] Created service: Hair Styling
[Onboarding] Created service: Braids
[Onboarding] Created service: Blow Dry
[Onboarding] Created service: Waves
[Onboarding] Created service: Treatments
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: Jane Smith (admin)
[Onboarding] Skipping calendar settings for Jane Smith - admin only (no service provision)
[Onboarding] Creating calendar settings for provider 1: Provider 2 (provider)
[Onboarding] Provider 1 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: '23c5aeb7-d793-4cbd-97f8-75f5ca10ba6e',
  businessId: 'da3f6e80-55e8-4e5d-9a35-751a44f4df78',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Melbourne' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: '23c5aeb7-d793-4cbd-97f8-75f5ca10ba6e',
    businessId: 'da3f6e80-55e8-4e5d-9a35-751a44f4df78',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Melbourne', bufferTime: 15 },
    lastSync: undefined
  },
  _id: '22671197-081c-4788-a3ed-bf9d7fd9b214'
}
[Onboarding] Created calendar settings for Provider 2 (ID: 22671197-081c-4788-a3ed-bf9d7fd9b214)
[Onboarding] Successfully created 1 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 1 providers for business da3f6e80-55e8-4e5d-9a35-751a44f4df78
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 3390ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: 3dee8a6b-8943-473a-b44d-7c883c04353e
[Onboarding] Creating business...
[Onboarding] Business created with ID: 73245855-1fd0-43e3-a640-424481c62a4d
[Onboarding] Creating owner user profile with role: admin
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: '3dee8a6b-8943-473a-b44d-7c883c04353e',
  firstName: 'Jane',
  lastName: 'Smith',
  role: 'admin',
  businessId: '73245855-1fd0-43e3-a640-424481c62a4d',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000003',
  whatsAppNumberNormalized: '61400000004'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: 3dee8a6b-8943-473a-b44d-7c883c04353e
[Onboarding] Creating provider 2: Sarah Johnson
[User.add] Found existing auth user with email: provider1-1753273814925@example.com
[User.add] About to upsert user profile: {
  id: 'd4031123-4273-4eea-9a01-8e0482cee477',
  firstName: 'Sarah',
  lastName: 'Johnson',
  role: 'provider',
  businessId: '73245855-1fd0-43e3-a640-424481c62a4d',
  email: 'provider1-1753273814925@example.com',
  phoneNormalized: undefined
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Provider 2 user profile created with ID: d4031123-4273-4eea-9a01-8e0482cee477
[Onboarding] Successfully created 2 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Basic Manicure
[Onboarding] Created service: Express Manicure
[Onboarding] Created service: Gel Manicure
[Onboarding] Created service: Press on Manicure
[Onboarding] Created service: Nail Art
[Onboarding] Created service: Basic Pedicure
[Onboarding] Created service: Gel Pedicure
[Onboarding] Created service: Ladies Haircut
[Onboarding] Created service: Hair Styling
[Onboarding] Created service: Braids
[Onboarding] Created service: Blow Dry
[Onboarding] Created service: Waves
[Onboarding] Created service: Treatments
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: Jane Smith (admin)
[Onboarding] Skipping calendar settings for Jane Smith - admin only (no service provision)
[Onboarding] Creating calendar settings for provider 1: Provider 2 (provider)
[Onboarding] Provider 1 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: 'd4031123-4273-4eea-9a01-8e0482cee477',
  businessId: '73245855-1fd0-43e3-a640-424481c62a4d',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Melbourne' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: 'd4031123-4273-4eea-9a01-8e0482cee477',
    businessId: '73245855-1fd0-43e3-a640-424481c62a4d',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Melbourne', bufferTime: 15 },
    lastSync: undefined
  },
  _id: 'adc103ef-2a12-4c2c-b35c-1b2d10149d61'
}
[Onboarding] Created calendar settings for Provider 2 (ID: adc103ef-2a12-4c2c-b35c-1b2d10149d61)
[Onboarding] Successfully created 1 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 1 providers for business 73245855-1fd0-43e3-a640-424481c62a4d
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 3329ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: cabfdf92-3829-4772-83f3-aa97978a5994
[Onboarding] Creating business...
[Onboarding] Business created with ID: 97dc1ddb-645c-4178-bd8c-7e1efa3e3047
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'cabfdf92-3829-4772-83f3-aa97978a5994',
  firstName: 'John',
  lastName: 'Doe',
  role: 'admin/provider',
  businessId: '97dc1ddb-645c-4178-bd8c-7e1efa3e3047',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000001',
  whatsAppNumberNormalized: '61400000002'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: cabfdf92-3829-4772-83f3-aa97978a5994
[Onboarding] Successfully created 1 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: John Doe (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: 'cabfdf92-3829-4772-83f3-aa97978a5994',
  businessId: '97dc1ddb-645c-4178-bd8c-7e1efa3e3047',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Sydney' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: 'cabfdf92-3829-4772-83f3-aa97978a5994',
    businessId: '97dc1ddb-645c-4178-bd8c-7e1efa3e3047',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Sydney', bufferTime: 15 },
    lastSync: undefined
  },
  _id: '8fc4556d-eaac-4a6e-90a7-b9fec7ac444e'
}
[Onboarding] Created calendar settings for John Doe (ID: 8fc4556d-eaac-4a6e-90a7-b9fec7ac444e)
[Onboarding] Successfully created 1 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 1 providers for business 97dc1ddb-645c-4178-bd8c-7e1efa3e3047
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 2208ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: abf68265-d2ac-49d9-b852-3579e6052128
[Onboarding] Creating business...
[Onboarding] Business created with ID: b42ea951-14c1-4046-97de-bd4f5ebfa262
[Onboarding] Creating owner user profile with role: admin
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'abf68265-d2ac-49d9-b852-3579e6052128',
  firstName: 'Jane',
  lastName: 'Smith',
  role: 'admin',
  businessId: 'b42ea951-14c1-4046-97de-bd4f5ebfa262',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000003',
  whatsAppNumberNormalized: '61400000004'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: abf68265-d2ac-49d9-b852-3579e6052128
[Onboarding] Creating provider 2: Sarah Johnson
[User.add] Found existing auth user with email: provider1-1753273835115@example.com
[User.add] About to upsert user profile: {
  id: 'bfd24b2f-5371-41a0-8b02-2e4a98d783e1',
  firstName: 'Sarah',
  lastName: 'Johnson',
  role: 'provider',
  businessId: 'b42ea951-14c1-4046-97de-bd4f5ebfa262',
  email: 'provider1-1753273835115@example.com',
  phoneNormalized: undefined
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Provider 2 user profile created with ID: bfd24b2f-5371-41a0-8b02-2e4a98d783e1
[Onboarding] Successfully created 2 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Basic Manicure
[Onboarding] Created service: Express Manicure
[Onboarding] Created service: Gel Manicure
[Onboarding] Created service: Press on Manicure
[Onboarding] Created service: Nail Art
[Onboarding] Created service: Basic Pedicure
[Onboarding] Created service: Gel Pedicure
[Onboarding] Created service: Ladies Haircut
[Onboarding] Created service: Hair Styling
[Onboarding] Created service: Braids
[Onboarding] Created service: Blow Dry
[Onboarding] Created service: Waves
[Onboarding] Created service: Treatments
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: Jane Smith (admin)
[Onboarding] Skipping calendar settings for Jane Smith - admin only (no service provision)
[Onboarding] Creating calendar settings for provider 1: Provider 2 (provider)
[Onboarding] Provider 1 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: 'bfd24b2f-5371-41a0-8b02-2e4a98d783e1',
  businessId: 'b42ea951-14c1-4046-97de-bd4f5ebfa262',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Melbourne' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: 'bfd24b2f-5371-41a0-8b02-2e4a98d783e1',
    businessId: 'b42ea951-14c1-4046-97de-bd4f5ebfa262',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Melbourne', bufferTime: 15 },
    lastSync: undefined
  },
  _id: '94b7146e-b781-43cc-9699-4ebd7b6856c3'
}
[Onboarding] Created calendar settings for Provider 2 (ID: 94b7146e-b781-43cc-9699-4ebd7b6856c3)
[Onboarding] Successfully created 1 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 1 providers for business b42ea951-14c1-4046-97de-bd4f5ebfa262
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 2752ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: a994a175-1da9-4d51-883c-44a3a8f328dc
[Onboarding] Creating business...
[Onboarding] Business created with ID: 0c57f94f-8cd8-4592-bf60-a0de0f4e1351
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'a994a175-1da9-4d51-883c-44a3a8f328dc',
  firstName: 'Mike',
  lastName: 'Wilson',
  role: 'admin/provider',
  businessId: '0c57f94f-8cd8-4592-bf60-a0de0f4e1351',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000005',
  whatsAppNumberNormalized: '61400000006'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: a994a175-1da9-4d51-883c-44a3a8f328dc
[Onboarding] Creating provider 2: Alex Thompson
[User.add] Found existing auth user with email: provider1-1753273838963@example.com
[User.add] About to upsert user profile: {
  id: '02342000-47a1-4fe0-8d1f-3f7cd2f5b5cd',
  firstName: 'Alex',
  lastName: 'Thompson',
  role: 'provider',
  businessId: '0c57f94f-8cd8-4592-bf60-a0de0f4e1351',
  email: 'provider1-1753273838963@example.com',
  phoneNormalized: undefined
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Provider 2 user profile created with ID: 02342000-47a1-4fe0-8d1f-3f7cd2f5b5cd
[Onboarding] Successfully created 2 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: Mike Wilson (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: 'a994a175-1da9-4d51-883c-44a3a8f328dc',
  businessId: '0c57f94f-8cd8-4592-bf60-a0de0f4e1351',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Brisbane' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: 'a994a175-1da9-4d51-883c-44a3a8f328dc',
    businessId: '0c57f94f-8cd8-4592-bf60-a0de0f4e1351',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Brisbane', bufferTime: 15 },
    lastSync: undefined
  },
  _id: 'c3408a8c-b21b-40c5-8cbc-31d0b6134280'
}
[Onboarding] Created calendar settings for Mike Wilson (ID: c3408a8c-b21b-40c5-8cbc-31d0b6134280)
[Onboarding] Creating calendar settings for provider 1: Provider 2 (provider)
[Onboarding] Provider 1 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: '02342000-47a1-4fe0-8d1f-3f7cd2f5b5cd',
  businessId: '0c57f94f-8cd8-4592-bf60-a0de0f4e1351',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Brisbane' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: '02342000-47a1-4fe0-8d1f-3f7cd2f5b5cd',
    businessId: '0c57f94f-8cd8-4592-bf60-a0de0f4e1351',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Brisbane', bufferTime: 15 },
    lastSync: undefined
  },
  _id: '2ed84b79-2541-4f82-8292-490ac3785a17'
}
[Onboarding] Created calendar settings for Provider 2 (ID: 2ed84b79-2541-4f82-8292-490ac3785a17)
[Onboarding] Successfully created 2 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 2 providers for business 0c57f94f-8cd8-4592-bf60-a0de0f4e1351
[Environment] Using development environment for server client
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 2540ms
[Environment] Using development environment for service-role client
 POST /api/onboarding/create-business 400 in 5ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: 877d54d6-b8b5-48f9-a901-0a77887afaa2
[Onboarding] Creating business...
[Onboarding] Business created with ID: 9e40baa2-d9c1-41e6-b484-f6680d0683df
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: '877d54d6-b8b5-48f9-a901-0a77887afaa2',
  firstName: 'John',
  lastName: 'Doe',
  role: 'admin/provider',
  businessId: '9e40baa2-d9c1-41e6-b484-f6680d0683df',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000005',
  whatsAppNumberNormalized: '61400000006'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: 877d54d6-b8b5-48f9-a901-0a77887afaa2
[Onboarding] Successfully created 1 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: John Doe (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: '877d54d6-b8b5-48f9-a901-0a77887afaa2',
  businessId: '9e40baa2-d9c1-41e6-b484-f6680d0683df',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Sydney' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: '877d54d6-b8b5-48f9-a901-0a77887afaa2',
    businessId: '9e40baa2-d9c1-41e6-b484-f6680d0683df',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Sydney', bufferTime: 15 },
    lastSync: undefined
  },
  _id: 'dc352c2b-313d-42fc-bcf5-45835fcb0ae6'
}
[Onboarding] Created calendar settings for John Doe (ID: dc352c2b-313d-42fc-bcf5-45835fcb0ae6)
[Onboarding] Successfully created 1 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 1 providers for business 9e40baa2-d9c1-41e6-b484-f6680d0683df
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 2331ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Auth user creation failed: Error [AuthApiError]: A user with this email address has already been registered
    at async POST (app/api/onboarding/create-business/route.ts:56:49)
  54 |     // --- Step 1: Create Auth User for Owner ---
  55 |     console.log('[Onboarding] Creating owner auth user...');
> 56 |     const { data: authData, error: authError } = await adminSupa.auth.admin.createUser({
     |                                                 ^
  57 |       email: onboardingData.email,
  58 |       password: onboardingData.password,
  59 |       email_confirm: true, {
  __isAuthError: true,
  status: 422,
  code: 'email_exists'
}
 POST /api/onboarding/create-business 400 in 134ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: b0ac7aee-c11e-4e2a-99a7-7be45d6694dd
[Onboarding] Creating business...
[Onboarding] Business created with ID: 5dafff2e-8da6-4353-b9c2-ed42ef92d587
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'b0ac7aee-c11e-4e2a-99a7-7be45d6694dd',
  firstName: 'John',
  lastName: 'Doe',
  role: 'admin/provider',
  businessId: '5dafff2e-8da6-4353-b9c2-ed42ef92d587',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000009',
  whatsAppNumberNormalized: '61400000010'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: b0ac7aee-c11e-4e2a-99a7-7be45d6694dd
[Onboarding] Successfully created 1 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: John Doe (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: 'b0ac7aee-c11e-4e2a-99a7-7be45d6694dd',
  businessId: '5dafff2e-8da6-4353-b9c2-ed42ef92d587',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Sydney' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: 'b0ac7aee-c11e-4e2a-99a7-7be45d6694dd',
    businessId: '5dafff2e-8da6-4353-b9c2-ed42ef92d587',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Sydney', bufferTime: 15 },
    lastSync: undefined
  },
  _id: 'a8a1eb69-ab4e-46a2-b162-531120cadbbb'
}
[Onboarding] Created calendar settings for John Doe (ID: a8a1eb69-ab4e-46a2-b162-531120cadbbb)
[Onboarding] Successfully created 1 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 1 providers for business 5dafff2e-8da6-4353-b9c2-ed42ef92d587
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Creating Stripe Connect account...
[Environment] Using development environment for server client
[DEBUG] NODE_ENV: development
[DEBUG] All env keys count: 134
[DEBUG] Available env vars starting with STRIPE: [ 'STRIPE_SECRET_KEY', 'STRIPE_WEBHOOK_SECRET' ]
[DEBUG] Available env vars starting with NEXT: [
  'NEXT_RUNTIME',
  'NEXT_PRIVATE_WORKER',
  'NEXT_PRIVATE_TRACE_ID',
  'NEXT_PUBLIC_SUPABASE_URL',
  'NEXT_PUBLIC_SUPABASE_ANON_KEY',
  'NEXT_PUBLIC_SITE_URL',
  'NEXT_DEPLOYMENT_ID'
]
[DEBUG] STRIPE_SECRET_KEY exists: true
[DEBUG] STRIPE_SECRET_KEY length: 107
[DEBUG] STRIPE_SECRET_KEY value preview: sk_test_51...
[DEBUG] STRIPE_SECRET_KEY typeof: string
[DEBUG] STRIPE_SECRET_KEY raw value check: "sk_test_51Rd4eYP4p95"
[DEBUG] Creating Stripe instance with key length: 107
[DEBUG] Key starts with sk_: true
[DEBUG] Stripe instance created successfully
[Environment] Using development environment for service-role client
[Onboarding] Stripe account created: acct_1Ro1oq04pzmqGII1
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 5232ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: 4238466a-62f7-4b4d-9bff-bf1ea08aa0f3
[Onboarding] Creating business...
[Onboarding] Business created with ID: c1c38c91-f517-4887-b2ec-0c4bfec1df26
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: '4238466a-62f7-4b4d-9bff-bf1ea08aa0f3',
  firstName: 'Mike',
  lastName: 'Wilson',
  role: 'admin/provider',
  businessId: 'c1c38c91-f517-4887-b2ec-0c4bfec1df26',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000005',
  whatsAppNumberNormalized: '61400000006'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: 4238466a-62f7-4b4d-9bff-bf1ea08aa0f3
[Onboarding] Creating provider 2: Alex Thompson
[User.add] Found existing auth user with email: provider1-1753273873366@example.com
[User.add] About to upsert user profile: {
  id: '86043a26-d93d-4431-910a-08b926c56b40',
  firstName: 'Alex',
  lastName: 'Thompson',
  role: 'provider',
  businessId: 'c1c38c91-f517-4887-b2ec-0c4bfec1df26',
  email: 'provider1-1753273873366@example.com',
  phoneNormalized: undefined
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Provider 2 user profile created with ID: 86043a26-d93d-4431-910a-08b926c56b40
[Onboarding] Successfully created 2 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: Mike Wilson (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: '4238466a-62f7-4b4d-9bff-bf1ea08aa0f3',
  businessId: 'c1c38c91-f517-4887-b2ec-0c4bfec1df26',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Brisbane' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: '4238466a-62f7-4b4d-9bff-bf1ea08aa0f3',
    businessId: 'c1c38c91-f517-4887-b2ec-0c4bfec1df26',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Brisbane', bufferTime: 15 },
    lastSync: undefined
  },
  _id: '609e23e1-4ba3-4a68-8b00-8c6de0430e4c'
}
[Onboarding] Created calendar settings for Mike Wilson (ID: 609e23e1-4ba3-4a68-8b00-8c6de0430e4c)
[Onboarding] Creating calendar settings for provider 1: Provider 2 (provider)
[Onboarding] Provider 1 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: '86043a26-d93d-4431-910a-08b926c56b40',
  businessId: 'c1c38c91-f517-4887-b2ec-0c4bfec1df26',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Brisbane' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: '86043a26-d93d-4431-910a-08b926c56b40',
    businessId: 'c1c38c91-f517-4887-b2ec-0c4bfec1df26',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Brisbane', bufferTime: 15 },
    lastSync: undefined
  },
  _id: '0f63a85e-fe50-400e-9d66-957bd641b904'
}
[Onboarding] Created calendar settings for Provider 2 (ID: 0f63a85e-fe50-400e-9d66-957bd641b904)
[Onboarding] Successfully created 2 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 2 providers for business c1c38c91-f517-4887-b2ec-0c4bfec1df26
[Environment] Using development environment for server client
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 3813ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: b161942a-1005-4db0-865b-d1d517451f81
[Onboarding] Creating business...
[Onboarding] Business created with ID: 248a5e44-1df1-4346-804c-73ab39397e22
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'b161942a-1005-4db0-865b-d1d517451f81',
  firstName: 'Mike',
  lastName: 'Wilson',
  role: 'admin/provider',
  businessId: '248a5e44-1df1-4346-804c-73ab39397e22',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000005',
  whatsAppNumberNormalized: '61400000006'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: b161942a-1005-4db0-865b-d1d517451f81
[Onboarding] Creating provider 2: Alex Thompson
[User.add] Found existing auth user with email: provider1-1753273913592@example.com
[User.add] About to upsert user profile: {
  id: '29143495-e8cf-46e3-8b25-e2a2e87e21f2',
  firstName: 'Alex',
  lastName: 'Thompson',
  role: 'provider',
  businessId: '248a5e44-1df1-4346-804c-73ab39397e22',
  email: 'provider1-1753273913592@example.com',
  phoneNormalized: undefined
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Provider 2 user profile created with ID: 29143495-e8cf-46e3-8b25-e2a2e87e21f2
[Onboarding] Successfully created 2 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: Mike Wilson (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: 'b161942a-1005-4db0-865b-d1d517451f81',
  businessId: '248a5e44-1df1-4346-804c-73ab39397e22',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Brisbane' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: 'b161942a-1005-4db0-865b-d1d517451f81',
    businessId: '248a5e44-1df1-4346-804c-73ab39397e22',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Brisbane', bufferTime: 15 },
    lastSync: undefined
  },
  _id: '6e0030aa-e57d-4b59-b7bf-510b9274c959'
}
[Onboarding] Created calendar settings for Mike Wilson (ID: 6e0030aa-e57d-4b59-b7bf-510b9274c959)
[Onboarding] Creating calendar settings for provider 1: Provider 2 (provider)
[Onboarding] Provider 1 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: '29143495-e8cf-46e3-8b25-e2a2e87e21f2',
  businessId: '248a5e44-1df1-4346-804c-73ab39397e22',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Brisbane' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: '29143495-e8cf-46e3-8b25-e2a2e87e21f2',
    businessId: '248a5e44-1df1-4346-804c-73ab39397e22',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Brisbane', bufferTime: 15 },
    lastSync: undefined
  },
  _id: 'dfd48e1d-30cb-4002-97fb-80b9a9eb0b12'
}
[Onboarding] Created calendar settings for Provider 2 (ID: dfd48e1d-30cb-4002-97fb-80b9a9eb0b12)
[Onboarding] Successfully created 2 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 2 providers for business 248a5e44-1df1-4346-804c-73ab39397e22
[Environment] Using development environment for server client
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 3256ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: 35051519-58a5-4e4d-a920-292bdc0ed18d
[Onboarding] Creating business...
[Onboarding] Business created with ID: 7583b198-b58f-4282-a802-100375bebc91
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: '35051519-58a5-4e4d-a920-292bdc0ed18d',
  firstName: 'Mike',
  lastName: 'Wilson',
  role: 'admin/provider',
  businessId: '7583b198-b58f-4282-a802-100375bebc91',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000005',
  whatsAppNumberNormalized: '61400000006'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: 35051519-58a5-4e4d-a920-292bdc0ed18d
[Onboarding] Creating provider 2: Alex Thompson
[User.add] Found existing auth user with email: provider1-1753273965360@example.com
[User.add] About to upsert user profile: {
  id: 'a6cdef7a-b0d5-4b7a-a8b2-bbbf5a75ebbf',
  firstName: 'Alex',
  lastName: 'Thompson',
  role: 'provider',
  businessId: '7583b198-b58f-4282-a802-100375bebc91',
  email: 'provider1-1753273965360@example.com',
  phoneNormalized: undefined
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Provider 2 user profile created with ID: a6cdef7a-b0d5-4b7a-a8b2-bbbf5a75ebbf
[Onboarding] Successfully created 2 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: Mike Wilson (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: '35051519-58a5-4e4d-a920-292bdc0ed18d',
  businessId: '7583b198-b58f-4282-a802-100375bebc91',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Brisbane' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: '35051519-58a5-4e4d-a920-292bdc0ed18d',
    businessId: '7583b198-b58f-4282-a802-100375bebc91',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Brisbane', bufferTime: 15 },
    lastSync: undefined
  },
  _id: 'f11d6fe3-a994-4933-86c0-78d42900d252'
}
[Onboarding] Created calendar settings for Mike Wilson (ID: f11d6fe3-a994-4933-86c0-78d42900d252)
[Onboarding] Creating calendar settings for provider 1: Provider 2 (provider)
[Onboarding] Provider 1 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: 'a6cdef7a-b0d5-4b7a-a8b2-bbbf5a75ebbf',
  businessId: '7583b198-b58f-4282-a802-100375bebc91',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Brisbane' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: 'a6cdef7a-b0d5-4b7a-a8b2-bbbf5a75ebbf',
    businessId: '7583b198-b58f-4282-a802-100375bebc91',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Brisbane', bufferTime: 15 },
    lastSync: undefined
  },
  _id: 'f88e18f3-7d20-4c0e-bae5-0ca7f727f351'
}
[Onboarding] Created calendar settings for Provider 2 (ID: f88e18f3-7d20-4c0e-bae5-0ca7f727f351)
[Onboarding] Successfully created 2 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 2 providers for business 7583b198-b58f-4282-a802-100375bebc91
[Environment] Using development environment for server client
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 2945ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: aaa43778-c951-4321-8205-3028bf452aee
[Onboarding] Creating business...
[Onboarding] Business created with ID: 6ac8bbba-8028-42a5-9775-8126ccbac80f
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'aaa43778-c951-4321-8205-3028bf452aee',
  firstName: 'Mike',
  lastName: 'Wilson',
  role: 'admin/provider',
  businessId: '6ac8bbba-8028-42a5-9775-8126ccbac80f',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000005',
  whatsAppNumberNormalized: '61400000006'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: aaa43778-c951-4321-8205-3028bf452aee
[Onboarding] Creating provider 2: Alex Thompson
[User.add] Found existing auth user with email: provider1-1753274014276@example.com
[User.add] About to upsert user profile: {
  id: 'ceb54ef0-d606-418a-b577-07fb641cf4f7',
  firstName: 'Alex',
  lastName: 'Thompson',
  role: 'provider',
  businessId: '6ac8bbba-8028-42a5-9775-8126ccbac80f',
  email: 'provider1-1753274014276@example.com',
  phoneNormalized: undefined
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Provider 2 user profile created with ID: ceb54ef0-d606-418a-b577-07fb641cf4f7
[Onboarding] Successfully created 2 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: Mike Wilson (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: 'aaa43778-c951-4321-8205-3028bf452aee',
  businessId: '6ac8bbba-8028-42a5-9775-8126ccbac80f',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Brisbane' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: 'aaa43778-c951-4321-8205-3028bf452aee',
    businessId: '6ac8bbba-8028-42a5-9775-8126ccbac80f',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Brisbane', bufferTime: 15 },
    lastSync: undefined
  },
  _id: '709d9559-c689-45fd-962c-3f8a029190f6'
}
[Onboarding] Created calendar settings for Mike Wilson (ID: 709d9559-c689-45fd-962c-3f8a029190f6)
[Onboarding] Creating calendar settings for provider 1: Provider 2 (provider)
[Onboarding] Provider 1 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: 'ceb54ef0-d606-418a-b577-07fb641cf4f7',
  businessId: '6ac8bbba-8028-42a5-9775-8126ccbac80f',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Brisbane' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: 'ceb54ef0-d606-418a-b577-07fb641cf4f7',
    businessId: '6ac8bbba-8028-42a5-9775-8126ccbac80f',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Brisbane', bufferTime: 15 },
    lastSync: undefined
  },
  _id: 'b076a26b-ba1d-4e70-ad1a-40d77e65af5c'
}
[Onboarding] Created calendar settings for Provider 2 (ID: b076a26b-ba1d-4e70-ad1a-40d77e65af5c)
[Onboarding] Successfully created 2 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 2 providers for business 6ac8bbba-8028-42a5-9775-8126ccbac80f
[Environment] Using development environment for server client
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 3158ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: b00d5f4d-35d9-403a-a1f6-2508302d8ffd
[Onboarding] Creating business...
[Onboarding] Business created with ID: 3ce16dea-28de-4ee3-a5d0-d29741dfc0ab
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'b00d5f4d-35d9-403a-a1f6-2508302d8ffd',
  firstName: 'John',
  lastName: 'Doe',
  role: 'admin/provider',
  businessId: '3ce16dea-28de-4ee3-a5d0-d29741dfc0ab',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000001',
  whatsAppNumberNormalized: '61400000002'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: b00d5f4d-35d9-403a-a1f6-2508302d8ffd
[Onboarding] Successfully created 1 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: John Doe (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: 'b00d5f4d-35d9-403a-a1f6-2508302d8ffd',
  businessId: '3ce16dea-28de-4ee3-a5d0-d29741dfc0ab',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Sydney' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: 'b00d5f4d-35d9-403a-a1f6-2508302d8ffd',
    businessId: '3ce16dea-28de-4ee3-a5d0-d29741dfc0ab',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Sydney', bufferTime: 15 },
    lastSync: undefined
  },
  _id: 'ee6d97df-b9d4-44a6-9b1a-9158e0e40e81'
}
[Onboarding] Created calendar settings for John Doe (ID: ee6d97df-b9d4-44a6-9b1a-9158e0e40e81)
[Onboarding] Successfully created 1 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 1 providers for business 3ce16dea-28de-4ee3-a5d0-d29741dfc0ab
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 2404ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: 0da5816c-4bb6-40da-b169-d818fd643e38
[Onboarding] Creating business...
[Onboarding] Business created with ID: ffaf2ae6-851d-44a6-bb3c-acb598c4b48a
[Onboarding] Creating owner user profile with role: admin
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: '0da5816c-4bb6-40da-b169-d818fd643e38',
  firstName: 'Jane',
  lastName: 'Smith',
  role: 'admin',
  businessId: 'ffaf2ae6-851d-44a6-bb3c-acb598c4b48a',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000003',
  whatsAppNumberNormalized: '61400000004'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: 0da5816c-4bb6-40da-b169-d818fd643e38
[Onboarding] Creating provider 2: Sarah Johnson
[User.add] Found existing auth user with email: provider1-1753274025126@example.com
[User.add] About to upsert user profile: {
  id: '2902f587-2652-466b-9b7b-bcabb9d079dd',
  firstName: 'Sarah',
  lastName: 'Johnson',
  role: 'provider',
  businessId: 'ffaf2ae6-851d-44a6-bb3c-acb598c4b48a',
  email: 'provider1-1753274025126@example.com',
  phoneNormalized: undefined
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Provider 2 user profile created with ID: 2902f587-2652-466b-9b7b-bcabb9d079dd
[Onboarding] Successfully created 2 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Basic Manicure
[Onboarding] Created service: Express Manicure
[Onboarding] Created service: Gel Manicure
[Onboarding] Created service: Press on Manicure
[Onboarding] Created service: Nail Art
[Onboarding] Created service: Basic Pedicure
[Onboarding] Created service: Gel Pedicure
[Onboarding] Created service: Ladies Haircut
[Onboarding] Created service: Hair Styling
[Onboarding] Created service: Braids
[Onboarding] Created service: Blow Dry
[Onboarding] Created service: Waves
[Onboarding] Created service: Treatments
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: Jane Smith (admin)
[Onboarding] Skipping calendar settings for Jane Smith - admin only (no service provision)
[Onboarding] Creating calendar settings for provider 1: Provider 2 (provider)
[Onboarding] Provider 1 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: '2902f587-2652-466b-9b7b-bcabb9d079dd',
  businessId: 'ffaf2ae6-851d-44a6-bb3c-acb598c4b48a',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Melbourne' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: '2902f587-2652-466b-9b7b-bcabb9d079dd',
    businessId: 'ffaf2ae6-851d-44a6-bb3c-acb598c4b48a',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Melbourne', bufferTime: 15 },
    lastSync: undefined
  },
  _id: '1b955cc2-d860-4ffc-8de2-f8c47f6e9403'
}
[Onboarding] Created calendar settings for Provider 2 (ID: 1b955cc2-d860-4ffc-8de2-f8c47f6e9403)
[Onboarding] Successfully created 1 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 1 providers for business ffaf2ae6-851d-44a6-bb3c-acb598c4b48a
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 2845ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 2 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: f2b9f595-88b2-40f8-93ee-7d6e01b3a7ac
[Onboarding] Creating business...
[Onboarding] Business created with ID: e6ad9ae8-70d7-4d98-b0f7-26927e9a8a15
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'f2b9f595-88b2-40f8-93ee-7d6e01b3a7ac',
  firstName: 'Mike',
  lastName: 'Wilson',
  role: 'admin/provider',
  businessId: 'e6ad9ae8-70d7-4d98-b0f7-26927e9a8a15',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000005',
  whatsAppNumberNormalized: '61400000006'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: f2b9f595-88b2-40f8-93ee-7d6e01b3a7ac
[Onboarding] Creating provider 2: Alex Thompson
[User.add] Found existing auth user with email: provider1-1753274029113@example.com
[User.add] About to upsert user profile: {
  id: '5b857d14-424f-4911-a21d-f7cff6316682',
  firstName: 'Alex',
  lastName: 'Thompson',
  role: 'provider',
  businessId: 'e6ad9ae8-70d7-4d98-b0f7-26927e9a8a15',
  email: 'provider1-1753274029113@example.com',
  phoneNormalized: undefined
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Provider 2 user profile created with ID: 5b857d14-424f-4911-a21d-f7cff6316682
[Onboarding] Successfully created 2 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: Mike Wilson (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: 'f2b9f595-88b2-40f8-93ee-7d6e01b3a7ac',
  businessId: 'e6ad9ae8-70d7-4d98-b0f7-26927e9a8a15',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Brisbane' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: 'f2b9f595-88b2-40f8-93ee-7d6e01b3a7ac',
    businessId: 'e6ad9ae8-70d7-4d98-b0f7-26927e9a8a15',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Brisbane', bufferTime: 15 },
    lastSync: undefined
  },
  _id: 'f6ad9d06-c120-49b4-aab4-86b68934150a'
}
[Onboarding] Created calendar settings for Mike Wilson (ID: f6ad9d06-c120-49b4-aab4-86b68934150a)
[Onboarding] Creating calendar settings for provider 1: Provider 2 (provider)
[Onboarding] Provider 1 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: '5b857d14-424f-4911-a21d-f7cff6316682',
  businessId: 'e6ad9ae8-70d7-4d98-b0f7-26927e9a8a15',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Brisbane' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: '5b857d14-424f-4911-a21d-f7cff6316682',
    businessId: 'e6ad9ae8-70d7-4d98-b0f7-26927e9a8a15',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Brisbane', bufferTime: 15 },
    lastSync: undefined
  },
  _id: 'b347cffa-0458-49ce-b67f-14650c4b17f3'
}
[Onboarding] Created calendar settings for Provider 2 (ID: b347cffa-0458-49ce-b67f-14650c4b17f3)
[Onboarding] Successfully created 2 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 2 providers for business e6ad9ae8-70d7-4d98-b0f7-26927e9a8a15
[Environment] Using development environment for server client
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 2764ms
[Environment] Using development environment for service-role client
 POST /api/onboarding/create-business 400 in 8ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: 5905509e-c723-460e-bbc2-bec9a26fb178
[Onboarding] Creating business...
[Onboarding] Business created with ID: 84c5bcee-ab02-4193-bb2b-77fcbdc40036
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: '5905509e-c723-460e-bbc2-bec9a26fb178',
  firstName: 'John',
  lastName: 'Doe',
  role: 'admin/provider',
  businessId: '84c5bcee-ab02-4193-bb2b-77fcbdc40036',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000005',
  whatsAppNumberNormalized: '61400000006'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: 5905509e-c723-460e-bbc2-bec9a26fb178
[Onboarding] Successfully created 1 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: John Doe (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: '5905509e-c723-460e-bbc2-bec9a26fb178',
  businessId: '84c5bcee-ab02-4193-bb2b-77fcbdc40036',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Sydney' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: '5905509e-c723-460e-bbc2-bec9a26fb178',
    businessId: '84c5bcee-ab02-4193-bb2b-77fcbdc40036',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Sydney', bufferTime: 15 },
    lastSync: undefined
  },
  _id: '894252a7-0e10-4539-8cc2-88c43ea8007f'
}
[Onboarding] Created calendar settings for John Doe (ID: 894252a7-0e10-4539-8cc2-88c43ea8007f)
[Onboarding] Successfully created 1 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 1 providers for business 84c5bcee-ab02-4193-bb2b-77fcbdc40036
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 2487ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Auth user creation failed: Error [AuthApiError]: A user with this email address has already been registered
    at async POST (app/api/onboarding/create-business/route.ts:56:49)
  54 |     // --- Step 1: Create Auth User for Owner ---
  55 |     console.log('[Onboarding] Creating owner auth user...');
> 56 |     const { data: authData, error: authError } = await adminSupa.auth.admin.createUser({
     |                                                 ^
  57 |       email: onboardingData.email,
  58 |       password: onboardingData.password,
  59 |       email_confirm: true, {
  __isAuthError: true,
  status: 422,
  code: 'email_exists'
}
 POST /api/onboarding/create-business 400 in 118ms
[Environment] Using development environment for service-role client
[Onboarding] Creating business with 1 providers, owner role: admin/provider
[Onboarding] Creating owner auth user...
[Onboarding] Owner auth user created with ID: f579c6d7-44b8-40ad-b2f3-b15fe6318082
[Onboarding] Creating business...
[Onboarding] Business created with ID: 30bae9a8-58b5-411f-9e1b-7ea97682257b
[Onboarding] Creating owner user profile with role: admin/provider
[User.add] Found existing auth user with email: test-onboarding@example.com
[User.add] About to upsert user profile: {
  id: 'f579c6d7-44b8-40ad-b2f3-b15fe6318082',
  firstName: 'John',
  lastName: 'Doe',
  role: 'admin/provider',
  businessId: '30bae9a8-58b5-411f-9e1b-7ea97682257b',
  email: 'test-onboarding@example.com',
  phoneNormalized: '61400000009',
  whatsAppNumberNormalized: '61400000010'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[Onboarding] Owner user profile created with ID: f579c6d7-44b8-40ad-b2f3-b15fe6318082
[Onboarding] Successfully created 1 total providers
[Onboarding] Creating default services...
[Onboarding] Created service: Single item move - One person
[Onboarding] Created service: Single item move - Two people
[Onboarding] Created service: Few items move - One person
[Onboarding] Created service: Few items move - Two people
[Onboarding] Created service: House Move 1 bedroom - One person
[Onboarding] Created service: House Move 1 bedroom - Two people
[Onboarding] Created service: House Move 2+ bedroom - One person
[Onboarding] Created service: House Move 2+ bedroom - Two people
[Onboarding] Creating provider calendar settings...
[Onboarding] Creating calendar settings for provider 0: John Doe (admin/provider)
[Onboarding] Provider 0 qualifies for calendar settings, proceeding...
[Onboarding] Calling CalendarSettings.save with data: {
  userId: 'f579c6d7-44b8-40ad-b2f3-b15fe6318082',
  businessId: '30bae9a8-58b5-411f-9e1b-7ea97682257b',
  workingHours: {
    mon: { start: '09:00', end: '17:00' },
    tue: { start: '09:00', end: '17:00' },
    wed: { start: '09:00', end: '17:00' },
    thu: { start: '09:00', end: '17:00' },
    fri: { start: '09:00', end: '17:00' },
    sat: null,
    sun: null
  },
  manageCalendar: false,
  settings: { bufferTime: 15, timezone: 'Australia/Sydney' }
}
[CalendarSettings.save] Using service role client (bypasses RLS for calendar settings creation)
[Onboarding] CalendarSettings.save returned: CalendarSettings {
  data: {
    userId: 'f579c6d7-44b8-40ad-b2f3-b15fe6318082',
    businessId: '30bae9a8-58b5-411f-9e1b-7ea97682257b',
    workingHours: {
      fri: [Object],
      mon: [Object],
      sat: null,
      sun: null,
      thu: [Object],
      tue: [Object],
      wed: [Object]
    },
    timezone: undefined,
    manageCalendar: undefined,
    calendarId: null,
    calendarType: null,
    settings: { timezone: 'Australia/Sydney', bufferTime: 15 },
    lastSync: undefined
  },
  _id: '1028d77c-4f76-4bb8-b91e-664791548acf'
}
[Onboarding] Created calendar settings for John Doe (ID: 1028d77c-4f76-4bb8-b91e-664791548acf)
[Onboarding] Successfully created 1 calendar settings
[Onboarding] Generating initial aggregated availability...
[computeAggregatedAvailability] Found 1 providers for business 30bae9a8-58b5-411f-9e1b-7ea97682257b
[Environment] Using development environment for server client
[Onboarding] Generated 22 days of aggregated availability
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[AvailabilitySlots.add] Using service role client (bypasses RLS for business availability creation)
[Onboarding] Successfully saved 22 availability slot records
[Onboarding] Creating Stripe Connect account...
[Environment] Using development environment for server client
[Environment] Using development environment for service-role client
[Onboarding] Stripe account created: acct_1Ro1rvP5SWphCzAj
[Onboarding] Multi-provider business onboarding completed successfully!
 POST /api/onboarding/create-business 200 in 5392ms
 ✓ Compiled in 404ms (1097 modules)
 ✓ Compiled in 315ms (54 modules)
 ✓ Compiled in 388ms (1137 modules)
<w> [webpack.cache.PackFileCacheStrategy] Caching failed for pack: Error: ENOENT: no such file or directory, rename '/Users/juanbernal/code/mesieou/2025/simple_booking/.next/cache/webpack/client-development/12.pack.gz_' -> '/Users/juanbernal/code/mesieou/2025/simple_booking/.next/cache/webpack/client-development/12.pack.gz'
 ✓ Compiled in 193ms (1137 modules)
 ✓ Compiled /api/seed/luisa in 418ms (1480 modules)
 GET /api/seed/luisa 200 in 559ms
💄 Starting Luisa business seed for DEVELOPMENT...
🧹 Cleaning up old Luisa business data in DEV environment...
[CLEANUP] Starting cleanup of Luisa's test business data...
[CLEANUP] Searching for existing Luisa business data...
[CLEANUP] Found 2 business(es) to clean up:
  - dsfd (mesieou@gmail.com) - ID: 58771fee-cc13-4990-a654-794f821cca3b
  - Beauty Asiul (DEV) (luisa.dev@beautyasiul.com) - ID: 162cd203-b632-44e4-a9d5-081e247421bd
[CLEANUP] 🧹 Cleaning up business: dsfd - ID: 58771fee-cc13-4990-a654-794f821cca3b
[SEED] Starting cleanup for business ID: 58771fee-cc13-4990-a654-794f821cca3b...
[SEED] Note: Error deleting availability slots for business 58771fee-cc13-4990-a654-794f821cca3b: column availabilitySlots.providerId does not exist
[SEED] Successfully cleaned up business 58771fee-cc13-4990-a654-794f821cca3b and all related data.
[CLEANUP] ✅ Successfully cleaned up business: dsfd
[CLEANUP] 🧹 Cleaning up business: Beauty Asiul (DEV) - ID: 162cd203-b632-44e4-a9d5-081e247421bd
[SEED] Starting cleanup for business ID: 162cd203-b632-44e4-a9d5-081e247421bd...
[SEED] Note: Error deleting availability slots for business 162cd203-b632-44e4-a9d5-081e247421bd: column availabilitySlots.providerId does not exist
[SEED] Successfully cleaned up business 162cd203-b632-44e4-a9d5-081e247421bd and all related data.
[CLEANUP] ✅ Successfully cleaned up business: Beauty Asiul (DEV)
[CLEANUP] 🎉 All Luisa business data cleaned up successfully!
✅ Old business data cleaned up successfully
📱 Using phone: +61452490450
📱 Using WhatsApp: +15551890570
📞 Using Phone Number ID: 684078768113901
[SEED] Starting database seeding for Luisa's Business (Beauty Asiul)...
[SEED] Environment: {
  supabaseUrl: 'Using provided client',
  hasServiceRoleKey: true,
  usingProvidedClient: true,
  productionUrl: 'https://itjtaeggupasvrepfkcw.supabase.co',
  hasProductionServiceRoleKey: true,
  hasCustomConfig: true
}
[SEED] Using business configuration: {
  name: 'Beauty Asiul (DEV)',
  email: 'luisa.dev@beautyasiul.com',
  phone: '+61452490450',
  whatsappNumber: '+15551890570',
  whatsappPhoneNumberId: '684078768113901'
}
[SEED] Checking for existing Luisa business data to clean up...
[SEED] No existing Luisa business data found to clean up.
[SEED] Creating new business...
[SEED] Business 'Beauty Asiul (DEV)' created with ID: 5652c914-dc3c-4dc8-a906-6c14c0ec58b8
[SEED] Creating owner provider...
[SEED] About to create user with data: {
  email: 'luisa.dev@beautyasiul.com',
  whatsappNumber: '+15551890570',
  businessId: '5652c914-dc3c-4dc8-a906-6c14c0ec58b8'
}
[User.add] No existing auth user found. Creating new one.
[User.add] About to upsert user profile: {
  id: '979de18b-c6c9-43d9-a8a9-fa821ae3af9d',
  firstName: 'Luisa',
  lastName: 'Bernal',
  role: 'admin/provider',
  businessId: '5652c914-dc3c-4dc8-a906-6c14c0ec58b8',
  email: 'luisa.dev@beautyasiul.com',
  phoneNormalized: '61452490450',
  whatsAppNumberNormalized: '15551890570'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[SEED] User 'Luisa Bernal' created with ID: 979de18b-c6c9-43d9-a8a9-fa821ae3af9d
[SEED] Creating services...
[SEED] Service 'Basic Manicure' created with ID: 1f3fd964-35d3-4c60-b082-294e3fc3aae6
[SEED] Service 'Express Manicure' created with ID: 97f29c27-8ea8-4cca-b8b7-04f7339401cd
[SEED] Service 'Gel Manicure' created with ID: cf9f3d08-4111-4783-ad1c-079d960a2395
[SEED] Service 'Press on Manicure' created with ID: 2595aae6-f474-46f1-8194-07bb4d47f94f
[SEED] Service 'Nail Art' created with ID: 411696fe-8863-4efc-99cc-52d4d0d4fb66
[SEED] Service 'Basic Pedicure' created with ID: eb2b0050-e2a1-4696-880a-4fb5e084dc2e
[SEED] Service 'Gel Pedicure' created with ID: c249bc8e-f041-4ad7-b2b7-468f396b6439
[SEED] Service 'Ladies Haircut' created with ID: 33cfcd92-8e30-4287-8e03-d3e2d9c9ae92
[SEED] Service 'Hair Styling' created with ID: e4e2b840-1f36-4181-b131-dd77cde7aeac
[SEED] Service 'Braids' created with ID: 461cc4bc-3684-454f-aa66-d61e4e1df9fb
[SEED] Service 'Blow Dry' created with ID: 0d67c1ba-43ce-46a5-8877-635b333b3e41
[SEED] Service 'Waves' created with ID: 3eaa03a8-295b-47e5-a42b-31bdab702620
[SEED] Service 'Treatments' created with ID: dcbe882b-2619-4804-b41d-46015b113408
[SEED] Creating calendar settings...
[SEED] Calendar settings created with ID: 0f593992-44eb-4615-8958-b29eb28f92dc
[SEED] Skipping manual document creation - will use PDF processing
[SEED] Creating initial availability slots...
[computeAggregatedAvailability] Found 1 providers for business 5652c914-dc3c-4dc8-a906-6c14c0ec58b8
[Environment] Using development environment for server client
[SEED] Created initial availability for 26 days
[SEED] Database seeding completed successfully!
[SEED] Triggering PDF content crawler for document embeddings...
[SEED] Loading luisa-faq.pdf for processing...
[SEED] Loaded PDF file: 78733 bytes
[SEED] Calling PDF content crawler API: http://localhost:3000/api/content-crawler/pdf
 ○ Compiling /api/content-crawler/pdf ...
 ✓ Compiled /api/content-crawler/pdf in 683ms (1639 modules)
[Crawl Setup] Deleting existing output directory: /Users/juanbernal/code/mesieou/2025/simple_booking/crawl-output
[Crawl Setup] Successfully deleted /Users/juanbernal/code/mesieou/2025/simple_booking/crawl-output
[LOGGER] Initialized. Output path: /Users/juanbernal/code/mesieou/2025/simple_booking/crawl-output
[Crawl Setup] Logger initialized. Output path: /Users/juanbernal/code/mesieou/2025/simple_booking/crawl-output
Warning: Setting up fake worker.
[LOGGER] URL processed: pdf-luisa-faq.pdf
[ProcessContent] Global embedding state cleared
[ProcessContent] In-memory Session initialized: 0e6e6bca-50fa-4174-85d6-3a9e8c63a0dd, Business ID: 5652c914-dc3c-4dc8-a906-6c14c0ec58b8
[ProcessContent] Content processing initialized. Session ID: 0e6e6bca-50fa-4174-85d6-3a9e8c63a0dd
[PDF Crawler] DB Session initialized: 0e6e6bca-50fa-4174-85d6-3a9e8c63a0dd. ProcessingState created.
[PDF Crawler] Generating LLM chunks for page: pdf-luisa-faq.pdf#page=1 (LLM Chunk Gen SID: eb227709-481d-4e90-9c39-42829a16ff28)
[PageContentProcessor-PDFSingle] Starting LLM chunk generation for page: pdf-luisa-faq.pdf#page=1 (SID: eb227709-481d-4e90-9c39-42829a16ff28, Domain: luisa-faq.pdf)
[PageContentProcessor-PDFSingle] Pre-splitting content for: pdf-luisa-faq.pdf#page=1 (Original length: 2121 chars)
[PageContentProcessor-PDFSingle] URL pdf-luisa-faq.pdf#page=1 was pre-split into 1 chunk(s) for LLM processing.
[PageContentProcessor-PDFSingle] Processing 1 pre-chunks with concurrency 1 for: pdf-luisa-faq.pdf#page=1
[PageContentProcessor-PDFSingle] Segmenting and categorizing pre-chunk 1/1 for: pdf-luisa-faq.pdf#page=1 (Length: 2121 chars)
[LLMSegmenterCategorizer] Calling actualCategorizeWebsiteContent from content-analysis.ts for URL: pdf-luisa-faq.pdf#page=1
[Categorizer] Starting categorizeWebsiteContent for businessId=5652c914-dc3c-4dc8-a906-6c14c0ec58b8, url=pdf-luisa-faq.pdf#page=1
[Categorizer] Raw response for businessId=5652c914-dc3c-4dc8-a906-6c14c0ec58b8, url=pdf-luisa-faq.pdf#page=1: ```json
[
  {
    "category": 5,
    "content": "1. Where does Luisa work from? Luisa does not operate from a public salon or studio. She provides services from her apartment located at: Apt 11/9 Dryburgh St, Apt 111, West Melbourne VIC 3003",
    "confidence": 0.9,
    "confidenceReason": "The content addresses a common question about the location of Luisa's services, fitting the FAQ category."
  },
  {
    "category": 5,
    "content": "2. Does Luisa accept walk-ins or same-day bookings? Luisa...
[Categorizer] Raw response length: 1829 characters
[JSON Parser] Attempting to parse (first 500 chars): ```json
[
  {
    "category": 5,
    "content": "1. Where does Luisa work from? Luisa does not operate from a public salon or studio. She provides services from her apartment located at: Apt 11/9 Dryburgh St, Apt 111, West Melbourne VIC 3003",
    "confidence": 0.9,
    "confidenceReason": "The content addresses a common question about the location of Luisa's services, fitting the FAQ category."
  },
  {
    "category": 5,
    "content": "2. Does Luisa accept walk-ins or same-day bookings? Luisa...
[JSON Parser] Initial parse failed, attempting to extract JSON array
[JSON Parser] Extracted JSON (first 500 chars): [
  {
    "category": 5,
    "content": "1. Where does Luisa work from? Luisa does not operate from a public salon or studio. She provides services from her apartment located at: Apt 11/9 Dryburgh St, Apt 111, West Melbourne VIC 3003",
    "confidence": 0.9,
    "confidenceReason": "The content addresses a common question about the location of Luisa's services, fitting the FAQ category."
  },
  {
    "category": 5,
    "content": "2. Does Luisa accept walk-ins or same-day bookings? Luisa may acc...
[Categorizer] Parsed 4 items from LLM response
[PageContentProcessor-PDFSingle] Pre-chunk 1/1 for URL pdf-luisa-faq.pdf#page=1 yielded 4 LLM-defined sub-chunks.
[PageContentProcessor-PDFSingle] Finished LLM chunk generation for page: pdf-luisa-faq.pdf#page=1. Generated 4 chunks.
[PDF Crawler] Generated 4 LLM chunks for pdf-luisa-faq.pdf#page=1.
[ProcessContentPerPage] Processing 4 chunks for page: pdf-luisa-faq.pdf#page=1
[ProcessContent] Step 1: Preparing initial DocumentData objects from LLM chunks...
[ProcessContent] Step 1 completed. 4 documents created and ready for embedding. 0 duplicates skipped.
[ProcessContent] Step 2: Generating embeddings for 4 documents...
[ProcessContent] After filtering: 4 documents need embeddings (filtered out 0)
[ProcessContent] Processing 4 embedding tasks with concurrency 4
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=1, interactionId: d8e1daeb9afffaf7e0e01f451b093fe2e9cd720a10b60ee6af3c860e8297d5b2_embedding, text (first 80 chars): "1. Where does Luisa work from? Luisa does not operate from a public salon or stu..."
[generateEmbedding] Attempting for text (first 80 chars): "1. Where does Luisa work from? Luisa does not operate from a public salon or stu..."
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=1, interactionId: a7d3815be28272b80a3180b3c68ea2b53d9e817ab0a97f6fdb2d58884a62d3c5_embedding, text (first 80 chars): "2. Does Luisa accept walk-ins or same-day bookings? Luisa may accept same-day bo..."
[generateEmbedding] Attempting for text (first 80 chars): "2. Does Luisa accept walk-ins or same-day bookings? Luisa may accept same-day bo..."
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=1, interactionId: e374652180692cd0eee78fa83381a6081242eee40b14b407e0c75fa91c04440a_embedding, text (first 80 chars): "3. What is Luisa’s deposit policy? ● A 50% deposit is required to secure an appo..."
[generateEmbedding] Attempting for text (first 80 chars): "3. What is Luisa’s deposit policy? ● A 50% deposit is required to secure an appo..."
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=1, interactionId: d8f0982b48289709948600fbafebc768623da93ac468652ffc1f9d1bac9b7059_embedding, text (first 80 chars): "4. What if I can’t pay the deposit? Some clients have been allowed to pay the fu..."
[generateEmbedding] Attempting for text (first 80 chars): "4. What if I can’t pay the deposit? Some clients have been allowed to pay the fu..."
[generateEmbedding] SUCCESS for text (first 80 chars): "3. What is Luisa’s deposit policy? ● A 50% deposit is required to secure an appo..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for e374652180692cd0eee78fa83381a6081242eee40b14b407e0c75fa91c04440a_embedding. Result vector (first 3 elements): [
  -0.042299628257751465,
  -0.008409037254750729,
  -0.0005818060599267483
]
[Embedding] Successfully generated embedding for doc hash e374652180692cd0eee78fa83381a6081242eee40b14b407e0c75fa91c04440a from source pdf-luisa-faq.pdf#page=1 in 459ms.
[generateEmbedding] SUCCESS for text (first 80 chars): "1. Where does Luisa work from? Luisa does not operate from a public salon or stu..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for d8e1daeb9afffaf7e0e01f451b093fe2e9cd720a10b60ee6af3c860e8297d5b2_embedding. Result vector (first 3 elements): [ -0.08066321164369583, -0.030090665444731712, 0.06685690581798553 ]
[Embedding] Successfully generated embedding for doc hash d8e1daeb9afffaf7e0e01f451b093fe2e9cd720a10b60ee6af3c860e8297d5b2 from source pdf-luisa-faq.pdf#page=1 in 465ms.
[generateEmbedding] SUCCESS for text (first 80 chars): "4. What if I can’t pay the deposit? Some clients have been allowed to pay the fu..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for d8f0982b48289709948600fbafebc768623da93ac468652ffc1f9d1bac9b7059_embedding. Result vector (first 3 elements): [ -0.007707362063229084, 0.006981813348829746, 0.01854603923857212 ]
[Embedding] Successfully generated embedding for doc hash d8f0982b48289709948600fbafebc768623da93ac468652ffc1f9d1bac9b7059 from source pdf-luisa-faq.pdf#page=1 in 490ms.
[generateEmbedding] SUCCESS for text (first 80 chars): "2. Does Luisa accept walk-ins or same-day bookings? Luisa may accept same-day bo..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for a7d3815be28272b80a3180b3c68ea2b53d9e817ab0a97f6fdb2d58884a62d3c5_embedding. Result vector (first 3 elements): [ -0.05520404502749443, -0.02170209027826786, 0.0344795286655426 ]
[Embedding] Successfully generated embedding for doc hash a7d3815be28272b80a3180b3c68ea2b53d9e817ab0a97f6fdb2d58884a62d3c5 from source pdf-luisa-faq.pdf#page=1 in 494ms.
[ProcessContent] Step 2 completed. Embeddings generated (or attempted) for all documents. Stats: 4 attempts, 0 failures.
[ProcessContentPerPage] Saving JSON artifacts for 4 documents from page: pdf-luisa-faq.pdf#page=1
[ProcessContentPerPage] Finished saving JSON artifacts for page: pdf-luisa-faq.pdf#page=1
[ProcessContentPerPage] Finished processing and embedding for page: pdf-luisa-faq.pdf#page=1. Current total docs in state: 4
[PDF Crawler] Submitted 4 chunks from pdf-luisa-faq.pdf#page=1 for embedding and DB processing (DB SID: 0e6e6bca-50fa-4174-85d6-3a9e8c63a0dd).
[PDF Crawler] Generating LLM chunks for page: pdf-luisa-faq.pdf#page=2 (LLM Chunk Gen SID: eb227709-481d-4e90-9c39-42829a16ff28)
[PageContentProcessor-PDFSingle] Starting LLM chunk generation for page: pdf-luisa-faq.pdf#page=2 (SID: eb227709-481d-4e90-9c39-42829a16ff28, Domain: luisa-faq.pdf)
[PageContentProcessor-PDFSingle] Pre-splitting content for: pdf-luisa-faq.pdf#page=2 (Original length: 2443 chars)
[PageContentProcessor-PDFSingle] URL pdf-luisa-faq.pdf#page=2 was pre-split into 1 chunk(s) for LLM processing.
[PageContentProcessor-PDFSingle] Processing 1 pre-chunks with concurrency 1 for: pdf-luisa-faq.pdf#page=2
[PageContentProcessor-PDFSingle] Segmenting and categorizing pre-chunk 1/1 for: pdf-luisa-faq.pdf#page=2 (Length: 2443 chars)
[LLMSegmenterCategorizer] Calling actualCategorizeWebsiteContent from content-analysis.ts for URL: pdf-luisa-faq.pdf#page=2
[Categorizer] Starting categorizeWebsiteContent for businessId=5652c914-dc3c-4dc8-a906-6c14c0ec58b8, url=pdf-luisa-faq.pdf#page=2
[Categorizer] Raw response for businessId=5652c914-dc3c-4dc8-a906-6c14c0ec58b8, url=pdf-luisa-faq.pdf#page=2: ```json
[
  {
    "category": 5,
    "content": "5. Is payment in cash required? Yes, Luisa generally prefers or requires payment in cash unless otherwise agreed. She reminds customers of this frequently before appointments.",
    "confidence": 0.9,
    "confidenceReason": "The content addresses a common question about payment methods, fitting the FAQ category."
  },
  {
    "category": 5,
    "content": "6. What happens if Luisa is running late? Luisa occasionally runs late and notifies the cli...
[Categorizer] Raw response length: 2586 characters
[JSON Parser] Attempting to parse (first 500 chars): ```json
[
  {
    "category": 5,
    "content": "5. Is payment in cash required? Yes, Luisa generally prefers or requires payment in cash unless otherwise agreed. She reminds customers of this frequently before appointments.",
    "confidence": 0.9,
    "confidenceReason": "The content addresses a common question about payment methods, fitting the FAQ category."
  },
  {
    "category": 5,
    "content": "6. What happens if Luisa is running late? Luisa occasionally runs late and notifies the cli...
[JSON Parser] Initial parse failed, attempting to extract JSON array
[JSON Parser] Extracted JSON (first 500 chars): [
  {
    "category": 5,
    "content": "5. Is payment in cash required? Yes, Luisa generally prefers or requires payment in cash unless otherwise agreed. She reminds customers of this frequently before appointments.",
    "confidence": 0.9,
    "confidenceReason": "The content addresses a common question about payment methods, fitting the FAQ category."
  },
  {
    "category": 5,
    "content": "6. What happens if Luisa is running late? Luisa occasionally runs late and notifies the client. Cli...
[Categorizer] Parsed 7 items from LLM response
[PageContentProcessor-PDFSingle] Pre-chunk 1/1 for URL pdf-luisa-faq.pdf#page=2 yielded 7 LLM-defined sub-chunks.
[PageContentProcessor-PDFSingle] Finished LLM chunk generation for page: pdf-luisa-faq.pdf#page=2. Generated 7 chunks.
[PDF Crawler] Generated 7 LLM chunks for pdf-luisa-faq.pdf#page=2.
[ProcessContentPerPage] Processing 7 chunks for page: pdf-luisa-faq.pdf#page=2
[ProcessContent] Step 1: Preparing initial DocumentData objects from LLM chunks...
[ProcessContent] Step 1 completed. 11 documents created and ready for embedding. 0 duplicates skipped.
[ProcessContent] Step 2: Generating embeddings for 11 documents...
[ProcessContent] Filtering out document d8e1daeb9afffaf7e0e01f451b093fe2e9cd720a10b60ee6af3c860e8297d5b2 - already has embedding
[ProcessContent] Filtering out document a7d3815be28272b80a3180b3c68ea2b53d9e817ab0a97f6fdb2d58884a62d3c5 - already has embedding
[ProcessContent] Filtering out document e374652180692cd0eee78fa83381a6081242eee40b14b407e0c75fa91c04440a - already has embedding
[ProcessContent] Filtering out document d8f0982b48289709948600fbafebc768623da93ac468652ffc1f9d1bac9b7059 - already has embedding
[ProcessContent] After filtering: 7 documents need embeddings (filtered out 4)
[ProcessContent] Processing 7 embedding tasks with concurrency 7
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=2, interactionId: 6ec6b5023b0873a459db642bf4cd7657424c581c2f2509041ec71e99553cd6d0_embedding, text (first 80 chars): "5. Is payment in cash required? Yes, Luisa generally prefers or requires payment..."
[generateEmbedding] Attempting for text (first 80 chars): "5. Is payment in cash required? Yes, Luisa generally prefers or requires payment..."
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=2, interactionId: 8eb2079f83e9225892fd87de7ecb696018ef676174196762d19e42df78487271_embedding, text (first 80 chars): "6. What happens if Luisa is running late? Luisa occasionally runs late and notif..."
[generateEmbedding] Attempting for text (first 80 chars): "6. What happens if Luisa is running late? Luisa occasionally runs late and notif..."
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=2, interactionId: 67f47f33269e7c6bbb0e35d41cde59fe6989a23192f70faeec5c7f247ce6dc91_embedding, text (first 80 chars): "7. Can I cancel or reschedule my appointment? Yes, you can cancel or reschedule,..."
[generateEmbedding] Attempting for text (first 80 chars): "7. Can I cancel or reschedule my appointment? Yes, you can cancel or reschedule,..."
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=2, interactionId: f015b774c44b7bad22453851e0e904def5ae0f78b18c9ada68094961db5a5eb2_embedding, text (first 80 chars): "8. Can someone else come to the appointment or wait? Luisa has not objected to c..."
[generateEmbedding] Attempting for text (first 80 chars): "8. Can someone else come to the appointment or wait? Luisa has not objected to c..."
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=2, interactionId: 268b2b0725a42d7cf9d7cc225da3d25ae644cd1e22226bbb620ae456efd89e28_embedding, text (first 80 chars): "9. How long do services take? ● Braiding: Approx. 1 hour ● Shellac Manicure: Not..."
[generateEmbedding] Attempting for text (first 80 chars): "9. How long do services take? ● Braiding: Approx. 1 hour ● Shellac Manicure: Not..."
[generateEmbedding] SUCCESS for text (first 80 chars): "7. Can I cancel or reschedule my appointment? Yes, you can cancel or reschedule,..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for 67f47f33269e7c6bbb0e35d41cde59fe6989a23192f70faeec5c7f247ce6dc91_embedding. Result vector (first 3 elements): [ -0.03216256573796272, 0.058110591024160385, 0.0316060408949852 ]
[Embedding] Successfully generated embedding for doc hash 67f47f33269e7c6bbb0e35d41cde59fe6989a23192f70faeec5c7f247ce6dc91 from source pdf-luisa-faq.pdf#page=2 in 404ms.
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=2, interactionId: db5ee02668dac94a058008c21a63a285fc160d2d3b38d6b52bf6ab298fc6a26d_embedding, text (first 80 chars): "10. Can Luisa accommodate last-minute changes or delays? Yes, she tries to be fl..."
[generateEmbedding] Attempting for text (first 80 chars): "10. Can Luisa accommodate last-minute changes or delays? Yes, she tries to be fl..."
[generateEmbedding] SUCCESS for text (first 80 chars): "6. What happens if Luisa is running late? Luisa occasionally runs late and notif..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for 8eb2079f83e9225892fd87de7ecb696018ef676174196762d19e42df78487271_embedding. Result vector (first 3 elements): [ -0.022666484117507935, 0.00834975577890873, 0.032971858978271484 ]
[Embedding] Successfully generated embedding for doc hash 8eb2079f83e9225892fd87de7ecb696018ef676174196762d19e42df78487271 from source pdf-luisa-faq.pdf#page=2 in 472ms.
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=2, interactionId: 62f609db570b6342be46d4a1f82723ac13a2785e4373ec5cdb315423f0cc2310_embedding, text (first 80 chars): "11. Does Luisa provide mobile services?..."
[generateEmbedding] Attempting for text (first 80 chars): "11. Does Luisa provide mobile services?..."
[generateEmbedding] SUCCESS for text (first 80 chars): "5. Is payment in cash required? Yes, Luisa generally prefers or requires payment..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for 6ec6b5023b0873a459db642bf4cd7657424c581c2f2509041ec71e99553cd6d0_embedding. Result vector (first 3 elements): [ -0.021836215630173683, -0.0003163654182571918, 0.017626497894525528 ]
[Embedding] Successfully generated embedding for doc hash 6ec6b5023b0873a459db642bf4cd7657424c581c2f2509041ec71e99553cd6d0 from source pdf-luisa-faq.pdf#page=2 in 710ms.
[generateEmbedding] SUCCESS for text (first 80 chars): "8. Can someone else come to the appointment or wait? Luisa has not objected to c..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for f015b774c44b7bad22453851e0e904def5ae0f78b18c9ada68094961db5a5eb2_embedding. Result vector (first 3 elements): [ -0.01895017735660076, 0.007885674946010113, 0.03438045084476471 ]
[Embedding] Successfully generated embedding for doc hash f015b774c44b7bad22453851e0e904def5ae0f78b18c9ada68094961db5a5eb2 from source pdf-luisa-faq.pdf#page=2 in 735ms.
[generateEmbedding] SUCCESS for text (first 80 chars): "11. Does Luisa provide mobile services?..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for 62f609db570b6342be46d4a1f82723ac13a2785e4373ec5cdb315423f0cc2310_embedding. Result vector (first 3 elements): [ -0.02984096296131611, -0.030331579968333244, 0.028022799640893936 ]
[Embedding] Successfully generated embedding for doc hash 62f609db570b6342be46d4a1f82723ac13a2785e4373ec5cdb315423f0cc2310 from source pdf-luisa-faq.pdf#page=2 in 811ms.
[generateEmbedding] SUCCESS for text (first 80 chars): "10. Can Luisa accommodate last-minute changes or delays? Yes, she tries to be fl..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for db5ee02668dac94a058008c21a63a285fc160d2d3b38d6b52bf6ab298fc6a26d_embedding. Result vector (first 3 elements): [ -0.022480318322777748, 0.0016339985886588693, 0.04803164675831795 ]
[Embedding] Successfully generated embedding for doc hash db5ee02668dac94a058008c21a63a285fc160d2d3b38d6b52bf6ab298fc6a26d from source pdf-luisa-faq.pdf#page=2 in 859ms.
[generateEmbedding] SUCCESS for text (first 80 chars): "9. How long do services take? ● Braiding: Approx. 1 hour ● Shellac Manicure: Not..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for 268b2b0725a42d7cf9d7cc225da3d25ae644cd1e22226bbb620ae456efd89e28_embedding. Result vector (first 3 elements): [ -0.033706001937389374, 0.049797751009464264, 0.061181433498859406 ]
[Embedding] Successfully generated embedding for doc hash 268b2b0725a42d7cf9d7cc225da3d25ae644cd1e22226bbb620ae456efd89e28 from source pdf-luisa-faq.pdf#page=2 in 865ms.
[ProcessContent] Step 2 completed. Embeddings generated (or attempted) for all documents. Stats: 11 attempts, 0 failures.
[ProcessContentPerPage] Saving JSON artifacts for 7 documents from page: pdf-luisa-faq.pdf#page=2
[ProcessContentPerPage] Finished saving JSON artifacts for page: pdf-luisa-faq.pdf#page=2
[ProcessContentPerPage] Finished processing and embedding for page: pdf-luisa-faq.pdf#page=2. Current total docs in state: 11
[PDF Crawler] Submitted 7 chunks from pdf-luisa-faq.pdf#page=2 for embedding and DB processing (DB SID: 0e6e6bca-50fa-4174-85d6-3a9e8c63a0dd).
[PDF Crawler] Generating LLM chunks for page: pdf-luisa-faq.pdf#page=3 (LLM Chunk Gen SID: eb227709-481d-4e90-9c39-42829a16ff28)
[PageContentProcessor-PDFSingle] Starting LLM chunk generation for page: pdf-luisa-faq.pdf#page=3 (SID: eb227709-481d-4e90-9c39-42829a16ff28, Domain: luisa-faq.pdf)
[PageContentProcessor-PDFSingle] Pre-splitting content for: pdf-luisa-faq.pdf#page=3 (Original length: 683 chars)
[PageContentProcessor-PDFSingle] URL pdf-luisa-faq.pdf#page=3 was pre-split into 1 chunk(s) for LLM processing.
[PageContentProcessor-PDFSingle] Processing 1 pre-chunks with concurrency 1 for: pdf-luisa-faq.pdf#page=3
[PageContentProcessor-PDFSingle] Segmenting and categorizing pre-chunk 1/1 for: pdf-luisa-faq.pdf#page=3 (Length: 683 chars)
[LLMSegmenterCategorizer] Calling actualCategorizeWebsiteContent from content-analysis.ts for URL: pdf-luisa-faq.pdf#page=3
[Categorizer] Starting categorizeWebsiteContent for businessId=5652c914-dc3c-4dc8-a906-6c14c0ec58b8, url=pdf-luisa-faq.pdf#page=3
[Categorizer] Raw response for businessId=5652c914-dc3c-4dc8-a906-6c14c0ec58b8, url=pdf-luisa-faq.pdf#page=3: ```json
[
  {
    "category": 5,
    "content": "No. When asked, she confirmed she only attends in North Melbourne. 12. What if I can’t reach Luisa? Clients sometimes call or message repeatedly when arriving. If there's a delay, it’s best to: ● Message again via WhatsApp ● Wait in the lobby or outside Apt 111 ● Be patient, as she may be attending another client or caring for her child",
    "confidence": 0.9,
    "confidenceReason": "The content addresses common questions and provides guidance o...
[Categorizer] Raw response length: 591 characters
[JSON Parser] Attempting to parse (first 500 chars): ```json
[
  {
    "category": 5,
    "content": "No. When asked, she confirmed she only attends in North Melbourne. 12. What if I can’t reach Luisa? Clients sometimes call or message repeatedly when arriving. If there's a delay, it’s best to: ● Message again via WhatsApp ● Wait in the lobby or outside Apt 111 ● Be patient, as she may be attending another client or caring for her child",
    "confidence": 0.9,
    "confidenceReason": "The content addresses common questions and provides guidance o...
[JSON Parser] Initial parse failed, attempting to extract JSON array
[JSON Parser] Extracted JSON (first 500 chars): [
  {
    "category": 5,
    "content": "No. When asked, she confirmed she only attends in North Melbourne. 12. What if I can’t reach Luisa? Clients sometimes call or message repeatedly when arriving. If there's a delay, it’s best to: ● Message again via WhatsApp ● Wait in the lobby or outside Apt 111 ● Be patient, as she may be attending another client or caring for her child",
    "confidence": 0.9,
    "confidenceReason": "The content addresses common questions and provides guidance on what t...
[Categorizer] Parsed 1 items from LLM response
[PageContentProcessor-PDFSingle] Pre-chunk 1/1 for URL pdf-luisa-faq.pdf#page=3 yielded 1 LLM-defined sub-chunks.
[PageContentProcessor-PDFSingle] Finished LLM chunk generation for page: pdf-luisa-faq.pdf#page=3. Generated 1 chunks.
[PDF Crawler] Generated 1 LLM chunks for pdf-luisa-faq.pdf#page=3.
[ProcessContentPerPage] Processing 1 chunks for page: pdf-luisa-faq.pdf#page=3
[ProcessContent] Step 1: Preparing initial DocumentData objects from LLM chunks...
[ProcessContent] Step 1 completed. 12 documents created and ready for embedding. 0 duplicates skipped.
[ProcessContent] Step 2: Generating embeddings for 12 documents...
[ProcessContent] Filtering out document d8e1daeb9afffaf7e0e01f451b093fe2e9cd720a10b60ee6af3c860e8297d5b2 - already has embedding
[ProcessContent] Filtering out document a7d3815be28272b80a3180b3c68ea2b53d9e817ab0a97f6fdb2d58884a62d3c5 - already has embedding
[ProcessContent] Filtering out document e374652180692cd0eee78fa83381a6081242eee40b14b407e0c75fa91c04440a - already has embedding
[ProcessContent] Filtering out document d8f0982b48289709948600fbafebc768623da93ac468652ffc1f9d1bac9b7059 - already has embedding
[ProcessContent] Filtering out document 6ec6b5023b0873a459db642bf4cd7657424c581c2f2509041ec71e99553cd6d0 - already has embedding
[ProcessContent] Filtering out document 8eb2079f83e9225892fd87de7ecb696018ef676174196762d19e42df78487271 - already has embedding
[ProcessContent] Filtering out document 67f47f33269e7c6bbb0e35d41cde59fe6989a23192f70faeec5c7f247ce6dc91 - already has embedding
[ProcessContent] Filtering out document f015b774c44b7bad22453851e0e904def5ae0f78b18c9ada68094961db5a5eb2 - already has embedding
[ProcessContent] Filtering out document 268b2b0725a42d7cf9d7cc225da3d25ae644cd1e22226bbb620ae456efd89e28 - already has embedding
[ProcessContent] Filtering out document db5ee02668dac94a058008c21a63a285fc160d2d3b38d6b52bf6ab298fc6a26d - already has embedding
[ProcessContent] Filtering out document 62f609db570b6342be46d4a1f82723ac13a2785e4373ec5cdb315423f0cc2310 - already has embedding
[ProcessContent] After filtering: 1 documents need embeddings (filtered out 11)
[ProcessContent] Processing 1 embedding tasks with concurrency 1
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=3, interactionId: 4cca31342739067c15b469e87a0e12c929d90c8f1516b2d8aed3fad3ad5f0137_embedding, text (first 80 chars): "No. When asked, she confirmed she only attends in North Melbourne. 12. What if I..."
[generateEmbedding] Attempting for text (first 80 chars): "No. When asked, she confirmed she only attends in North Melbourne. 12. What if I..."
[generateEmbedding] SUCCESS for text (first 80 chars): "No. When asked, she confirmed she only attends in North Melbourne. 12. What if I..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for 4cca31342739067c15b469e87a0e12c929d90c8f1516b2d8aed3fad3ad5f0137_embedding. Result vector (first 3 elements): [ -0.05200827121734619, 0.002890700241550803, 0.040160395205020905 ]
[Embedding] Successfully generated embedding for doc hash 4cca31342739067c15b469e87a0e12c929d90c8f1516b2d8aed3fad3ad5f0137 from source pdf-luisa-faq.pdf#page=3 in 358ms.
[ProcessContent] Step 2 completed. Embeddings generated (or attempted) for all documents. Stats: 12 attempts, 0 failures.
[ProcessContentPerPage] Saving JSON artifacts for 1 documents from page: pdf-luisa-faq.pdf#page=3
[ProcessContentPerPage] Finished saving JSON artifacts for page: pdf-luisa-faq.pdf#page=3
[ProcessContentPerPage] Finished processing and embedding for page: pdf-luisa-faq.pdf#page=3. Current total docs in state: 12
[PDF Crawler] Submitted 1 chunks from pdf-luisa-faq.pdf#page=3 for embedding and DB processing (DB SID: 0e6e6bca-50fa-4174-85d6-3a9e8c63a0dd).
[ProcessContentFinalize] Finalizing content processing...
[ProcessContent] Collecting documents with their embeddings for final save...
[ProcessContent] Collected 12 documents (with embeddeddings) for saving.
[ProcessContent] Successful pages (with at least one saved chunk): 3
[ProcessContent] Step 3: Logging primary summary artifacts (manifests)...
[ProcessContent] Step 3 completed. Primary summary artifacts (manifests) logged.
[ProcessContentFinalize] Attempting to save session 0e6e6bca-50fa-4174-85d6-3a9e8c63a0dd with 12 documents (embeddings included) to database...
[Environment] Using development environment for service-role client
[CrawlSession.addSessionWithDocumentsAndEmbeddings] Using production service role client (PDF crawler production mode)
[ProcessContentFinalize] Successfully saved session 0e6e6bca-50fa-4174-85d6-3a9e8c63a0dd with 12 documents.
[ProcessContent] Step 3: Logging primary summary artifacts (manifests)...
[ProcessContent] Step 3 completed. Primary summary artifacts (manifests) logged.
[ProcessContentFinalize] Re-saved manifests with updated document DB IDs.
[ProcessContentFinalize] Content processing for session 0e6e6bca-50fa-4174-85d6-3a9e8c63a0dd finalized successfully.
[PDF Crawler] Content processing finalized. Final status/session ID: 0e6e6bca-50fa-4174-85d6-3a9e8c63a0dd
[LOGGER] Could not parse URL pdf-luisa-faq.pdf#page=1 to extract domain.
[LOGGER] Could not parse URL pdf-luisa-faq.pdf#page=2 to extract domain.
[LOGGER] Could not parse URL pdf-luisa-faq.pdf#page=3 to extract domain.
[LOGGER] Summary saved to /Users/juanbernal/code/mesieou/2025/simple_booking/crawl-output/summary.json
 POST /api/content-crawler/pdf 200 in 27979ms
[SEED] PDF content crawler API response: {
  message: 'PDF processed successfully',
  result: {
    mergedText: '1. Where does Luisa work from? Luisa does not operate from a public salon or studio. She provides services from her apartment located at: Apt 11/9 Dryburgh St, Apt 111, West Melbourne VIC 3003\n' +
      '\n' +
      "2. Does Luisa accept walk-ins or same-day bookings? Luisa may accept same-day bookings if she has availability, but it's always best to confirm through WhatsApp. She frequently shares availability for same-day or next-day appointments when asked.\n" +
      '\n' +
      '3. What is Luisa’s deposit policy? ● A 50% deposit is required to secure an appointment. Deposit can be paid via bank transfer to: makefile CopyEdit Name: Lisa Bernal Number: +61 451 375 263 ● ● The deposit is refundable only if: ○ The cancellation is made at least 24 hours in advance, or ○ The appointment is rescheduled more than 24 hours ahead.\n' +
      '\n' +
      '4. What if I can’t pay the deposit? Some clients have been allowed to pay the full amount in cash on the day of the appointment if they don’t have a local bank account (e.g., only Bancolombia available). Luisa seems flexible on this on a case-by-case basis.\n' +
      '\n' +
      '5. Is payment in cash required? Yes, Luisa generally prefers or requires payment in cash unless otherwise agreed. She reminds customers of this frequently before appointments.\n' +
      '\n' +
      '6. What happens if Luisa is running late? Luisa occasionally runs late and notifies the client. Clients are usually asked to wait in the apartment lobby. She is apologetic and communicative about delays.\n' +
      '\n' +
      '7. Can I cancel or reschedule my appointment? Yes, you can cancel or reschedule, but it must be at least 24 hours in advance to retain your deposit. Last-minute cancellations or no-shows may forfeit the deposit.\n' +
      '\n' +
      '8. Can someone else come to the appointment or wait? Luisa has not objected to clients bringing someone or waiting nearby, but this should be confirmed in advance as her studio is in her private residence.\n' +
      '\n' +
      '9. How long do services take? ● Braiding: Approx. 1 hour ● Shellac Manicure: Not explicitly stated, but appointments are often scheduled in 1 – 1.5 hour windows\n' +
      '\n' +
      '10. Can Luisa accommodate last-minute changes or delays? Yes, she tries to be flexible. Clients running late or changing plans often communicate with her and she adjusts where possible, depending on her schedule.\n' +
      '\n' +
      '11. Does Luisa provide mobile services?\n' +
      '\n' +
      "No. When asked, she confirmed she only attends in North Melbourne. 12. What if I can’t reach Luisa? Clients sometimes call or message repeatedly when arriving. If there's a delay, it’s best to: ● Message again via WhatsApp ● Wait in the lobby or outside Apt 111 ● Be patient, as she may be attending another client or caring for her child",
    pageCount: 3,
    uniqueParagraphs: 12,
    businessId: '5652c914-dc3c-4dc8-a906-6c14c0ec58b8',
    source: 'luisa-faq.pdf',
    embeddingsStatus: 'Processed with DB Session ID: 0e6e6bca-50fa-4174-85d6-3a9e8c63a0dd'
  },
  pdfName: 'luisa-faq.pdf'
}
[SEED] PDF content crawler completed: PDF processed successfully
[SEED] ❌ PDF content crawler failed - this is CRITICAL for business functionality
[SEED] Error details: Failed to query embeddings: column embeddings.businessId does not exist
[SEED] Error during business creation, cleaning up partial data...
[SEED] Error details: Luisa business seed failed: PDF crawler error - Failed to query embeddings: column embeddings.businessId does not exist
[SEED] Cleaning up partially created business with ID: 5652c914-dc3c-4dc8-a906-6c14c0ec58b8
[SEED] Starting cleanup for business ID: 5652c914-dc3c-4dc8-a906-6c14c0ec58b8...
[SEED] Note: Error deleting availability slots for business 5652c914-dc3c-4dc8-a906-6c14c0ec58b8: column availabilitySlots.providerId does not exist
[SEED] Successfully cleaned up business 5652c914-dc3c-4dc8-a906-6c14c0ec58b8 and all related data.
[SEED] Cleanup completed successfully.
❌ Luisa seed failed: Error: Luisa business seed failed: PDF crawler error - Failed to query embeddings: column embeddings.businessId does not exist
    at createLuisaTestBusiness (lib/database/seed/create-luisa-test-business.ts:369:10)
    at async POST (app/api/seed/luisa/route.ts:62:19)
  367 |     console.error('[SEED] ❌ PDF content crawler failed - this is CRITICAL for business functionality');
  368 |     console.error('[SEED] Error details:', error instanceof Error ? error.message : String(error));
> 369 |     throw new Error(`Luisa business seed failed: PDF crawler error - ${error instanceof Error ? error.message : String(error)}`);
      |          ^
  370 |   }
  371 |   
  372 |     return {
 POST /api/seed/luisa 500 in 33530ms
 ✓ Compiled in 157ms (54 modules)
 ⨯ ./lib/database/seed/create-luisa-test-business.ts
Module parse failed: Identifier 'documentIds' has already been declared (304:14)
|         // --- TRIGGER PDF CONTENT CRAWLER FOR EMBEDDINGS ---
|         console.log('[SEED] Triggering PDF content crawler for document embeddings...');
>         const documentIds = [];
|         try {
|             const crawlerResult = await triggerPdfContentCrawler(createdBusiness.id);

Import trace for requested module:
./lib/database/seed/create-luisa-test-business.ts
./app/api/seed/luisa/route.ts
 ○ Compiling /_not-found ...
 ⨯ ./lib/database/seed/create-luisa-test-business.ts
Module parse failed: Identifier 'documentIds' has already been declared (304:14)
|         // --- TRIGGER PDF CONTENT CRAWLER FOR EMBEDDINGS ---
|         console.log('[SEED] Triggering PDF content crawler for document embeddings...');
>         const documentIds = [];
|         try {
|             const crawlerResult = await triggerPdfContentCrawler(createdBusiness.id);

Import trace for requested module:
./lib/database/seed/create-luisa-test-business.ts
./app/api/seed/luisa/route.ts
 ⨯ ./lib/database/seed/create-luisa-test-business.ts
Module parse failed: Identifier 'documentIds' has already been declared (304:14)
|         // --- TRIGGER PDF CONTENT CRAWLER FOR EMBEDDINGS ---
|         console.log('[SEED] Triggering PDF content crawler for document embeddings...');
>         const documentIds = [];
|         try {
|             const crawlerResult = await triggerPdfContentCrawler(createdBusiness.id);

Import trace for requested module:
./lib/database/seed/create-luisa-test-business.ts
./app/api/seed/luisa/route.ts
 ⨯ [Error: ENOENT: no such file or directory, open '/Users/juanbernal/code/mesieou/2025/simple_booking/.next/fallback-build-manifest.json'] {
  errno: -2,
  code: 'ENOENT',
  syscall: 'open',
  path: '/Users/juanbernal/code/mesieou/2025/simple_booking/.next/fallback-build-manifest.json'
}
[Error: ENOENT: no such file or directory, open '/Users/juanbernal/code/mesieou/2025/simple_booking/.next/fallback-build-manifest.json'] {
  errno: -2,
  code: 'ENOENT',
  syscall: 'open',
  path: '/Users/juanbernal/code/mesieou/2025/simple_booking/.next/fallback-build-manifest.json'
}
[Error: ENOENT: no such file or directory, open '/Users/juanbernal/code/mesieou/2025/simple_booking/.next/fallback-build-manifest.json'] {
  errno: -2,
  code: 'ENOENT',
  syscall: 'open',
  path: '/Users/juanbernal/code/mesieou/2025/simple_booking/.next/fallback-build-manifest.json'
}
 ⨯ ./lib/database/seed/create-luisa-test-business.ts
Module parse failed: Identifier 'documentIds' has already been declared (304:14)
|         // --- TRIGGER PDF CONTENT CRAWLER FOR EMBEDDINGS ---
|         console.log('[SEED] Triggering PDF content crawler for document embeddings...');
>         const documentIds = [];
|         try {
|             const crawlerResult = await triggerPdfContentCrawler(createdBusiness.id);

Import trace for requested module:
./lib/database/seed/create-luisa-test-business.ts
./app/api/seed/luisa/route.ts
 ⨯ [Error: ENOENT: no such file or directory, open '/Users/juanbernal/code/mesieou/2025/simple_booking/.next/fallback-build-manifest.json'] {
  errno: -2,
  code: 'ENOENT',
  syscall: 'open',
  path: '/Users/juanbernal/code/mesieou/2025/simple_booking/.next/fallback-build-manifest.json'
}
[Error: ENOENT: no such file or directory, open '/Users/juanbernal/code/mesieou/2025/simple_booking/.next/fallback-build-manifest.json'] {
  errno: -2,
  code: 'ENOENT',
  syscall: 'open',
  path: '/Users/juanbernal/code/mesieou/2025/simple_booking/.next/fallback-build-manifest.json'
}
[Error: ENOENT: no such file or directory, open '/Users/juanbernal/code/mesieou/2025/simple_booking/.next/fallback-build-manifest.json'] {
  errno: -2,
  code: 'ENOENT',
  syscall: 'open',
  path: '/Users/juanbernal/code/mesieou/2025/simple_booking/.next/fallback-build-manifest.json'
}
 ✓ Compiled /api/seed/removalist in 392ms (1233 modules)
 ✓ Compiled in 130ms (1233 modules)
 ✓ Compiled in 94ms (54 modules)
 ✓ Compiled /api/seed/luisa in 337ms (397 modules)
💄 Starting Luisa business seed for DEVELOPMENT...
🧹 Cleaning up old Luisa business data in DEV environment...
[CLEANUP] Starting cleanup of Luisa's test business data...
[CLEANUP] Searching for existing Luisa business data...
[CLEANUP] ✅ No Luisa business data found to clean up.
✅ Old business data cleaned up successfully
📱 Using phone: +61452490450
📱 Using WhatsApp: +15551890570
📞 Using Phone Number ID: 684078768113901
[SEED] Starting database seeding for Luisa's Business (Beauty Asiul)...
[SEED] Environment: {
  supabaseUrl: 'Using provided client',
  hasServiceRoleKey: true,
  usingProvidedClient: true,
  productionUrl: 'https://itjtaeggupasvrepfkcw.supabase.co',
  hasProductionServiceRoleKey: true,
  hasCustomConfig: true
}
[SEED] Using business configuration: {
  name: 'Beauty Asiul (DEV)',
  email: 'luisa.dev@beautyasiul.com',
  phone: '+61452490450',
  whatsappNumber: '+15551890570',
  whatsappPhoneNumberId: '684078768113901'
}
[SEED] Checking for existing Luisa business data to clean up...
[SEED] No existing Luisa business data found to clean up.
[SEED] Creating new business...
[SEED] Business 'Beauty Asiul (DEV)' created with ID: 5b26e950-2bd4-42dc-9a50-19e90ad5528d
[SEED] Creating owner provider...
[SEED] About to create user with data: {
  email: 'luisa.dev@beautyasiul.com',
  whatsappNumber: '+15551890570',
  businessId: '5b26e950-2bd4-42dc-9a50-19e90ad5528d'
}
[User.add] No existing auth user found. Creating new one.
[User.add] About to upsert user profile: {
  id: 'e85c0a88-2afd-4d29-8dff-d9361a881585',
  firstName: 'Luisa',
  lastName: 'Bernal',
  role: 'admin/provider',
  businessId: '5b26e950-2bd4-42dc-9a50-19e90ad5528d',
  email: 'luisa.dev@beautyasiul.com',
  phoneNormalized: '61452490450',
  whatsAppNumberNormalized: '15551890570'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[SEED] User 'Luisa Bernal' created with ID: e85c0a88-2afd-4d29-8dff-d9361a881585
[SEED] Creating services...
[SEED] Service 'Basic Manicure' created with ID: b2beb983-7206-49ef-a905-14e89038a81b
[SEED] Service 'Express Manicure' created with ID: ed2dfe55-9389-4833-a023-bd41805e49a5
[SEED] Service 'Gel Manicure' created with ID: 9b21749f-8044-4f1f-bda8-db1a9a618aa6
[SEED] Service 'Press on Manicure' created with ID: 5580212a-fc05-4f2b-81ac-d3a410d5be59
[SEED] Service 'Nail Art' created with ID: c1beff17-6c5c-4820-a442-aaaab24f7547
[SEED] Service 'Basic Pedicure' created with ID: 35880de3-bfb9-4bfd-a0c9-90f0c50305c6
[SEED] Service 'Gel Pedicure' created with ID: 9baaf08b-456a-4b27-97e4-c462e9b83274
[SEED] Service 'Ladies Haircut' created with ID: 35a7cb3a-527f-4074-964d-7f5e443057aa
[SEED] Service 'Hair Styling' created with ID: 732e033e-18de-4bf1-9737-6bb2ecb9b767
[SEED] Service 'Braids' created with ID: dfd614e6-ad84-4da8-b011-dd5824a15ff0
[SEED] Service 'Blow Dry' created with ID: e3ac8610-314d-4c05-907b-d8b3282dfc17
[SEED] Service 'Waves' created with ID: 885e2f27-b3a9-43a1-b630-4cbeb3008b5f
[SEED] Service 'Treatments' created with ID: 55b262e0-58c4-4a30-ba50-3dc0a6d6e4b3
[SEED] Creating calendar settings...
[SEED] Calendar settings created with ID: 10920eca-baad-4b9a-8078-3134fb1977ae
[SEED] Skipping manual document creation - will use PDF processing
[SEED] Creating initial availability slots...
[SEED] Creating initial availability using rollAggregatedAvailability...
[rollAggregatedAvailability] Rolling availability for business 5b26e950-2bd4-42dc-9a50-19e90ad5528d
[rollAggregatedAvailability] Business timezone: Australia/Sydney, today: 2025-07-23
[Environment] Using development environment for server client
[rollAggregatedAvailability] Added availability for 2025-07-23
[rollAggregatedAvailability] Added availability for 2025-07-24
[rollAggregatedAvailability] Added availability for 2025-07-25
[rollAggregatedAvailability] Added availability for 2025-07-26
[rollAggregatedAvailability] No providers work on 2025-07-27
[rollAggregatedAvailability] Added availability for 2025-07-28
[rollAggregatedAvailability] Added availability for 2025-07-29
[rollAggregatedAvailability] Added availability for 2025-07-30
[rollAggregatedAvailability] Added availability for 2025-07-31
[rollAggregatedAvailability] Added availability for 2025-08-01
[rollAggregatedAvailability] Added availability for 2025-08-02
[rollAggregatedAvailability] No providers work on 2025-08-03
[rollAggregatedAvailability] Added availability for 2025-08-04
[rollAggregatedAvailability] Added availability for 2025-08-05
[rollAggregatedAvailability] Added availability for 2025-08-06
[rollAggregatedAvailability] Added availability for 2025-08-07
[rollAggregatedAvailability] Added availability for 2025-08-08
[rollAggregatedAvailability] Added availability for 2025-08-09
[rollAggregatedAvailability] No providers work on 2025-08-10
[rollAggregatedAvailability] Added availability for 2025-08-11
[rollAggregatedAvailability] Added availability for 2025-08-12
[rollAggregatedAvailability] Added availability for 2025-08-13
[rollAggregatedAvailability] Added availability for 2025-08-14
[rollAggregatedAvailability] Added availability for 2025-08-15
[rollAggregatedAvailability] Added availability for 2025-08-16
[rollAggregatedAvailability] No providers work on 2025-08-17
[rollAggregatedAvailability] Added availability for 2025-08-18
[rollAggregatedAvailability] Added availability for 2025-08-19
[rollAggregatedAvailability] Added availability for 2025-08-20
[rollAggregatedAvailability] Added availability for 2025-08-21
[rollAggregatedAvailability] Added availability for 2025-08-22
[rollAggregatedAvailability] Completed for business 5b26e950-2bd4-42dc-9a50-19e90ad5528d
[SEED] ✅ Created initial availability using aggregated rollover system
[SEED] Database seeding completed successfully!
[SEED] Triggering PDF content crawler for document embeddings...
[SEED] Loading luisa-faq.pdf for processing...
[SEED] Loaded PDF file: 78733 bytes
[SEED] Calling PDF content crawler API: http://localhost:3000/api/content-crawler/pdf
 ✓ Compiled /api/content-crawler/pdf in 232ms (556 modules)
[Crawl Setup] Deleting existing output directory: /Users/juanbernal/code/mesieou/2025/simple_booking/crawl-output
[Crawl Setup] Successfully deleted /Users/juanbernal/code/mesieou/2025/simple_booking/crawl-output
[LOGGER] Initialized. Output path: /Users/juanbernal/code/mesieou/2025/simple_booking/crawl-output
[Crawl Setup] Logger initialized. Output path: /Users/juanbernal/code/mesieou/2025/simple_booking/crawl-output
Warning: Setting up fake worker.
[LOGGER] URL processed: pdf-luisa-faq.pdf
[ProcessContent] Global embedding state cleared
[ProcessContent] In-memory Session initialized: b2986d06-0659-4538-9ef7-54b2833f06af, Business ID: 5b26e950-2bd4-42dc-9a50-19e90ad5528d
[ProcessContent] Content processing initialized. Session ID: b2986d06-0659-4538-9ef7-54b2833f06af
[PDF Crawler] DB Session initialized: b2986d06-0659-4538-9ef7-54b2833f06af. ProcessingState created.
[PDF Crawler] Generating LLM chunks for page: pdf-luisa-faq.pdf#page=1 (LLM Chunk Gen SID: c0d316b7-18b2-4efc-945d-58b3c533398e)
[PageContentProcessor-PDFSingle] Starting LLM chunk generation for page: pdf-luisa-faq.pdf#page=1 (SID: c0d316b7-18b2-4efc-945d-58b3c533398e, Domain: luisa-faq.pdf)
[PageContentProcessor-PDFSingle] Pre-splitting content for: pdf-luisa-faq.pdf#page=1 (Original length: 2121 chars)
[PageContentProcessor-PDFSingle] URL pdf-luisa-faq.pdf#page=1 was pre-split into 1 chunk(s) for LLM processing.
[PageContentProcessor-PDFSingle] Processing 1 pre-chunks with concurrency 1 for: pdf-luisa-faq.pdf#page=1
[PageContentProcessor-PDFSingle] Segmenting and categorizing pre-chunk 1/1 for: pdf-luisa-faq.pdf#page=1 (Length: 2121 chars)
[LLMSegmenterCategorizer] Calling actualCategorizeWebsiteContent from content-analysis.ts for URL: pdf-luisa-faq.pdf#page=1
[Categorizer] Starting categorizeWebsiteContent for businessId=5b26e950-2bd4-42dc-9a50-19e90ad5528d, url=pdf-luisa-faq.pdf#page=1
[Categorizer] Raw response for businessId=5b26e950-2bd4-42dc-9a50-19e90ad5528d, url=pdf-luisa-faq.pdf#page=1: ```json
[
  {
    "category": 5,
    "content": "1. Where does Luisa work from? Luisa does not operate from a public salon or studio. She provides services from her apartment located at: Apt 11/9 Dryburgh St, Apt 111, West Melbourne VIC 3003",
    "confidence": 0.9,
    "confidenceReason": "Content answers a common question about the location of services, fitting the FAQ category."
  },
  {
    "category": 3,
    "content": "2. Does Luisa accept walk-ins or same-day bookings? Luisa may accept sa...
[Categorizer] Raw response length: 1821 characters
[JSON Parser] Attempting to parse (first 500 chars): ```json
[
  {
    "category": 5,
    "content": "1. Where does Luisa work from? Luisa does not operate from a public salon or studio. She provides services from her apartment located at: Apt 11/9 Dryburgh St, Apt 111, West Melbourne VIC 3003",
    "confidence": 0.9,
    "confidenceReason": "Content answers a common question about the location of services, fitting the FAQ category."
  },
  {
    "category": 3,
    "content": "2. Does Luisa accept walk-ins or same-day bookings? Luisa may accept sa...
[JSON Parser] Initial parse failed, attempting to extract JSON array
[JSON Parser] Extracted JSON (first 500 chars): [
  {
    "category": 5,
    "content": "1. Where does Luisa work from? Luisa does not operate from a public salon or studio. She provides services from her apartment located at: Apt 11/9 Dryburgh St, Apt 111, West Melbourne VIC 3003",
    "confidence": 0.9,
    "confidenceReason": "Content answers a common question about the location of services, fitting the FAQ category."
  },
  {
    "category": 3,
    "content": "2. Does Luisa accept walk-ins or same-day bookings? Luisa may accept same-day b...
[Categorizer] Parsed 4 items from LLM response
[PageContentProcessor-PDFSingle] Pre-chunk 1/1 for URL pdf-luisa-faq.pdf#page=1 yielded 4 LLM-defined sub-chunks.
[PageContentProcessor-PDFSingle] Finished LLM chunk generation for page: pdf-luisa-faq.pdf#page=1. Generated 4 chunks.
[PDF Crawler] Generated 4 LLM chunks for pdf-luisa-faq.pdf#page=1.
[ProcessContentPerPage] Processing 4 chunks for page: pdf-luisa-faq.pdf#page=1
[ProcessContent] Step 1: Preparing initial DocumentData objects from LLM chunks...
[ProcessContent] Step 1 completed. 4 documents created and ready for embedding. 0 duplicates skipped.
[ProcessContent] Step 2: Generating embeddings for 4 documents...
[ProcessContent] After filtering: 4 documents need embeddings (filtered out 0)
[ProcessContent] Processing 4 embedding tasks with concurrency 4
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=1, interactionId: d8e1daeb9afffaf7e0e01f451b093fe2e9cd720a10b60ee6af3c860e8297d5b2_embedding, text (first 80 chars): "1. Where does Luisa work from? Luisa does not operate from a public salon or stu..."
[generateEmbedding] Attempting for text (first 80 chars): "1. Where does Luisa work from? Luisa does not operate from a public salon or stu..."
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=1, interactionId: a7d3815be28272b80a3180b3c68ea2b53d9e817ab0a97f6fdb2d58884a62d3c5_embedding, text (first 80 chars): "2. Does Luisa accept walk-ins or same-day bookings? Luisa may accept same-day bo..."
[generateEmbedding] Attempting for text (first 80 chars): "2. Does Luisa accept walk-ins or same-day bookings? Luisa may accept same-day bo..."
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=1, interactionId: e374652180692cd0eee78fa83381a6081242eee40b14b407e0c75fa91c04440a_embedding, text (first 80 chars): "3. What is Luisa’s deposit policy? ● A 50% deposit is required to secure an appo..."
[generateEmbedding] Attempting for text (first 80 chars): "3. What is Luisa’s deposit policy? ● A 50% deposit is required to secure an appo..."
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=1, interactionId: d8f0982b48289709948600fbafebc768623da93ac468652ffc1f9d1bac9b7059_embedding, text (first 80 chars): "4. What if I can’t pay the deposit? Some clients have been allowed to pay the fu..."
[generateEmbedding] Attempting for text (first 80 chars): "4. What if I can’t pay the deposit? Some clients have been allowed to pay the fu..."
[generateEmbedding] SUCCESS for text (first 80 chars): "2. Does Luisa accept walk-ins or same-day bookings? Luisa may accept same-day bo..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for a7d3815be28272b80a3180b3c68ea2b53d9e817ab0a97f6fdb2d58884a62d3c5_embedding. Result vector (first 3 elements): [ -0.05520404502749443, -0.02170209027826786, 0.0344795286655426 ]
[Embedding] Successfully generated embedding for doc hash a7d3815be28272b80a3180b3c68ea2b53d9e817ab0a97f6fdb2d58884a62d3c5 from source pdf-luisa-faq.pdf#page=1 in 421ms.
[generateEmbedding] SUCCESS for text (first 80 chars): "4. What if I can’t pay the deposit? Some clients have been allowed to pay the fu..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for d8f0982b48289709948600fbafebc768623da93ac468652ffc1f9d1bac9b7059_embedding. Result vector (first 3 elements): [ -0.007677428424358368, 0.006958067417144775, 0.018576066941022873 ]
[Embedding] Successfully generated embedding for doc hash d8f0982b48289709948600fbafebc768623da93ac468652ffc1f9d1bac9b7059 from source pdf-luisa-faq.pdf#page=1 in 833ms.
[generateEmbedding] SUCCESS for text (first 80 chars): "3. What is Luisa’s deposit policy? ● A 50% deposit is required to secure an appo..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for e374652180692cd0eee78fa83381a6081242eee40b14b407e0c75fa91c04440a_embedding. Result vector (first 3 elements): [ -0.04230146110057831, -0.008434225805103779, -0.000589589006267488 ]
[Embedding] Successfully generated embedding for doc hash e374652180692cd0eee78fa83381a6081242eee40b14b407e0c75fa91c04440a from source pdf-luisa-faq.pdf#page=1 in 1057ms.
[generateEmbedding] SUCCESS for text (first 80 chars): "1. Where does Luisa work from? Luisa does not operate from a public salon or stu..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for d8e1daeb9afffaf7e0e01f451b093fe2e9cd720a10b60ee6af3c860e8297d5b2_embedding. Result vector (first 3 elements): [ -0.0806378647685051, -0.03004949353635311, 0.0668778270483017 ]
[Embedding] Successfully generated embedding for doc hash d8e1daeb9afffaf7e0e01f451b093fe2e9cd720a10b60ee6af3c860e8297d5b2 from source pdf-luisa-faq.pdf#page=1 in 1404ms.
[ProcessContent] Step 2 completed. Embeddings generated (or attempted) for all documents. Stats: 4 attempts, 0 failures.
[ProcessContentPerPage] Saving JSON artifacts for 4 documents from page: pdf-luisa-faq.pdf#page=1
[ProcessContentPerPage] Finished saving JSON artifacts for page: pdf-luisa-faq.pdf#page=1
[ProcessContentPerPage] Finished processing and embedding for page: pdf-luisa-faq.pdf#page=1. Current total docs in state: 4
[PDF Crawler] Submitted 4 chunks from pdf-luisa-faq.pdf#page=1 for embedding and DB processing (DB SID: b2986d06-0659-4538-9ef7-54b2833f06af).
[PDF Crawler] Generating LLM chunks for page: pdf-luisa-faq.pdf#page=2 (LLM Chunk Gen SID: c0d316b7-18b2-4efc-945d-58b3c533398e)
[PageContentProcessor-PDFSingle] Starting LLM chunk generation for page: pdf-luisa-faq.pdf#page=2 (SID: c0d316b7-18b2-4efc-945d-58b3c533398e, Domain: luisa-faq.pdf)
[PageContentProcessor-PDFSingle] Pre-splitting content for: pdf-luisa-faq.pdf#page=2 (Original length: 2443 chars)
[PageContentProcessor-PDFSingle] URL pdf-luisa-faq.pdf#page=2 was pre-split into 1 chunk(s) for LLM processing.
[PageContentProcessor-PDFSingle] Processing 1 pre-chunks with concurrency 1 for: pdf-luisa-faq.pdf#page=2
[PageContentProcessor-PDFSingle] Segmenting and categorizing pre-chunk 1/1 for: pdf-luisa-faq.pdf#page=2 (Length: 2443 chars)
[LLMSegmenterCategorizer] Calling actualCategorizeWebsiteContent from content-analysis.ts for URL: pdf-luisa-faq.pdf#page=2
[Categorizer] Starting categorizeWebsiteContent for businessId=5b26e950-2bd4-42dc-9a50-19e90ad5528d, url=pdf-luisa-faq.pdf#page=2
[Categorizer] Raw response for businessId=5b26e950-2bd4-42dc-9a50-19e90ad5528d, url=pdf-luisa-faq.pdf#page=2: ```json
[
  {
    "category": 5,
    "content": "5. Is payment in cash required? Yes, Luisa generally prefers or requires payment in cash unless otherwise agreed. She reminds customers of this frequently before appointments.",
    "confidence": 0.9,
    "confidenceReason": "The content addresses a common question about payment methods, fitting well into the FAQ category."
  },
  {
    "category": 5,
    "content": "6. What happens if Luisa is running late? Luisa occasionally runs late and notifi...
[Categorizer] Raw response length: 2652 characters
[JSON Parser] Attempting to parse (first 500 chars): ```json
[
  {
    "category": 5,
    "content": "5. Is payment in cash required? Yes, Luisa generally prefers or requires payment in cash unless otherwise agreed. She reminds customers of this frequently before appointments.",
    "confidence": 0.9,
    "confidenceReason": "The content addresses a common question about payment methods, fitting well into the FAQ category."
  },
  {
    "category": 5,
    "content": "6. What happens if Luisa is running late? Luisa occasionally runs late and notifi...
[JSON Parser] Initial parse failed, attempting to extract JSON array
[JSON Parser] Extracted JSON (first 500 chars): [
  {
    "category": 5,
    "content": "5. Is payment in cash required? Yes, Luisa generally prefers or requires payment in cash unless otherwise agreed. She reminds customers of this frequently before appointments.",
    "confidence": 0.9,
    "confidenceReason": "The content addresses a common question about payment methods, fitting well into the FAQ category."
  },
  {
    "category": 5,
    "content": "6. What happens if Luisa is running late? Luisa occasionally runs late and notifies the c...
[Categorizer] Parsed 7 items from LLM response
[PageContentProcessor-PDFSingle] Pre-chunk 1/1 for URL pdf-luisa-faq.pdf#page=2 yielded 7 LLM-defined sub-chunks.
[PageContentProcessor-PDFSingle] Finished LLM chunk generation for page: pdf-luisa-faq.pdf#page=2. Generated 7 chunks.
[PDF Crawler] Generated 7 LLM chunks for pdf-luisa-faq.pdf#page=2.
[ProcessContentPerPage] Processing 7 chunks for page: pdf-luisa-faq.pdf#page=2
[ProcessContent] Step 1: Preparing initial DocumentData objects from LLM chunks...
[ProcessContent] Step 1 completed. 11 documents created and ready for embedding. 0 duplicates skipped.
[ProcessContent] Step 2: Generating embeddings for 11 documents...
[ProcessContent] Filtering out document d8e1daeb9afffaf7e0e01f451b093fe2e9cd720a10b60ee6af3c860e8297d5b2 - already has embedding
[ProcessContent] Filtering out document a7d3815be28272b80a3180b3c68ea2b53d9e817ab0a97f6fdb2d58884a62d3c5 - already has embedding
[ProcessContent] Filtering out document e374652180692cd0eee78fa83381a6081242eee40b14b407e0c75fa91c04440a - already has embedding
[ProcessContent] Filtering out document d8f0982b48289709948600fbafebc768623da93ac468652ffc1f9d1bac9b7059 - already has embedding
[ProcessContent] After filtering: 7 documents need embeddings (filtered out 4)
[ProcessContent] Processing 7 embedding tasks with concurrency 7
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=2, interactionId: 6ec6b5023b0873a459db642bf4cd7657424c581c2f2509041ec71e99553cd6d0_embedding, text (first 80 chars): "5. Is payment in cash required? Yes, Luisa generally prefers or requires payment..."
[generateEmbedding] Attempting for text (first 80 chars): "5. Is payment in cash required? Yes, Luisa generally prefers or requires payment..."
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=2, interactionId: 8eb2079f83e9225892fd87de7ecb696018ef676174196762d19e42df78487271_embedding, text (first 80 chars): "6. What happens if Luisa is running late? Luisa occasionally runs late and notif..."
[generateEmbedding] Attempting for text (first 80 chars): "6. What happens if Luisa is running late? Luisa occasionally runs late and notif..."
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=2, interactionId: 67f47f33269e7c6bbb0e35d41cde59fe6989a23192f70faeec5c7f247ce6dc91_embedding, text (first 80 chars): "7. Can I cancel or reschedule my appointment? Yes, you can cancel or reschedule,..."
[generateEmbedding] Attempting for text (first 80 chars): "7. Can I cancel or reschedule my appointment? Yes, you can cancel or reschedule,..."
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=2, interactionId: f015b774c44b7bad22453851e0e904def5ae0f78b18c9ada68094961db5a5eb2_embedding, text (first 80 chars): "8. Can someone else come to the appointment or wait? Luisa has not objected to c..."
[generateEmbedding] Attempting for text (first 80 chars): "8. Can someone else come to the appointment or wait? Luisa has not objected to c..."
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=2, interactionId: 268b2b0725a42d7cf9d7cc225da3d25ae644cd1e22226bbb620ae456efd89e28_embedding, text (first 80 chars): "9. How long do services take? ● Braiding: Approx. 1 hour ● Shellac Manicure: Not..."
[generateEmbedding] Attempting for text (first 80 chars): "9. How long do services take? ● Braiding: Approx. 1 hour ● Shellac Manicure: Not..."
[generateEmbedding] SUCCESS for text (first 80 chars): "6. What happens if Luisa is running late? Luisa occasionally runs late and notif..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for 8eb2079f83e9225892fd87de7ecb696018ef676174196762d19e42df78487271_embedding. Result vector (first 3 elements): [ -0.022666484117507935, 0.00834975577890873, 0.032971858978271484 ]
[Embedding] Successfully generated embedding for doc hash 8eb2079f83e9225892fd87de7ecb696018ef676174196762d19e42df78487271 from source pdf-luisa-faq.pdf#page=2 in 389ms.
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=2, interactionId: db5ee02668dac94a058008c21a63a285fc160d2d3b38d6b52bf6ab298fc6a26d_embedding, text (first 80 chars): "10. Can Luisa accommodate last-minute changes or delays? Yes, she tries to be fl..."
[generateEmbedding] Attempting for text (first 80 chars): "10. Can Luisa accommodate last-minute changes or delays? Yes, she tries to be fl..."
[generateEmbedding] SUCCESS for text (first 80 chars): "9. How long do services take? ● Braiding: Approx. 1 hour ● Shellac Manicure: Not..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for 268b2b0725a42d7cf9d7cc225da3d25ae644cd1e22226bbb620ae456efd89e28_embedding. Result vector (first 3 elements): [ -0.033706001937389374, 0.049797751009464264, 0.061181433498859406 ]
[Embedding] Successfully generated embedding for doc hash 268b2b0725a42d7cf9d7cc225da3d25ae644cd1e22226bbb620ae456efd89e28 from source pdf-luisa-faq.pdf#page=2 in 397ms.
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=2, interactionId: 62f609db570b6342be46d4a1f82723ac13a2785e4373ec5cdb315423f0cc2310_embedding, text (first 80 chars): "11. Does Luisa provide mobile services?..."
[generateEmbedding] Attempting for text (first 80 chars): "11. Does Luisa provide mobile services?..."
[generateEmbedding] SUCCESS for text (first 80 chars): "7. Can I cancel or reschedule my appointment? Yes, you can cancel or reschedule,..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for 67f47f33269e7c6bbb0e35d41cde59fe6989a23192f70faeec5c7f247ce6dc91_embedding. Result vector (first 3 elements): [ -0.03216256573796272, 0.058110591024160385, 0.0316060408949852 ]
[Embedding] Successfully generated embedding for doc hash 67f47f33269e7c6bbb0e35d41cde59fe6989a23192f70faeec5c7f247ce6dc91 from source pdf-luisa-faq.pdf#page=2 in 415ms.
[generateEmbedding] SUCCESS for text (first 80 chars): "8. Can someone else come to the appointment or wait? Luisa has not objected to c..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for f015b774c44b7bad22453851e0e904def5ae0f78b18c9ada68094961db5a5eb2_embedding. Result vector (first 3 elements): [ -0.018985392525792122, 0.007876483723521233, 0.034424666315317154 ]
[Embedding] Successfully generated embedding for doc hash f015b774c44b7bad22453851e0e904def5ae0f78b18c9ada68094961db5a5eb2 from source pdf-luisa-faq.pdf#page=2 in 420ms.
[generateEmbedding] SUCCESS for text (first 80 chars): "10. Can Luisa accommodate last-minute changes or delays? Yes, she tries to be fl..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for db5ee02668dac94a058008c21a63a285fc160d2d3b38d6b52bf6ab298fc6a26d_embedding. Result vector (first 3 elements): [ -0.022475993260741234, 0.0016144514083862305, 0.048024244606494904 ]
[Embedding] Successfully generated embedding for doc hash db5ee02668dac94a058008c21a63a285fc160d2d3b38d6b52bf6ab298fc6a26d from source pdf-luisa-faq.pdf#page=2 in 763ms.
[generateEmbedding] SUCCESS for text (first 80 chars): "11. Does Luisa provide mobile services?..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for 62f609db570b6342be46d4a1f82723ac13a2785e4373ec5cdb315423f0cc2310_embedding. Result vector (first 3 elements): [ -0.02984096296131611, -0.030331579968333244, 0.028022799640893936 ]
[Embedding] Successfully generated embedding for doc hash 62f609db570b6342be46d4a1f82723ac13a2785e4373ec5cdb315423f0cc2310 from source pdf-luisa-faq.pdf#page=2 in 832ms.
[generateEmbedding] SUCCESS for text (first 80 chars): "5. Is payment in cash required? Yes, Luisa generally prefers or requires payment..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for 6ec6b5023b0873a459db642bf4cd7657424c581c2f2509041ec71e99553cd6d0_embedding. Result vector (first 3 elements): [ -0.022018413990736008, -0.0001454006414860487, 0.019809838384389877 ]
[Embedding] Successfully generated embedding for doc hash 6ec6b5023b0873a459db642bf4cd7657424c581c2f2509041ec71e99553cd6d0 from source pdf-luisa-faq.pdf#page=2 in 1415ms.
[ProcessContent] Step 2 completed. Embeddings generated (or attempted) for all documents. Stats: 11 attempts, 0 failures.
[ProcessContentPerPage] Saving JSON artifacts for 7 documents from page: pdf-luisa-faq.pdf#page=2
[ProcessContentPerPage] Finished saving JSON artifacts for page: pdf-luisa-faq.pdf#page=2
[ProcessContentPerPage] Finished processing and embedding for page: pdf-luisa-faq.pdf#page=2. Current total docs in state: 11
[PDF Crawler] Submitted 7 chunks from pdf-luisa-faq.pdf#page=2 for embedding and DB processing (DB SID: b2986d06-0659-4538-9ef7-54b2833f06af).
[PDF Crawler] Generating LLM chunks for page: pdf-luisa-faq.pdf#page=3 (LLM Chunk Gen SID: c0d316b7-18b2-4efc-945d-58b3c533398e)
[PageContentProcessor-PDFSingle] Starting LLM chunk generation for page: pdf-luisa-faq.pdf#page=3 (SID: c0d316b7-18b2-4efc-945d-58b3c533398e, Domain: luisa-faq.pdf)
[PageContentProcessor-PDFSingle] Pre-splitting content for: pdf-luisa-faq.pdf#page=3 (Original length: 683 chars)
[PageContentProcessor-PDFSingle] URL pdf-luisa-faq.pdf#page=3 was pre-split into 1 chunk(s) for LLM processing.
[PageContentProcessor-PDFSingle] Processing 1 pre-chunks with concurrency 1 for: pdf-luisa-faq.pdf#page=3
[PageContentProcessor-PDFSingle] Segmenting and categorizing pre-chunk 1/1 for: pdf-luisa-faq.pdf#page=3 (Length: 683 chars)
[LLMSegmenterCategorizer] Calling actualCategorizeWebsiteContent from content-analysis.ts for URL: pdf-luisa-faq.pdf#page=3
[Categorizer] Starting categorizeWebsiteContent for businessId=5b26e950-2bd4-42dc-9a50-19e90ad5528d, url=pdf-luisa-faq.pdf#page=3
[Categorizer] Raw response for businessId=5b26e950-2bd4-42dc-9a50-19e90ad5528d, url=pdf-luisa-faq.pdf#page=3: ```json
[
  {
    "category": 5,
    "content": "No. When asked, she confirmed she only attends in North Melbourne. 12. What if I can’t reach Luisa? Clients sometimes call or message repeatedly when arriving. If there's a delay, it’s best to: ● Message again via WhatsApp ● Wait in the lobby or outside Apt 111 ● Be patient, as she may be attending another client or caring for her child",
    "confidence": 0.9,
    "confidenceReason": "The content addresses common questions and concerns clients mi...
[Categorizer] Raw response length: 546 characters
[JSON Parser] Attempting to parse (first 500 chars): ```json
[
  {
    "category": 5,
    "content": "No. When asked, she confirmed she only attends in North Melbourne. 12. What if I can’t reach Luisa? Clients sometimes call or message repeatedly when arriving. If there's a delay, it’s best to: ● Message again via WhatsApp ● Wait in the lobby or outside Apt 111 ● Be patient, as she may be attending another client or caring for her child",
    "confidence": 0.9,
    "confidenceReason": "The content addresses common questions and concerns clients mi...
[JSON Parser] Initial parse failed, attempting to extract JSON array
[JSON Parser] Extracted JSON (first 500 chars): [
  {
    "category": 5,
    "content": "No. When asked, she confirmed she only attends in North Melbourne. 12. What if I can’t reach Luisa? Clients sometimes call or message repeatedly when arriving. If there's a delay, it’s best to: ● Message again via WhatsApp ● Wait in the lobby or outside Apt 111 ● Be patient, as she may be attending another client or caring for her child",
    "confidence": 0.9,
    "confidenceReason": "The content addresses common questions and concerns clients might have...
[Categorizer] Parsed 1 items from LLM response
[PageContentProcessor-PDFSingle] Pre-chunk 1/1 for URL pdf-luisa-faq.pdf#page=3 yielded 1 LLM-defined sub-chunks.
[PageContentProcessor-PDFSingle] Finished LLM chunk generation for page: pdf-luisa-faq.pdf#page=3. Generated 1 chunks.
[PDF Crawler] Generated 1 LLM chunks for pdf-luisa-faq.pdf#page=3.
[ProcessContentPerPage] Processing 1 chunks for page: pdf-luisa-faq.pdf#page=3
[ProcessContent] Step 1: Preparing initial DocumentData objects from LLM chunks...
[ProcessContent] Step 1 completed. 12 documents created and ready for embedding. 0 duplicates skipped.
[ProcessContent] Step 2: Generating embeddings for 12 documents...
[ProcessContent] Filtering out document d8e1daeb9afffaf7e0e01f451b093fe2e9cd720a10b60ee6af3c860e8297d5b2 - already has embedding
[ProcessContent] Filtering out document a7d3815be28272b80a3180b3c68ea2b53d9e817ab0a97f6fdb2d58884a62d3c5 - already has embedding
[ProcessContent] Filtering out document e374652180692cd0eee78fa83381a6081242eee40b14b407e0c75fa91c04440a - already has embedding
[ProcessContent] Filtering out document d8f0982b48289709948600fbafebc768623da93ac468652ffc1f9d1bac9b7059 - already has embedding
[ProcessContent] Filtering out document 6ec6b5023b0873a459db642bf4cd7657424c581c2f2509041ec71e99553cd6d0 - already has embedding
[ProcessContent] Filtering out document 8eb2079f83e9225892fd87de7ecb696018ef676174196762d19e42df78487271 - already has embedding
[ProcessContent] Filtering out document 67f47f33269e7c6bbb0e35d41cde59fe6989a23192f70faeec5c7f247ce6dc91 - already has embedding
[ProcessContent] Filtering out document f015b774c44b7bad22453851e0e904def5ae0f78b18c9ada68094961db5a5eb2 - already has embedding
[ProcessContent] Filtering out document 268b2b0725a42d7cf9d7cc225da3d25ae644cd1e22226bbb620ae456efd89e28 - already has embedding
[ProcessContent] Filtering out document db5ee02668dac94a058008c21a63a285fc160d2d3b38d6b52bf6ab298fc6a26d - already has embedding
[ProcessContent] Filtering out document 62f609db570b6342be46d4a1f82723ac13a2785e4373ec5cdb315423f0cc2310 - already has embedding
[ProcessContent] After filtering: 1 documents need embeddings (filtered out 11)
[ProcessContent] Processing 1 embedding tasks with concurrency 1
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=3, interactionId: 4cca31342739067c15b469e87a0e12c929d90c8f1516b2d8aed3fad3ad5f0137_embedding, text (first 80 chars): "No. When asked, she confirmed she only attends in North Melbourne. 12. What if I..."
[generateEmbedding] Attempting for text (first 80 chars): "No. When asked, she confirmed she only attends in North Melbourne. 12. What if I..."
[generateEmbedding] SUCCESS for text (first 80 chars): "No. When asked, she confirmed she only attends in North Melbourne. 12. What if I..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for 4cca31342739067c15b469e87a0e12c929d90c8f1516b2d8aed3fad3ad5f0137_embedding. Result vector (first 3 elements): [ -0.05200827121734619, 0.002890700241550803, 0.040160395205020905 ]
[Embedding] Successfully generated embedding for doc hash 4cca31342739067c15b469e87a0e12c929d90c8f1516b2d8aed3fad3ad5f0137 from source pdf-luisa-faq.pdf#page=3 in 2921ms.
[ProcessContent] Step 2 completed. Embeddings generated (or attempted) for all documents. Stats: 12 attempts, 0 failures.
[ProcessContentPerPage] Saving JSON artifacts for 1 documents from page: pdf-luisa-faq.pdf#page=3
[ProcessContentPerPage] Finished saving JSON artifacts for page: pdf-luisa-faq.pdf#page=3
[ProcessContentPerPage] Finished processing and embedding for page: pdf-luisa-faq.pdf#page=3. Current total docs in state: 12
[PDF Crawler] Submitted 1 chunks from pdf-luisa-faq.pdf#page=3 for embedding and DB processing (DB SID: b2986d06-0659-4538-9ef7-54b2833f06af).
[ProcessContentFinalize] Finalizing content processing...
[ProcessContent] Collecting documents with their embeddings for final save...
[ProcessContent] Collected 12 documents (with embeddeddings) for saving.
[ProcessContent] Successful pages (with at least one saved chunk): 3
[ProcessContent] Step 3: Logging primary summary artifacts (manifests)...
[ProcessContent] Step 3 completed. Primary summary artifacts (manifests) logged.
[ProcessContentFinalize] Attempting to save session b2986d06-0659-4538-9ef7-54b2833f06af with 12 documents (embeddings included) to database...
[Environment] Using development environment for service-role client
[CrawlSession.addSessionWithDocumentsAndEmbeddings] Using production service role client (PDF crawler production mode)
[ProcessContentFinalize] Successfully saved session b2986d06-0659-4538-9ef7-54b2833f06af with 12 documents.
[ProcessContent] Step 3: Logging primary summary artifacts (manifests)...
[ProcessContent] Step 3 completed. Primary summary artifacts (manifests) logged.
[ProcessContentFinalize] Re-saved manifests with updated document DB IDs.
[ProcessContentFinalize] Content processing for session b2986d06-0659-4538-9ef7-54b2833f06af finalized successfully.
[PDF Crawler] Content processing finalized. Final status/session ID: b2986d06-0659-4538-9ef7-54b2833f06af
[LOGGER] Could not parse URL pdf-luisa-faq.pdf#page=1 to extract domain.
[LOGGER] Could not parse URL pdf-luisa-faq.pdf#page=2 to extract domain.
[LOGGER] Could not parse URL pdf-luisa-faq.pdf#page=3 to extract domain.
[LOGGER] Summary saved to /Users/juanbernal/code/mesieou/2025/simple_booking/crawl-output/summary.json
 POST /api/content-crawler/pdf 200 in 32410ms
[SEED] PDF content crawler API response: {
  message: 'PDF processed successfully',
  result: {
    mergedText: '1. Where does Luisa work from? Luisa does not operate from a public salon or studio. She provides services from her apartment located at: Apt 11/9 Dryburgh St, Apt 111, West Melbourne VIC 3003\n' +
      '\n' +
      "2. Does Luisa accept walk-ins or same-day bookings? Luisa may accept same-day bookings if she has availability, but it's always best to confirm through WhatsApp. She frequently shares availability for same-day or next-day appointments when asked.\n" +
      '\n' +
      '3. What is Luisa’s deposit policy? ● A 50% deposit is required to secure an appointment. Deposit can be paid via bank transfer to: makefile CopyEdit Name: Lisa Bernal Number: +61 451 375 263 ● ● The deposit is refundable only if: ○ The cancellation is made at least 24 hours in advance, or ○ The appointment is rescheduled more than 24 hours ahead.\n' +
      '\n' +
      '4. What if I can’t pay the deposit? Some clients have been allowed to pay the full amount in cash on the day of the appointment if they don’t have a local bank account (e.g., only Bancolombia available). Luisa seems flexible on this on a case-by-case basis.\n' +
      '\n' +
      '5. Is payment in cash required? Yes, Luisa generally prefers or requires payment in cash unless otherwise agreed. She reminds customers of this frequently before appointments.\n' +
      '\n' +
      '6. What happens if Luisa is running late? Luisa occasionally runs late and notifies the client. Clients are usually asked to wait in the apartment lobby. She is apologetic and communicative about delays.\n' +
      '\n' +
      '7. Can I cancel or reschedule my appointment? Yes, you can cancel or reschedule, but it must be at least 24 hours in advance to retain your deposit. Last-minute cancellations or no-shows may forfeit the deposit.\n' +
      '\n' +
      '8. Can someone else come to the appointment or wait? Luisa has not objected to clients bringing someone or waiting nearby, but this should be confirmed in advance as her studio is in her private residence.\n' +
      '\n' +
      '9. How long do services take? ● Braiding: Approx. 1 hour ● Shellac Manicure: Not explicitly stated, but appointments are often scheduled in 1 – 1.5 hour windows\n' +
      '\n' +
      '10. Can Luisa accommodate last-minute changes or delays? Yes, she tries to be flexible. Clients running late or changing plans often communicate with her and she adjusts where possible, depending on her schedule.\n' +
      '\n' +
      '11. Does Luisa provide mobile services?\n' +
      '\n' +
      "No. When asked, she confirmed she only attends in North Melbourne. 12. What if I can’t reach Luisa? Clients sometimes call or message repeatedly when arriving. If there's a delay, it’s best to: ● Message again via WhatsApp ● Wait in the lobby or outside Apt 111 ● Be patient, as she may be attending another client or caring for her child",
    pageCount: 3,
    uniqueParagraphs: 12,
    businessId: '5b26e950-2bd4-42dc-9a50-19e90ad5528d',
    source: 'luisa-faq.pdf',
    embeddingsStatus: 'Processed with DB Session ID: b2986d06-0659-4538-9ef7-54b2833f06af'
  },
  pdfName: 'luisa-faq.pdf'
}
[SEED] Warning: Could not query embeddings by businessId: column embeddings.businessId does not exist
[SEED] Warning: Could not verify embeddings creation: undefined
 POST /api/seed/luisa 200 in 39917ms
 ✓ Compiled in 316ms (1137 modules)
 ✓ Compiled /api/seed/luisa in 210ms (397 modules)
💄 Starting Luisa business seed for DEVELOPMENT...
🧹 Cleaning up old Luisa business data in DEV environment...
[CLEANUP] Starting cleanup of Luisa's test business data...
[CLEANUP] Searching for existing Luisa business data...
[CLEANUP] ✅ No Luisa business data found to clean up.
✅ Old business data cleaned up successfully
📱 Using phone: +61452490450
📱 Using WhatsApp: +15551890570
📞 Using Phone Number ID: 684078768113901
[SEED] Starting database seeding for Luisa's Business (Beauty Asiul)...
[SEED] Environment: {
  supabaseUrl: 'Using provided client',
  hasServiceRoleKey: true,
  usingProvidedClient: true,
  productionUrl: 'https://itjtaeggupasvrepfkcw.supabase.co',
  hasProductionServiceRoleKey: true,
  hasCustomConfig: true
}
[SEED] Using business configuration: {
  name: 'Beauty Asiul (DEV)',
  email: 'luisa.dev@beautyasiul.com',
  phone: '+61452490450',
  whatsappNumber: '+15551890570',
  whatsappPhoneNumberId: '684078768113901'
}
[SEED] Checking for existing Luisa business data to clean up...
[SEED] No existing Luisa business data found to clean up.
[SEED] Creating new business...
[SEED] Business 'Beauty Asiul (DEV)' created with ID: 2f905c2c-0167-4bcb-b513-f19b8fbe8f9e
[SEED] Creating owner provider...
[SEED] About to create user with data: {
  email: 'luisa.dev@beautyasiul.com',
  whatsappNumber: '+15551890570',
  businessId: '2f905c2c-0167-4bcb-b513-f19b8fbe8f9e'
}
[User.add] Found existing auth user with email: luisa.dev@beautyasiul.com
[User.add] About to upsert user profile: {
  id: 'e85c0a88-2afd-4d29-8dff-d9361a881585',
  firstName: 'Luisa',
  lastName: 'Bernal',
  role: 'admin/provider',
  businessId: '2f905c2c-0167-4bcb-b513-f19b8fbe8f9e',
  email: 'luisa.dev@beautyasiul.com',
  phoneNormalized: '61452490450',
  whatsAppNumberNormalized: '15551890570'
}
[User.add] Using adminSupa client (bypasses RLS for user creation)
[SEED] User 'Luisa Bernal' created with ID: e85c0a88-2afd-4d29-8dff-d9361a881585
[SEED] Creating services...
[SEED] Service 'Basic Manicure' created with ID: c032ff95-03b5-42e2-bf73-8689ddef9721
[SEED] Service 'Express Manicure' created with ID: 07943e17-883e-4a12-8f3b-38c561179ad0
[SEED] Service 'Gel Manicure' created with ID: 0be289a5-9aae-48ca-94e2-48dd899a447d
[SEED] Service 'Press on Manicure' created with ID: c7ac6edb-734d-4629-aa0a-250bb796187a
[SEED] Service 'Nail Art' created with ID: 863d5780-1468-4594-8f3e-b5d6345a0a1d
[SEED] Service 'Basic Pedicure' created with ID: 08d37ed8-a712-42ea-b930-f104c6d60994
[SEED] Service 'Gel Pedicure' created with ID: 54ddbcde-99d8-403b-8e82-78fd0b260fc9
[SEED] Service 'Ladies Haircut' created with ID: be07c2d6-9dc1-49c7-8873-a0deb5afc3ad
[SEED] Service 'Hair Styling' created with ID: 4050fa8b-850f-44c9-9319-7d5e966b7290
[SEED] Service 'Braids' created with ID: 52199d08-90ea-423f-ae80-78c4222d8d1a
[SEED] Service 'Blow Dry' created with ID: 3592b148-ff47-46b1-94fa-e82a0c97b0de
[SEED] Service 'Waves' created with ID: 8b4c99df-28ae-4b43-bf95-77ab088d3782
[SEED] Service 'Treatments' created with ID: 7a2105b6-fc99-4a7d-9fc8-a0aab76c9db9
[SEED] Creating calendar settings...
[SEED] Calendar settings created with ID: b8fe0411-eb05-4308-83d6-56f679c1214a
[SEED] Skipping manual document creation - will use PDF processing
[SEED] Creating initial availability slots...
[SEED] Creating initial availability using rollAggregatedAvailability...
[rollAggregatedAvailability] Rolling availability for business 2f905c2c-0167-4bcb-b513-f19b8fbe8f9e
[rollAggregatedAvailability] Business timezone: Australia/Sydney, today: 2025-07-23
[Environment] Using development environment for server client
[rollAggregatedAvailability] Added availability for 2025-07-23
[rollAggregatedAvailability] Added availability for 2025-07-24
[rollAggregatedAvailability] Added availability for 2025-07-25
[rollAggregatedAvailability] Added availability for 2025-07-26
[rollAggregatedAvailability] No providers work on 2025-07-27
[rollAggregatedAvailability] Added availability for 2025-07-28
[rollAggregatedAvailability] Added availability for 2025-07-29
[rollAggregatedAvailability] Added availability for 2025-07-30
[rollAggregatedAvailability] Added availability for 2025-07-31
[rollAggregatedAvailability] Added availability for 2025-08-01
[rollAggregatedAvailability] Added availability for 2025-08-02
[rollAggregatedAvailability] No providers work on 2025-08-03
[rollAggregatedAvailability] Added availability for 2025-08-04
[rollAggregatedAvailability] Added availability for 2025-08-05
[rollAggregatedAvailability] Added availability for 2025-08-06
[rollAggregatedAvailability] Added availability for 2025-08-07
[rollAggregatedAvailability] Added availability for 2025-08-08
[rollAggregatedAvailability] Added availability for 2025-08-09
[rollAggregatedAvailability] No providers work on 2025-08-10
[rollAggregatedAvailability] Added availability for 2025-08-11
[rollAggregatedAvailability] Added availability for 2025-08-12
[rollAggregatedAvailability] Added availability for 2025-08-13
[rollAggregatedAvailability] Added availability for 2025-08-14
[rollAggregatedAvailability] Added availability for 2025-08-15
[rollAggregatedAvailability] Added availability for 2025-08-16
[rollAggregatedAvailability] No providers work on 2025-08-17
[rollAggregatedAvailability] Added availability for 2025-08-18
[rollAggregatedAvailability] Added availability for 2025-08-19
[rollAggregatedAvailability] Added availability for 2025-08-20
[rollAggregatedAvailability] Added availability for 2025-08-21
[rollAggregatedAvailability] Added availability for 2025-08-22
[rollAggregatedAvailability] Completed for business 2f905c2c-0167-4bcb-b513-f19b8fbe8f9e
[SEED] ✅ Created initial availability using aggregated rollover system
[SEED] Database seeding completed successfully!
[SEED] Triggering PDF content crawler for document embeddings...
[SEED] Loading luisa-faq.pdf for processing...
[SEED] Loaded PDF file: 78733 bytes
[SEED] Calling PDF content crawler API: http://localhost:3000/api/content-crawler/pdf
 ✓ Compiled /api/content-crawler/pdf in 47ms (556 modules)
[Crawl Setup] Deleting existing output directory: /Users/juanbernal/code/mesieou/2025/simple_booking/crawl-output
[Crawl Setup] Successfully deleted /Users/juanbernal/code/mesieou/2025/simple_booking/crawl-output
[LOGGER] Initialized. Output path: /Users/juanbernal/code/mesieou/2025/simple_booking/crawl-output
[Crawl Setup] Logger initialized. Output path: /Users/juanbernal/code/mesieou/2025/simple_booking/crawl-output
Warning: Setting up fake worker.
[LOGGER] URL processed: pdf-luisa-faq.pdf
[ProcessContent] Global embedding state cleared
[ProcessContent] In-memory Session initialized: bd52cd75-1a4c-4450-b27c-f57acffe4bec, Business ID: 2f905c2c-0167-4bcb-b513-f19b8fbe8f9e
[ProcessContent] Content processing initialized. Session ID: bd52cd75-1a4c-4450-b27c-f57acffe4bec
[PDF Crawler] DB Session initialized: bd52cd75-1a4c-4450-b27c-f57acffe4bec. ProcessingState created.
[PDF Crawler] Generating LLM chunks for page: pdf-luisa-faq.pdf#page=1 (LLM Chunk Gen SID: 2d4fbfa2-e9c4-4ed3-a709-6af962063265)
[PageContentProcessor-PDFSingle] Starting LLM chunk generation for page: pdf-luisa-faq.pdf#page=1 (SID: 2d4fbfa2-e9c4-4ed3-a709-6af962063265, Domain: luisa-faq.pdf)
[PageContentProcessor-PDFSingle] Pre-splitting content for: pdf-luisa-faq.pdf#page=1 (Original length: 2121 chars)
[PageContentProcessor-PDFSingle] URL pdf-luisa-faq.pdf#page=1 was pre-split into 1 chunk(s) for LLM processing.
[PageContentProcessor-PDFSingle] Processing 1 pre-chunks with concurrency 1 for: pdf-luisa-faq.pdf#page=1
[PageContentProcessor-PDFSingle] Segmenting and categorizing pre-chunk 1/1 for: pdf-luisa-faq.pdf#page=1 (Length: 2121 chars)
[LLMSegmenterCategorizer] Calling actualCategorizeWebsiteContent from content-analysis.ts for URL: pdf-luisa-faq.pdf#page=1
[Categorizer] Starting categorizeWebsiteContent for businessId=2f905c2c-0167-4bcb-b513-f19b8fbe8f9e, url=pdf-luisa-faq.pdf#page=1
[Categorizer] Raw response for businessId=2f905c2c-0167-4bcb-b513-f19b8fbe8f9e, url=pdf-luisa-faq.pdf#page=1: ```json
[
  {
    "category": 5,
    "content": "1. Where does Luisa work from? Luisa does not operate from a public salon or studio. She provides services from her apartment located at: Apt 11/9 Dryburgh St, Apt 111, West Melbourne VIC 3003",
    "confidence": 0.9,
    "confidenceReason": "The content addresses a common question about the location of Luisa's services, fitting the FAQ category."
  },
  {
    "category": 5,
    "content": "2. Does Luisa accept walk-ins or same-day bookings? Luisa...
[Categorizer] Raw response length: 1860 characters
[JSON Parser] Attempting to parse (first 500 chars): ```json
[
  {
    "category": 5,
    "content": "1. Where does Luisa work from? Luisa does not operate from a public salon or studio. She provides services from her apartment located at: Apt 11/9 Dryburgh St, Apt 111, West Melbourne VIC 3003",
    "confidence": 0.9,
    "confidenceReason": "The content addresses a common question about the location of Luisa's services, fitting the FAQ category."
  },
  {
    "category": 5,
    "content": "2. Does Luisa accept walk-ins or same-day bookings? Luisa...
[JSON Parser] Initial parse failed, attempting to extract JSON array
[JSON Parser] Extracted JSON (first 500 chars): [
  {
    "category": 5,
    "content": "1. Where does Luisa work from? Luisa does not operate from a public salon or studio. She provides services from her apartment located at: Apt 11/9 Dryburgh St, Apt 111, West Melbourne VIC 3003",
    "confidence": 0.9,
    "confidenceReason": "The content addresses a common question about the location of Luisa's services, fitting the FAQ category."
  },
  {
    "category": 5,
    "content": "2. Does Luisa accept walk-ins or same-day bookings? Luisa may acc...
[Categorizer] Parsed 4 items from LLM response
[PageContentProcessor-PDFSingle] Pre-chunk 1/1 for URL pdf-luisa-faq.pdf#page=1 yielded 4 LLM-defined sub-chunks.
[PageContentProcessor-PDFSingle] Finished LLM chunk generation for page: pdf-luisa-faq.pdf#page=1. Generated 4 chunks.
[PDF Crawler] Generated 4 LLM chunks for pdf-luisa-faq.pdf#page=1.
[ProcessContentPerPage] Processing 4 chunks for page: pdf-luisa-faq.pdf#page=1
[ProcessContent] Step 1: Preparing initial DocumentData objects from LLM chunks...
[ProcessContent] Step 1 completed. 4 documents created and ready for embedding. 0 duplicates skipped.
[ProcessContent] Step 2: Generating embeddings for 4 documents...
[ProcessContent] After filtering: 4 documents need embeddings (filtered out 0)
[ProcessContent] Processing 4 embedding tasks with concurrency 4
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=1, interactionId: d8e1daeb9afffaf7e0e01f451b093fe2e9cd720a10b60ee6af3c860e8297d5b2_embedding, text (first 80 chars): "1. Where does Luisa work from? Luisa does not operate from a public salon or stu..."
[generateEmbedding] Attempting for text (first 80 chars): "1. Where does Luisa work from? Luisa does not operate from a public salon or stu..."
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=1, interactionId: a7d3815be28272b80a3180b3c68ea2b53d9e817ab0a97f6fdb2d58884a62d3c5_embedding, text (first 80 chars): "2. Does Luisa accept walk-ins or same-day bookings? Luisa may accept same-day bo..."
[generateEmbedding] Attempting for text (first 80 chars): "2. Does Luisa accept walk-ins or same-day bookings? Luisa may accept same-day bo..."
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=1, interactionId: e374652180692cd0eee78fa83381a6081242eee40b14b407e0c75fa91c04440a_embedding, text (first 80 chars): "3. What is Luisa’s deposit policy? ● A 50% deposit is required to secure an appo..."
[generateEmbedding] Attempting for text (first 80 chars): "3. What is Luisa’s deposit policy? ● A 50% deposit is required to secure an appo..."
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=1, interactionId: d8f0982b48289709948600fbafebc768623da93ac468652ffc1f9d1bac9b7059_embedding, text (first 80 chars): "4. What if I can’t pay the deposit? Some clients have been allowed to pay the fu..."
[generateEmbedding] Attempting for text (first 80 chars): "4. What if I can’t pay the deposit? Some clients have been allowed to pay the fu..."
[generateEmbedding] SUCCESS for text (first 80 chars): "4. What if I can’t pay the deposit? Some clients have been allowed to pay the fu..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for d8f0982b48289709948600fbafebc768623da93ac468652ffc1f9d1bac9b7059_embedding. Result vector (first 3 elements): [ -0.007677428424358368, 0.006958067417144775, 0.018576066941022873 ]
[Embedding] Successfully generated embedding for doc hash d8f0982b48289709948600fbafebc768623da93ac468652ffc1f9d1bac9b7059 from source pdf-luisa-faq.pdf#page=1 in 538ms.
[generateEmbedding] SUCCESS for text (first 80 chars): "3. What is Luisa’s deposit policy? ● A 50% deposit is required to secure an appo..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for e374652180692cd0eee78fa83381a6081242eee40b14b407e0c75fa91c04440a_embedding. Result vector (first 3 elements): [ -0.04230146110057831, -0.008434225805103779, -0.000589589006267488 ]
[Embedding] Successfully generated embedding for doc hash e374652180692cd0eee78fa83381a6081242eee40b14b407e0c75fa91c04440a from source pdf-luisa-faq.pdf#page=1 in 538ms.
[generateEmbedding] SUCCESS for text (first 80 chars): "1. Where does Luisa work from? Luisa does not operate from a public salon or stu..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for d8e1daeb9afffaf7e0e01f451b093fe2e9cd720a10b60ee6af3c860e8297d5b2_embedding. Result vector (first 3 elements): [ -0.08066321164369583, -0.030090665444731712, 0.06685690581798553 ]
[Embedding] Successfully generated embedding for doc hash d8e1daeb9afffaf7e0e01f451b093fe2e9cd720a10b60ee6af3c860e8297d5b2 from source pdf-luisa-faq.pdf#page=1 in 724ms.
[generateEmbedding] SUCCESS for text (first 80 chars): "2. Does Luisa accept walk-ins or same-day bookings? Luisa may accept same-day bo..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for a7d3815be28272b80a3180b3c68ea2b53d9e817ab0a97f6fdb2d58884a62d3c5_embedding. Result vector (first 3 elements): [ -0.05520404502749443, -0.02170209027826786, 0.0344795286655426 ]
[Embedding] Successfully generated embedding for doc hash a7d3815be28272b80a3180b3c68ea2b53d9e817ab0a97f6fdb2d58884a62d3c5 from source pdf-luisa-faq.pdf#page=1 in 916ms.
[ProcessContent] Step 2 completed. Embeddings generated (or attempted) for all documents. Stats: 4 attempts, 0 failures.
[ProcessContentPerPage] Saving JSON artifacts for 4 documents from page: pdf-luisa-faq.pdf#page=1
[ProcessContentPerPage] Finished saving JSON artifacts for page: pdf-luisa-faq.pdf#page=1
[ProcessContentPerPage] Finished processing and embedding for page: pdf-luisa-faq.pdf#page=1. Current total docs in state: 4
[PDF Crawler] Submitted 4 chunks from pdf-luisa-faq.pdf#page=1 for embedding and DB processing (DB SID: bd52cd75-1a4c-4450-b27c-f57acffe4bec).
[PDF Crawler] Generating LLM chunks for page: pdf-luisa-faq.pdf#page=2 (LLM Chunk Gen SID: 2d4fbfa2-e9c4-4ed3-a709-6af962063265)
[PageContentProcessor-PDFSingle] Starting LLM chunk generation for page: pdf-luisa-faq.pdf#page=2 (SID: 2d4fbfa2-e9c4-4ed3-a709-6af962063265, Domain: luisa-faq.pdf)
[PageContentProcessor-PDFSingle] Pre-splitting content for: pdf-luisa-faq.pdf#page=2 (Original length: 2443 chars)
[PageContentProcessor-PDFSingle] URL pdf-luisa-faq.pdf#page=2 was pre-split into 1 chunk(s) for LLM processing.
[PageContentProcessor-PDFSingle] Processing 1 pre-chunks with concurrency 1 for: pdf-luisa-faq.pdf#page=2
[PageContentProcessor-PDFSingle] Segmenting and categorizing pre-chunk 1/1 for: pdf-luisa-faq.pdf#page=2 (Length: 2443 chars)
[LLMSegmenterCategorizer] Calling actualCategorizeWebsiteContent from content-analysis.ts for URL: pdf-luisa-faq.pdf#page=2
[Categorizer] Starting categorizeWebsiteContent for businessId=2f905c2c-0167-4bcb-b513-f19b8fbe8f9e, url=pdf-luisa-faq.pdf#page=2
[Categorizer] Raw response for businessId=2f905c2c-0167-4bcb-b513-f19b8fbe8f9e, url=pdf-luisa-faq.pdf#page=2: ```json
[
  {
    "category": 5,
    "content": "5. Is payment in cash required? Yes, Luisa generally prefers or requires payment in cash unless otherwise agreed. She reminds customers of this frequently before appointments.",
    "confidence": 0.9,
    "confidenceReason": "The content addresses a common question related to payment methods, fitting the FAQ category."
  },
  {
    "category": 5,
    "content": "6. What happens if Luisa is running late? Luisa occasionally runs late and notifies th...
[Categorizer] Raw response length: 2591 characters
[JSON Parser] Attempting to parse (first 500 chars): ```json
[
  {
    "category": 5,
    "content": "5. Is payment in cash required? Yes, Luisa generally prefers or requires payment in cash unless otherwise agreed. She reminds customers of this frequently before appointments.",
    "confidence": 0.9,
    "confidenceReason": "The content addresses a common question related to payment methods, fitting the FAQ category."
  },
  {
    "category": 5,
    "content": "6. What happens if Luisa is running late? Luisa occasionally runs late and notifies th...
[JSON Parser] Initial parse failed, attempting to extract JSON array
[JSON Parser] Extracted JSON (first 500 chars): [
  {
    "category": 5,
    "content": "5. Is payment in cash required? Yes, Luisa generally prefers or requires payment in cash unless otherwise agreed. She reminds customers of this frequently before appointments.",
    "confidence": 0.9,
    "confidenceReason": "The content addresses a common question related to payment methods, fitting the FAQ category."
  },
  {
    "category": 5,
    "content": "6. What happens if Luisa is running late? Luisa occasionally runs late and notifies the client...
[Categorizer] Parsed 7 items from LLM response
[PageContentProcessor-PDFSingle] Pre-chunk 1/1 for URL pdf-luisa-faq.pdf#page=2 yielded 7 LLM-defined sub-chunks.
[PageContentProcessor-PDFSingle] Finished LLM chunk generation for page: pdf-luisa-faq.pdf#page=2. Generated 7 chunks.
[PDF Crawler] Generated 7 LLM chunks for pdf-luisa-faq.pdf#page=2.
[ProcessContentPerPage] Processing 7 chunks for page: pdf-luisa-faq.pdf#page=2
[ProcessContent] Step 1: Preparing initial DocumentData objects from LLM chunks...
[ProcessContent] Step 1 completed. 11 documents created and ready for embedding. 0 duplicates skipped.
[ProcessContent] Step 2: Generating embeddings for 11 documents...
[ProcessContent] Filtering out document d8e1daeb9afffaf7e0e01f451b093fe2e9cd720a10b60ee6af3c860e8297d5b2 - already has embedding
[ProcessContent] Filtering out document a7d3815be28272b80a3180b3c68ea2b53d9e817ab0a97f6fdb2d58884a62d3c5 - already has embedding
[ProcessContent] Filtering out document e374652180692cd0eee78fa83381a6081242eee40b14b407e0c75fa91c04440a - already has embedding
[ProcessContent] Filtering out document d8f0982b48289709948600fbafebc768623da93ac468652ffc1f9d1bac9b7059 - already has embedding
[ProcessContent] After filtering: 7 documents need embeddings (filtered out 4)
[ProcessContent] Processing 7 embedding tasks with concurrency 7
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=2, interactionId: 6ec6b5023b0873a459db642bf4cd7657424c581c2f2509041ec71e99553cd6d0_embedding, text (first 80 chars): "5. Is payment in cash required? Yes, Luisa generally prefers or requires payment..."
[generateEmbedding] Attempting for text (first 80 chars): "5. Is payment in cash required? Yes, Luisa generally prefers or requires payment..."
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=2, interactionId: 8eb2079f83e9225892fd87de7ecb696018ef676174196762d19e42df78487271_embedding, text (first 80 chars): "6. What happens if Luisa is running late? Luisa occasionally runs late and notif..."
[generateEmbedding] Attempting for text (first 80 chars): "6. What happens if Luisa is running late? Luisa occasionally runs late and notif..."
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=2, interactionId: 67f47f33269e7c6bbb0e35d41cde59fe6989a23192f70faeec5c7f247ce6dc91_embedding, text (first 80 chars): "7. Can I cancel or reschedule my appointment? Yes, you can cancel or reschedule,..."
[generateEmbedding] Attempting for text (first 80 chars): "7. Can I cancel or reschedule my appointment? Yes, you can cancel or reschedule,..."
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=2, interactionId: f015b774c44b7bad22453851e0e904def5ae0f78b18c9ada68094961db5a5eb2_embedding, text (first 80 chars): "8. Can someone else come to the appointment or wait? Luisa has not objected to c..."
[generateEmbedding] Attempting for text (first 80 chars): "8. Can someone else come to the appointment or wait? Luisa has not objected to c..."
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=2, interactionId: 268b2b0725a42d7cf9d7cc225da3d25ae644cd1e22226bbb620ae456efd89e28_embedding, text (first 80 chars): "9. How long do services take? ● Braiding: Approx. 1 hour ● Shellac Manicure: Not..."
[generateEmbedding] Attempting for text (first 80 chars): "9. How long do services take? ● Braiding: Approx. 1 hour ● Shellac Manicure: Not..."
[generateEmbedding] SUCCESS for text (first 80 chars): "5. Is payment in cash required? Yes, Luisa generally prefers or requires payment..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for 6ec6b5023b0873a459db642bf4cd7657424c581c2f2509041ec71e99553cd6d0_embedding. Result vector (first 3 elements): [ -0.022018413990736008, -0.0001454006414860487, 0.019809838384389877 ]
[Embedding] Successfully generated embedding for doc hash 6ec6b5023b0873a459db642bf4cd7657424c581c2f2509041ec71e99553cd6d0 from source pdf-luisa-faq.pdf#page=2 in 342ms.
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=2, interactionId: db5ee02668dac94a058008c21a63a285fc160d2d3b38d6b52bf6ab298fc6a26d_embedding, text (first 80 chars): "10. Can Luisa accommodate last-minute changes or delays? Yes, she tries to be fl..."
[generateEmbedding] Attempting for text (first 80 chars): "10. Can Luisa accommodate last-minute changes or delays? Yes, she tries to be fl..."
[generateEmbedding] SUCCESS for text (first 80 chars): "8. Can someone else come to the appointment or wait? Luisa has not objected to c..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for f015b774c44b7bad22453851e0e904def5ae0f78b18c9ada68094961db5a5eb2_embedding. Result vector (first 3 elements): [ -0.01895017735660076, 0.007885674946010113, 0.03438045084476471 ]
[Embedding] Successfully generated embedding for doc hash f015b774c44b7bad22453851e0e904def5ae0f78b18c9ada68094961db5a5eb2 from source pdf-luisa-faq.pdf#page=2 in 402ms.
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=2, interactionId: 62f609db570b6342be46d4a1f82723ac13a2785e4373ec5cdb315423f0cc2310_embedding, text (first 80 chars): "11. Does Luisa provide mobile services?..."
[generateEmbedding] Attempting for text (first 80 chars): "11. Does Luisa provide mobile services?..."
[generateEmbedding] SUCCESS for text (first 80 chars): "9. How long do services take? ● Braiding: Approx. 1 hour ● Shellac Manicure: Not..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for 268b2b0725a42d7cf9d7cc225da3d25ae644cd1e22226bbb620ae456efd89e28_embedding. Result vector (first 3 elements): [ -0.033685170114040375, 0.04984842985868454, 0.06113928556442261 ]
[Embedding] Successfully generated embedding for doc hash 268b2b0725a42d7cf9d7cc225da3d25ae644cd1e22226bbb620ae456efd89e28 from source pdf-luisa-faq.pdf#page=2 in 440ms.
[generateEmbedding] SUCCESS for text (first 80 chars): "7. Can I cancel or reschedule my appointment? Yes, you can cancel or reschedule,..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for 67f47f33269e7c6bbb0e35d41cde59fe6989a23192f70faeec5c7f247ce6dc91_embedding. Result vector (first 3 elements): [ -0.03216256573796272, 0.058110591024160385, 0.0316060408949852 ]
[Embedding] Successfully generated embedding for doc hash 67f47f33269e7c6bbb0e35d41cde59fe6989a23192f70faeec5c7f247ce6dc91 from source pdf-luisa-faq.pdf#page=2 in 461ms.
[generateEmbedding] SUCCESS for text (first 80 chars): "10. Can Luisa accommodate last-minute changes or delays? Yes, she tries to be fl..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for db5ee02668dac94a058008c21a63a285fc160d2d3b38d6b52bf6ab298fc6a26d_embedding. Result vector (first 3 elements): [ -0.022475993260741234, 0.0016144514083862305, 0.048024244606494904 ]
[Embedding] Successfully generated embedding for doc hash db5ee02668dac94a058008c21a63a285fc160d2d3b38d6b52bf6ab298fc6a26d from source pdf-luisa-faq.pdf#page=2 in 689ms.
[generateEmbedding] SUCCESS for text (first 80 chars): "11. Does Luisa provide mobile services?..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for 62f609db570b6342be46d4a1f82723ac13a2785e4373ec5cdb315423f0cc2310_embedding. Result vector (first 3 elements): [ -0.02984096296131611, -0.030331579968333244, 0.028022799640893936 ]
[Embedding] Successfully generated embedding for doc hash 62f609db570b6342be46d4a1f82723ac13a2785e4373ec5cdb315423f0cc2310 from source pdf-luisa-faq.pdf#page=2 in 694ms.
[generateEmbedding] SUCCESS for text (first 80 chars): "6. What happens if Luisa is running late? Luisa occasionally runs late and notif..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for 8eb2079f83e9225892fd87de7ecb696018ef676174196762d19e42df78487271_embedding. Result vector (first 3 elements): [ -0.022666430100798607, 0.008343061432242393, 0.03297178074717522 ]
[Embedding] Successfully generated embedding for doc hash 8eb2079f83e9225892fd87de7ecb696018ef676174196762d19e42df78487271 from source pdf-luisa-faq.pdf#page=2 in 934ms.
[ProcessContent] Step 2 completed. Embeddings generated (or attempted) for all documents. Stats: 11 attempts, 0 failures.
[ProcessContentPerPage] Saving JSON artifacts for 7 documents from page: pdf-luisa-faq.pdf#page=2
[ProcessContentPerPage] Finished saving JSON artifacts for page: pdf-luisa-faq.pdf#page=2
[ProcessContentPerPage] Finished processing and embedding for page: pdf-luisa-faq.pdf#page=2. Current total docs in state: 11
[PDF Crawler] Submitted 7 chunks from pdf-luisa-faq.pdf#page=2 for embedding and DB processing (DB SID: bd52cd75-1a4c-4450-b27c-f57acffe4bec).
[PDF Crawler] Generating LLM chunks for page: pdf-luisa-faq.pdf#page=3 (LLM Chunk Gen SID: 2d4fbfa2-e9c4-4ed3-a709-6af962063265)
[PageContentProcessor-PDFSingle] Starting LLM chunk generation for page: pdf-luisa-faq.pdf#page=3 (SID: 2d4fbfa2-e9c4-4ed3-a709-6af962063265, Domain: luisa-faq.pdf)
[PageContentProcessor-PDFSingle] Pre-splitting content for: pdf-luisa-faq.pdf#page=3 (Original length: 683 chars)
[PageContentProcessor-PDFSingle] URL pdf-luisa-faq.pdf#page=3 was pre-split into 1 chunk(s) for LLM processing.
[PageContentProcessor-PDFSingle] Processing 1 pre-chunks with concurrency 1 for: pdf-luisa-faq.pdf#page=3
[PageContentProcessor-PDFSingle] Segmenting and categorizing pre-chunk 1/1 for: pdf-luisa-faq.pdf#page=3 (Length: 683 chars)
[LLMSegmenterCategorizer] Calling actualCategorizeWebsiteContent from content-analysis.ts for URL: pdf-luisa-faq.pdf#page=3
[Categorizer] Starting categorizeWebsiteContent for businessId=2f905c2c-0167-4bcb-b513-f19b8fbe8f9e, url=pdf-luisa-faq.pdf#page=3
[Categorizer] Raw response for businessId=2f905c2c-0167-4bcb-b513-f19b8fbe8f9e, url=pdf-luisa-faq.pdf#page=3: ```json
[
  {
    "category": 5,
    "content": "No. When asked, she confirmed she only attends in North Melbourne. 12. What if I can’t reach Luisa? Clients sometimes call or message repeatedly when arriving. If there's a delay, it’s best to: ● Message again via WhatsApp ● Wait in the lobby or outside Apt 111 ● Be patient, as she may be attending another client or caring for her child",
    "confidence": 0.95,
    "confidenceReason": "Content addresses common questions and concerns from clients,...
[Categorizer] Raw response length: 537 characters
[JSON Parser] Attempting to parse (first 500 chars): ```json
[
  {
    "category": 5,
    "content": "No. When asked, she confirmed she only attends in North Melbourne. 12. What if I can’t reach Luisa? Clients sometimes call or message repeatedly when arriving. If there's a delay, it’s best to: ● Message again via WhatsApp ● Wait in the lobby or outside Apt 111 ● Be patient, as she may be attending another client or caring for her child",
    "confidence": 0.95,
    "confidenceReason": "Content addresses common questions and concerns from clients,...
[JSON Parser] Initial parse failed, attempting to extract JSON array
[JSON Parser] Extracted JSON (first 500 chars): [
  {
    "category": 5,
    "content": "No. When asked, she confirmed she only attends in North Melbourne. 12. What if I can’t reach Luisa? Clients sometimes call or message repeatedly when arriving. If there's a delay, it’s best to: ● Message again via WhatsApp ● Wait in the lobby or outside Apt 111 ● Be patient, as she may be attending another client or caring for her child",
    "confidence": 0.95,
    "confidenceReason": "Content addresses common questions and concerns from clients, fitting...
[Categorizer] Parsed 1 items from LLM response
[PageContentProcessor-PDFSingle] Pre-chunk 1/1 for URL pdf-luisa-faq.pdf#page=3 yielded 1 LLM-defined sub-chunks.
[PageContentProcessor-PDFSingle] Finished LLM chunk generation for page: pdf-luisa-faq.pdf#page=3. Generated 1 chunks.
[PDF Crawler] Generated 1 LLM chunks for pdf-luisa-faq.pdf#page=3.
[ProcessContentPerPage] Processing 1 chunks for page: pdf-luisa-faq.pdf#page=3
[ProcessContent] Step 1: Preparing initial DocumentData objects from LLM chunks...
[ProcessContent] Step 1 completed. 12 documents created and ready for embedding. 0 duplicates skipped.
[ProcessContent] Step 2: Generating embeddings for 12 documents...
[ProcessContent] Filtering out document d8e1daeb9afffaf7e0e01f451b093fe2e9cd720a10b60ee6af3c860e8297d5b2 - already has embedding
[ProcessContent] Filtering out document a7d3815be28272b80a3180b3c68ea2b53d9e817ab0a97f6fdb2d58884a62d3c5 - already has embedding
[ProcessContent] Filtering out document e374652180692cd0eee78fa83381a6081242eee40b14b407e0c75fa91c04440a - already has embedding
[ProcessContent] Filtering out document d8f0982b48289709948600fbafebc768623da93ac468652ffc1f9d1bac9b7059 - already has embedding
[ProcessContent] Filtering out document 6ec6b5023b0873a459db642bf4cd7657424c581c2f2509041ec71e99553cd6d0 - already has embedding
[ProcessContent] Filtering out document 8eb2079f83e9225892fd87de7ecb696018ef676174196762d19e42df78487271 - already has embedding
[ProcessContent] Filtering out document 67f47f33269e7c6bbb0e35d41cde59fe6989a23192f70faeec5c7f247ce6dc91 - already has embedding
[ProcessContent] Filtering out document f015b774c44b7bad22453851e0e904def5ae0f78b18c9ada68094961db5a5eb2 - already has embedding
[ProcessContent] Filtering out document 268b2b0725a42d7cf9d7cc225da3d25ae644cd1e22226bbb620ae456efd89e28 - already has embedding
[ProcessContent] Filtering out document db5ee02668dac94a058008c21a63a285fc160d2d3b38d6b52bf6ab298fc6a26d - already has embedding
[ProcessContent] Filtering out document 62f609db570b6342be46d4a1f82723ac13a2785e4373ec5cdb315423f0cc2310 - already has embedding
[ProcessContent] After filtering: 1 documents need embeddings (filtered out 11)
[ProcessContent] Processing 1 embedding tasks with concurrency 1
[EmbeddingCreator] Calling generateEmbedding for: pdf-luisa-faq.pdf#page=3, interactionId: 4cca31342739067c15b469e87a0e12c929d90c8f1516b2d8aed3fad3ad5f0137_embedding, text (first 80 chars): "No. When asked, she confirmed she only attends in North Melbourne. 12. What if I..."
[generateEmbedding] Attempting for text (first 80 chars): "No. When asked, she confirmed she only attends in North Melbourne. 12. What if I..."
[generateEmbedding] SUCCESS for text (first 80 chars): "No. When asked, she confirmed she only attends in North Melbourne. 12. What if I..."
[EmbeddingCreator] generateEmbedding SUCCEEDED for 4cca31342739067c15b469e87a0e12c929d90c8f1516b2d8aed3fad3ad5f0137_embedding. Result vector (first 3 elements): [ -0.05200827121734619, 0.002890700241550803, 0.040160395205020905 ]
[Embedding] Successfully generated embedding for doc hash 4cca31342739067c15b469e87a0e12c929d90c8f1516b2d8aed3fad3ad5f0137 from source pdf-luisa-faq.pdf#page=3 in 507ms.
[ProcessContent] Step 2 completed. Embeddings generated (or attempted) for all documents. Stats: 12 attempts, 0 failures.
[ProcessContentPerPage] Saving JSON artifacts for 1 documents from page: pdf-luisa-faq.pdf#page=3
[ProcessContentPerPage] Finished saving JSON artifacts for page: pdf-luisa-faq.pdf#page=3
[ProcessContentPerPage] Finished processing and embedding for page: pdf-luisa-faq.pdf#page=3. Current total docs in state: 12
[PDF Crawler] Submitted 1 chunks from pdf-luisa-faq.pdf#page=3 for embedding and DB processing (DB SID: bd52cd75-1a4c-4450-b27c-f57acffe4bec).
[ProcessContentFinalize] Finalizing content processing...
[ProcessContent] Collecting documents with their embeddings for final save...
[ProcessContent] Collected 12 documents (with embeddeddings) for saving.
[ProcessContent] Successful pages (with at least one saved chunk): 3
[ProcessContent] Step 3: Logging primary summary artifacts (manifests)...
[ProcessContent] Step 3 completed. Primary summary artifacts (manifests) logged.
[ProcessContentFinalize] Attempting to save session bd52cd75-1a4c-4450-b27c-f57acffe4bec with 12 documents (embeddings included) to database...
[Environment] Using development environment for service-role client
[CrawlSession.addSessionWithDocumentsAndEmbeddings] Using production service role client (PDF crawler production mode)
[ProcessContentFinalize] Successfully saved session bd52cd75-1a4c-4450-b27c-f57acffe4bec with 12 documents.
[ProcessContent] Step 3: Logging primary summary artifacts (manifests)...
[ProcessContent] Step 3 completed. Primary summary artifacts (manifests) logged.
[ProcessContentFinalize] Re-saved manifests with updated document DB IDs.
[ProcessContentFinalize] Content processing for session bd52cd75-1a4c-4450-b27c-f57acffe4bec finalized successfully.
[PDF Crawler] Content processing finalized. Final status/session ID: bd52cd75-1a4c-4450-b27c-f57acffe4bec
[LOGGER] Could not parse URL pdf-luisa-faq.pdf#page=1 to extract domain.
[LOGGER] Could not parse URL pdf-luisa-faq.pdf#page=2 to extract domain.
[LOGGER] Could not parse URL pdf-luisa-faq.pdf#page=3 to extract domain.
[LOGGER] Summary saved to /Users/juanbernal/code/mesieou/2025/simple_booking/crawl-output/summary.json
 POST /api/content-crawler/pdf 200 in 25596ms
[SEED] PDF content crawler API response: {
  message: 'PDF processed successfully',
  result: {
    mergedText: '1. Where does Luisa work from? Luisa does not operate from a public salon or studio. She provides services from her apartment located at: Apt 11/9 Dryburgh St, Apt 111, West Melbourne VIC 3003\n' +
      '\n' +
      "2. Does Luisa accept walk-ins or same-day bookings? Luisa may accept same-day bookings if she has availability, but it's always best to confirm through WhatsApp. She frequently shares availability for same-day or next-day appointments when asked.\n" +
      '\n' +
      '3. What is Luisa’s deposit policy? ● A 50% deposit is required to secure an appointment. Deposit can be paid via bank transfer to: makefile CopyEdit Name: Lisa Bernal Number: +61 451 375 263 ● ● The deposit is refundable only if: ○ The cancellation is made at least 24 hours in advance, or ○ The appointment is rescheduled more than 24 hours ahead.\n' +
      '\n' +
      '4. What if I can’t pay the deposit? Some clients have been allowed to pay the full amount in cash on the day of the appointment if they don’t have a local bank account (e.g., only Bancolombia available). Luisa seems flexible on this on a case-by-case basis.\n' +
      '\n' +
      '5. Is payment in cash required? Yes, Luisa generally prefers or requires payment in cash unless otherwise agreed. She reminds customers of this frequently before appointments.\n' +
      '\n' +
      '6. What happens if Luisa is running late? Luisa occasionally runs late and notifies the client. Clients are usually asked to wait in the apartment lobby. She is apologetic and communicative about delays.\n' +
      '\n' +
      '7. Can I cancel or reschedule my appointment? Yes, you can cancel or reschedule, but it must be at least 24 hours in advance to retain your deposit. Last-minute cancellations or no-shows may forfeit the deposit.\n' +
      '\n' +
      '8. Can someone else come to the appointment or wait? Luisa has not objected to clients bringing someone or waiting nearby, but this should be confirmed in advance as her studio is in her private residence.\n' +
      '\n' +
      '9. How long do services take? ● Braiding: Approx. 1 hour ● Shellac Manicure: Not explicitly stated, but appointments are often scheduled in 1 – 1.5 hour windows\n' +
      '\n' +
      '10. Can Luisa accommodate last-minute changes or delays? Yes, she tries to be flexible. Clients running late or changing plans often communicate with her and she adjusts where possible, depending on her schedule.\n' +
      '\n' +
      '11. Does Luisa provide mobile services?\n' +
      '\n' +
      "No. When asked, she confirmed she only attends in North Melbourne. 12. What if I can’t reach Luisa? Clients sometimes call or message repeatedly when arriving. If there's a delay, it’s best to: ● Message again via WhatsApp ● Wait in the lobby or outside Apt 111 ● Be patient, as she may be attending another client or caring for her child",
    pageCount: 3,
    uniqueParagraphs: 12,
    businessId: '2f905c2c-0167-4bcb-b513-f19b8fbe8f9e',
    source: 'luisa-faq.pdf',
    embeddingsStatus: 'Processed with DB Session ID: bd52cd75-1a4c-4450-b27c-f57acffe4bec'
  },
  pdfName: 'luisa-faq.pdf'
}
[SEED] Warning: Could not query embeddings by businessId: column embeddings.businessId does not exist
[SEED] Warning: Could not verify embeddings creation: undefined
 POST /api/seed/luisa 200 in 31729ms
 ✓ Compiled /api/seed/removalist in 221ms (395 modules)
🚚 Starting removalist business seed for DEVELOPMENT...
[SEED] Starting database seeding for Quick Move Removalists (DEVELOPMENT ONLY)...
[SEED] Environment: {
  supabaseUrl: 'https://yxavypxuzpjejkezwzjl.supabase.co',
  hasServiceRoleKey: true,
  hasDevCredentials: true,
  usingProvidedClient: false,
  isProductionUrl: false,
  usingDevEnvironment: true
}
[SEED] Checking for existing Quick Move Removalists business data to clean up...
[SEED] No existing Quick Move Removalists business data found to clean up.
[SEED] Creating new removalist business...
[SEED] Business 'Timos Removals' created with ID: f3934f33-5eea-40ba-b024-5b06fa330d8d
[SEED] Creating owner provider...
[SEED] About to create user with data: {
  email: 'info@timosremovals.com.au',
  whatsappNumber: '+61468968600',
  businessId: 'f3934f33-5eea-40ba-b024-5b06fa330d8d'
}
[User.add] No existing auth user found. Creating new one.
Failed to create auth user {
  message: 'A user with this email address has already been registered',
  details: undefined,
  code: 'email_exists',
  hint: undefined
}
[SEED] Error during business creation, cleaning up partial data...
[SEED] Error details: Failed to create auth user
[SEED] Cleaning up partially created business with ID: f3934f33-5eea-40ba-b024-5b06fa330d8d
[SEED] Starting cleanup for business ID: f3934f33-5eea-40ba-b024-5b06fa330d8d...
[SEED] Successfully cleaned up business f3934f33-5eea-40ba-b024-5b06fa330d8d and all related data.
[SEED] Cleanup completed successfully.
❌ Seed failed: Error [ModelError]: Failed to create auth user
    at handleModelError (lib/general-helpers/error.ts:16:8)
    at User.add (lib/database/models/user.ts:167:46)
    at async createRemovalistTestBusiness (lib/database/seed/create-removalist-test-business.ts:129:52)
    at async POST (app/api/seed/removalist/route.ts:34:21)
  14 |   } : {};
  15 |   console.error(message, errorDetails);
> 16 |   throw new ModelError(message, error);
     |        ^
  17 | }  {
  originalError: Error [AuthApiError]: A user with this email address has already been registered
      at async User.add (lib/database/models/user.ts:160:62)
      at async createRemovalistTestBusiness (lib/database/seed/create-removalist-test-business.ts:129:52)
      at async POST (app/api/seed/removalist/route.ts:34:21)
    158 |         } else {
    159 |             console.log(`[User.add] No existing auth user found. Creating new one.`);
  > 160 |             const { data: newAuthData, error: createError } = await adminSupa.auth.admin.createUser({
        |                                                              ^
    161 |                 email: email,
    162 |                 password: password,
    163 |                 email_confirm: true, {
    __isAuthError: true,
    status: 422,
    code: 'email_exists'
  }
}
 POST /api/seed/removalist 500 in 1840ms
 ✓ Compiled in 187ms (54 modules)
